<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Redis Performance Issues | Kaga Blog</title>
<meta name=keywords content="Redis"><meta name=description content="A comprehensive guide to troubleshooting Redis performance issues
1. Introduction
Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:

Same commands sometimes fast, sometimes slow
Simple operations like SET and DEL taking unexpectedly long
Temporary slowdowns that resolve themselves
Sudden performance degradation after long periods of stability

This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues."><meta name=author content><link rel=canonical href=https://bleedkagax.github.io/post/2_redis_performance_issues/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://bleedkagax.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bleedkagax.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bleedkagax.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bleedkagax.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bleedkagax.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bleedkagax.github.io/post/2_redis_performance_issues/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Redis Performance Issues"><meta property="og:description" content="A comprehensive guide to troubleshooting Redis performance issues
1. Introduction
Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:

Same commands sometimes fast, sometimes slow
Simple operations like SET and DEL taking unexpectedly long
Temporary slowdowns that resolve themselves
Sudden performance degradation after long periods of stability

This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues."><meta property="og:type" content="article"><meta property="og:url" content="https://bleedkagax.github.io/post/2_redis_performance_issues/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Redis Performance Issues"><meta name=twitter:description content="A comprehensive guide to troubleshooting Redis performance issues
1. Introduction
Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:

Same commands sometimes fast, sometimes slow
Simple operations like SET and DEL taking unexpectedly long
Temporary slowdowns that resolve themselves
Sudden performance degradation after long periods of stability

This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bleedkagax.github.io/post/"},{"@type":"ListItem","position":2,"name":"Redis Performance Issues","item":"https://bleedkagax.github.io/post/2_redis_performance_issues/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Redis Performance Issues","name":"Redis Performance Issues","description":"A comprehensive guide to troubleshooting Redis performance issues 1. Introduction Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:\nSame commands sometimes fast, sometimes slow Simple operations like SET and DEL taking unexpectedly long Temporary slowdowns that resolve themselves Sudden performance degradation after long periods of stability This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues.\n","keywords":["Redis"],"articleBody":"A comprehensive guide to troubleshooting Redis performance issues 1. Introduction Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:\nSame commands sometimes fast, sometimes slow Simple operations like SET and DEL taking unexpectedly long Temporary slowdowns that resolve themselves Sudden performance degradation after long periods of stability This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues.\n2. Confirming Redis Slowdown a) Isolate the problem Implement distributed tracing in your application Record response times for external dependencies, including Redis Identify if the Redis operation is the bottleneck b) Eliminate network issues Check if all services on the same server experience similar delays If so, involve network operations team If not, focus on Redis-specific issues c) Establish baseline performance Conduct benchmark tests on production servers using redis-cli commands directly on the Redis server:\nMeasure maximum latency:\nredis-cli -h 127.0.0.1 -p 6379 --intrinsic-latency 60 Example output: max latency of 72 microseconds\nMonitor latency history:\nredis-cli -h 127.0.0.1 -p 6379 --latency-history -i 1 Example output: average latencies between 0.08 and 0.13 milliseconds\nd) Compare suspected slow instances Test a known good Redis instance for baseline Test the suspected slow instance If latency is 2x or more than baseline, consider it definitively slow 3. Investigating Slowdown Causes a) Using high complexity commands Check Redis slow log Set slowlog parameters:\nCONFIG SET slowlog-log-slower-than 5000 CONFIG SET slowlog-max-len 500 View slow log:\nSLOWLOG get 5 Look for: O(N) or higher complexity commands (e.g., SORT, SUNION, ZUNIONSTORE) O(N) commands with large N values Commands returning large amounts of data Impact: High CPU usage for complex operations Network transfer time for large data sets Blocking of subsequent commands due to Redis’ single-threaded nature Solutions: Avoid high complexity commands, move aggregation to client side Limit the amount of data returned (N \u003c= 300 recommended) Use SCAN instead of KEYS for iterating over large key sets Monitor CPU usage - high CPU with low OPS suggests complex commands Additional tips: Use pipelining to reduce network round trips Consider using Lua scripts for complex operations b) Operating on big keys Reasons for slowdown: Time-consuming memory allocation for large values Slow memory deallocation when deleting large keys Detecting big keys: redis-cli -h 127.0.0.1 -p 6379 --bigkeys -i 0.01 Scans entire keyspace, reports largest keys by type Shows distribution of key sizes and types Cautions when scanning: Can cause OPS spikes on production systems May block other operations on busy systems Solutions: Avoid storing big keys in applications Use UNLINK instead of DEL for large keys (Redis 4.0+) Enable lazy-free mechanism for DEL (Redis 6.0+) Set lazyfree-lazy-eviction, lazyfree-lazy-expire, lazyfree-lazy-server-del to yes Best practices: Split large values into smaller chunks Use Hash data structures for large objects instead of single String keys Redis hashes are better for large objects than single strings because they allow atomic operations on individual fields, partial data retrieval, and more efficient updates, improving performance and scalability.\nc) Keys expiring at the same time Symptoms: Latency spikes at regular intervals Redis expiration strategies: Passive: Check expiration on access Active: Periodic scan of expired keys Problems: Active expiration runs in main thread, blocking other operations Many keys expiring simultaneously cause latency spikes Detection: Monitor expired_keys metric in INFO stats Use Redis 4.0+ MEMORY STATS for more detailed expiration info Solutions: Add random jitter to expiration times (e.g., expire_at = now + TTL + random(0, 300)) Enable lazy-free for expired key deletion (Redis 4.0+) Adjust active expiry algorithms (hz and active-expire-effort parameters) Additional considerations: Balance between memory usage and CPU usage when tuning expiration Consider using SCAN to manually expire keys in batches for extreme cases d) Memory fragmentation Check fragmentation ratio: INFO memory Look for mem_fragmentation_ratio\nCauses: Frequent creation/deletion of keys of varying sizes OS memory allocation strategies Impact: High fragmentation ratio (\u003e1.5) indicates inefficient memory use Very low ratio (\u003c1) suggests Redis needs more memory Solutions: Enable activedefrag (Redis 4.0+): CONFIG SET activedefrag yes Configure active-defrag-* parameters: CONFIG SET active-defrag-ignore-bytes 100mb CONFIG SET active-defrag-threshold-lower 10 CONFIG SET active-defrag-threshold-upper 100 CONFIG SET active-defrag-cycle-min 25 CONFIG SET active-defrag-cycle-max 75 Restart Redis instance to defragment memory (last resort) Best practices: Use consistent key sizes when possible Monitor fragmentation ratio over time Consider using jemalloc memory allocator e) AOF persistence impacting performance Problem: fsync() on every write blocks the main thread Detection: Check INFO persistence for aof_* metrics\nSolutions: Consider relaxing durability guarantees Use “everysec” fsync policy as a compromise Configure no-appendfsync-on-rewrite for better performance during rewrites AOF policies: always: Most durable, worst performance everysec: Good durability, acceptable performance no: Best performance, risk of data loss Additional considerations: Use AOF rewrite to keep AOF file size manageable Monitor AOF rewrite progress and impact f) Replication issues Problems: Large replication buffers on master can cause OOM Slow replicas can cause master buffers to grow Monitoring: Check INFO replication for master_repl_offset and slave_repl_offset Monitor repl_backlog_size Solutions: Increase replication backlog size if needed Optimize network between master and replicas Consider using diskless replication for faster sync Best practices: Use replication timeout (repl-timeout) to detect stuck replicas Configure appropriate client-output-buffer-limit for slave clients Use Redis Sentinel or Cluster for automatic failover g) CPU utilization Monitoring: Use INFO CPU to check Redis CPU usage Monitor system CPU usage Solutions: Distribute load across multiple Redis instances Use Redis Cluster for better CPU utilization Optimize client-side operations to reduce load on Redis Additional tips: Profile Redis commands using –latency-debug flag Use DEBUG OBJECT to analyze key encoding and other properties h) Network issues Test latency from Redis server itself to isolate network problems Use redis-cli --latency to measure network latency Check for network congestion or hardware issues Considerations: Network interface configuration TCP settings (e.g., tcp-backlog) Use of proxies or load balancers i) Transparent huge pages (THP) Check if enabled: cat /sys/kernel/mm/transparent_hugepage/enabled Solution: Disable THP for Redis servers:\necho never \u003e /sys/kernel/mm/transparent_hugepage/enabled Make change permanent in /etc/rc.local or systemd\nAdditional system settings to consider: vm.overcommit_memory vm.swappiness Disable NUMA interleaving 4. Additional Considerations Impact of data structure choice on performance Strings: Fastest, but limited functionality Hashes: Efficient for objects, supports partial updates Lists: Good for queue-like data structures Sets: Efficient for membership checks Sorted Sets: Useful for leaderboards and range queries Proper configuration of maxmemory and eviction policies noeviction, allkeys-lru, volatile-lru, allkeys-random, volatile-random, volatile-ttl Importance of connection pooling in clients Monitoring and alerting for early detection of issues Set up monitoring for key metrics (CPU, memory, network, ops/sec) Use INFO command regularly to gather stats Consider tools like Redis Exporter for Prometheus Regular performance testing and capacity planning Consideration of Redis Cluster for scaling and better resource utilization Use of Redis modules for specific use cases (e.g., RediSearch, RedisTimeSeries) 5. Debugging and Profiling Tools redis-cli –stat: Real-time stats redis-cli –latency: Network latency testing redis-cli –latency-history: Latency over time redis-cli –latency-dist: Latency distribution redis-cli –bigkeys: Find large keys redis-cli –memkeys: Analyze memory usage of keys redis-cli –hotkeys: Identify frequently accessed keys MONITOR command: Real-time log of Redis commands (use cautiously in production) 6. Best Practices Regular backups and disaster recovery planning Implement proper security measures (password, firewall, SSL/TLS) Keep Redis version up-to-date Use Redis benchmark tool for performance testing Implement proper error handling and retry mechanisms in clients Use Redis Pub/Sub with caution, as it can impact performance 7. Conclusion Redis performance issues can have various causes Systematic approach to troubleshooting is crucial Understanding Redis internals helps in diagnosing and resolving issues Regular monitoring and proactive optimization are key to maintaining high performance Emphasizes the importance of ongoing learning and staying updated with Redis features Encourage reading Redis documentation and following the official blog for updates ","wordCount":"1274","inLanguage":"en","datePublished":"2024-09-07T00:00:00Z","dateModified":"2024-09-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://bleedkagax.github.io/post/2_redis_performance_issues/"},"publisher":{"@type":"Organization","name":"Kaga Blog","logo":{"@type":"ImageObject","url":"https://bleedkagax.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bleedkagax.github.io/ accesskey=h title="Kaga Blog (Alt + H)">Kaga Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bleedkagax.github.io/post/ title=Posts><span>Posts</span></a></li><li><a href=https://bleedkagax.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://bleedkagax.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://bleedkagax.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Redis Performance Issues</h1><div class=post-meta><span title='2024-09-07 00:00:00 +0000 UTC'>September 7, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#a-comprehensive-guide-to-troubleshooting-redis-performance-issues aria-label="A comprehensive guide to troubleshooting Redis performance issues">A comprehensive guide to troubleshooting Redis performance issues</a><ul><li><a href=#1-introduction aria-label="1. Introduction">1. Introduction</a></li><li><a href=#2-confirming-redis-slowdown aria-label="2. Confirming Redis Slowdown">2. Confirming Redis Slowdown</a><ul><li><a href=#a-isolate-the-problem aria-label="a) Isolate the problem">a) Isolate the problem</a></li><li><a href=#b-eliminate-network-issues aria-label="b) Eliminate network issues">b) Eliminate network issues</a></li><li><a href=#c-establish-baseline-performance aria-label="c) Establish baseline performance">c) Establish baseline performance</a></li><li><a href=#d-compare-suspected-slow-instances aria-label="d) Compare suspected slow instances">d) Compare suspected slow instances</a></li></ul></li><li><a href=#3-investigating-slowdown-causes aria-label="3. Investigating Slowdown Causes">3. Investigating Slowdown Causes</a><ul><li><a href=#a-using-high-complexity-commands aria-label="a) Using high complexity commands">a) Using high complexity commands</a><ul><li><a href=#check-redis-slow-log aria-label="Check Redis slow log">Check Redis slow log</a></li><li><a href=#look-for aria-label="Look for:">Look for:</a></li><li><a href=#impact aria-label=Impact:>Impact:</a></li><li><a href=#solutions aria-label=Solutions:>Solutions:</a></li><li><a href=#additional-tips aria-label="Additional tips:">Additional tips:</a></li></ul></li><li><a href=#b-operating-on-big-keys aria-label="b) Operating on big keys">b) Operating on big keys</a><ul><li><a href=#reasons-for-slowdown aria-label="Reasons for slowdown:">Reasons for slowdown:</a></li><li><a href=#detecting-big-keys aria-label="Detecting big keys:">Detecting big keys:</a></li><li><a href=#cautions-when-scanning aria-label="Cautions when scanning:">Cautions when scanning:</a></li><li><a href=#solutions-1 aria-label=Solutions:>Solutions:</a></li><li><a href=#best-practices aria-label="Best practices:">Best practices:</a></li></ul></li><li><a href=#c-keys-expiring-at-the-same-time aria-label="c) Keys expiring at the same time">c) Keys expiring at the same time</a><ul><li><a href=#symptoms aria-label=Symptoms:>Symptoms:</a></li><li><a href=#redis-expiration-strategies aria-label="Redis expiration strategies:">Redis expiration strategies:</a></li><li><a href=#problems aria-label=Problems:>Problems:</a></li><li><a href=#detection aria-label=Detection:>Detection:</a></li><li><a href=#solutions-2 aria-label=Solutions:>Solutions:</a></li><li><a href=#additional-considerations aria-label="Additional considerations:">Additional considerations:</a></li></ul></li><li><a href=#d-memory-fragmentation aria-label="d) Memory fragmentation">d) Memory fragmentation</a><ul><li><a href=#check-fragmentation-ratio aria-label="Check fragmentation ratio:">Check fragmentation ratio:</a></li><li><a href=#causes aria-label=Causes:>Causes:</a></li><li><a href=#impact-1 aria-label=Impact:>Impact:</a></li><li><a href=#solutions-3 aria-label=Solutions:>Solutions:</a></li><li><a href=#best-practices-1 aria-label="Best practices:">Best practices:</a></li></ul></li><li><a href=#e-aof-persistence-impacting-performance aria-label="e) AOF persistence impacting performance">e) AOF persistence impacting performance</a><ul><li><a href=#problem aria-label=Problem:>Problem:</a></li><li><a href=#detection-1 aria-label=Detection:>Detection:</a></li><li><a href=#solutions-4 aria-label=Solutions:>Solutions:</a></li><li><a href=#aof-policies aria-label="AOF policies:">AOF policies:</a></li><li><a href=#additional-considerations-1 aria-label="Additional considerations:">Additional considerations:</a></li></ul></li><li><a href=#f-replication-issues aria-label="f) Replication issues">f) Replication issues</a><ul><li><a href=#problems-1 aria-label=Problems:>Problems:</a></li><li><a href=#monitoring aria-label=Monitoring:>Monitoring:</a></li><li><a href=#solutions-5 aria-label=Solutions:>Solutions:</a></li><li><a href=#best-practices-2 aria-label="Best practices:">Best practices:</a></li></ul></li><li><a href=#g-cpu-utilization aria-label="g) CPU utilization">g) CPU utilization</a><ul><li><a href=#monitoring-1 aria-label=Monitoring:>Monitoring:</a></li><li><a href=#solutions-6 aria-label=Solutions:>Solutions:</a></li><li><a href=#additional-tips-1 aria-label="Additional tips:">Additional tips:</a></li></ul></li><li><a href=#h-network-issues aria-label="h) Network issues">h) Network issues</a><ul><li><a href=#considerations aria-label=Considerations:>Considerations:</a></li></ul></li><li><a href=#i-transparent-huge-pages-thp aria-label="i) Transparent huge pages (THP)">i) Transparent huge pages (THP)</a><ul><li><a href=#check-if-enabled aria-label="Check if enabled:">Check if enabled:</a></li><li><a href=#solution aria-label=Solution:>Solution:</a></li><li><a href=#additional-system-settings-to-consider aria-label="Additional system settings to consider:">Additional system settings to consider:</a></li></ul></li></ul></li><li><a href=#4-additional-considerations aria-label="4. Additional Considerations">4. Additional Considerations</a><ul><li><a href=#impact-of-data-structure-choice-on-performance aria-label="Impact of data structure choice on performance">Impact of data structure choice on performance</a></li><li><a href=#proper-configuration-of-maxmemory-and-eviction-policies aria-label="Proper configuration of maxmemory and eviction policies">Proper configuration of maxmemory and eviction policies</a></li><li><a href=#importance-of-connection-pooling-in-clients aria-label="Importance of connection pooling in clients">Importance of connection pooling in clients</a></li><li><a href=#monitoring-and-alerting-for-early-detection-of-issues aria-label="Monitoring and alerting for early detection of issues">Monitoring and alerting for early detection of issues</a></li><li><a href=#regular-performance-testing-and-capacity-planning aria-label="Regular performance testing and capacity planning">Regular performance testing and capacity planning</a></li><li><a href=#consideration-of-redis-cluster-for-scaling-and-better-resource-utilization aria-label="Consideration of Redis Cluster for scaling and better resource utilization">Consideration of Redis Cluster for scaling and better resource utilization</a></li><li><a href=#use-of-redis-modules-for-specific-use-cases-eg-redisearch-redistimeseries aria-label="Use of Redis modules for specific use cases (e.g., RediSearch, RedisTimeSeries)">Use of Redis modules for specific use cases (e.g., RediSearch, RedisTimeSeries)</a></li></ul></li><li><a href=#5-debugging-and-profiling-tools aria-label="5. Debugging and Profiling Tools">5. Debugging and Profiling Tools</a></li><li><a href=#6-best-practices aria-label="6. Best Practices">6. Best Practices</a></li><li><a href=#7-conclusion aria-label="7. Conclusion">7. Conclusion</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=a-comprehensive-guide-to-troubleshooting-redis-performance-issues>A comprehensive guide to troubleshooting Redis performance issues<a hidden class=anchor aria-hidden=true href=#a-comprehensive-guide-to-troubleshooting-redis-performance-issues>#</a></h1><h2 id=1-introduction>1. Introduction<a hidden class=anchor aria-hidden=true href=#1-introduction>#</a></h2><p>Redis is renowned for its high performance, capable of handling 100,000 operations per second. However, users may encounter unexpected latency issues in various scenarios:</p><ul><li>Same commands sometimes fast, sometimes slow</li><li>Simple operations like SET and DEL taking unexpectedly long</li><li>Temporary slowdowns that resolve themselves</li><li>Sudden performance degradation after long periods of stability</li></ul><p>This comprehensive guide (approximately 20,000 words) aims to provide a thorough troubleshooting approach for Redis performance issues.</p><h2 id=2-confirming-redis-slowdown>2. Confirming Redis Slowdown<a hidden class=anchor aria-hidden=true href=#2-confirming-redis-slowdown>#</a></h2><h3 id=a-isolate-the-problem>a) Isolate the problem<a hidden class=anchor aria-hidden=true href=#a-isolate-the-problem>#</a></h3><ul><li>Implement distributed tracing in your application</li><li>Record response times for external dependencies, including Redis</li><li>Identify if the Redis operation is the bottleneck</li></ul><h3 id=b-eliminate-network-issues>b) Eliminate network issues<a hidden class=anchor aria-hidden=true href=#b-eliminate-network-issues>#</a></h3><ul><li>Check if all services on the same server experience similar delays</li><li>If so, involve network operations team</li><li>If not, focus on Redis-specific issues</li></ul><h3 id=c-establish-baseline-performance>c) Establish baseline performance<a hidden class=anchor aria-hidden=true href=#c-establish-baseline-performance>#</a></h3><p>Conduct benchmark tests on production servers using redis-cli commands directly on the Redis server:</p><ol><li><p>Measure maximum latency:</p><pre tabindex=0><code>redis-cli -h 127.0.0.1 -p 6379 --intrinsic-latency 60
</code></pre><p>Example output: max latency of 72 microseconds</p></li><li><p>Monitor latency history:</p><pre tabindex=0><code>redis-cli -h 127.0.0.1 -p 6379 --latency-history -i 1
</code></pre><p>Example output: average latencies between 0.08 and 0.13 milliseconds</p></li></ol><h3 id=d-compare-suspected-slow-instances>d) Compare suspected slow instances<a hidden class=anchor aria-hidden=true href=#d-compare-suspected-slow-instances>#</a></h3><ul><li>Test a known good Redis instance for baseline</li><li>Test the suspected slow instance</li><li>If latency is 2x or more than baseline, consider it definitively slow</li></ul><h2 id=3-investigating-slowdown-causes>3. Investigating Slowdown Causes<a hidden class=anchor aria-hidden=true href=#3-investigating-slowdown-causes>#</a></h2><h3 id=a-using-high-complexity-commands>a) Using high complexity commands<a hidden class=anchor aria-hidden=true href=#a-using-high-complexity-commands>#</a></h3><h4 id=check-redis-slow-log>Check Redis slow log<a hidden class=anchor aria-hidden=true href=#check-redis-slow-log>#</a></h4><p>Set slowlog parameters:</p><pre tabindex=0><code>CONFIG SET slowlog-log-slower-than 5000
CONFIG SET slowlog-max-len 500
</code></pre><p>View slow log:</p><pre tabindex=0><code>SLOWLOG get 5
</code></pre><h4 id=look-for>Look for:<a hidden class=anchor aria-hidden=true href=#look-for>#</a></h4><ul><li>O(N) or higher complexity commands (e.g., SORT, SUNION, ZUNIONSTORE)</li><li>O(N) commands with large N values</li><li>Commands returning large amounts of data</li></ul><h4 id=impact>Impact:<a hidden class=anchor aria-hidden=true href=#impact>#</a></h4><ul><li>High CPU usage for complex operations</li><li>Network transfer time for large data sets</li><li>Blocking of subsequent commands due to Redis&rsquo; single-threaded nature</li></ul><h4 id=solutions>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions>#</a></h4><ul><li>Avoid high complexity commands, move aggregation to client side</li><li>Limit the amount of data returned (N &lt;= 300 recommended)</li><li>Use SCAN instead of KEYS for iterating over large key sets</li><li>Monitor CPU usage - high CPU with low OPS suggests complex commands</li></ul><h4 id=additional-tips>Additional tips:<a hidden class=anchor aria-hidden=true href=#additional-tips>#</a></h4><ul><li>Use pipelining to reduce network round trips</li><li>Consider using Lua scripts for complex operations</li></ul><h3 id=b-operating-on-big-keys>b) Operating on big keys<a hidden class=anchor aria-hidden=true href=#b-operating-on-big-keys>#</a></h3><h4 id=reasons-for-slowdown>Reasons for slowdown:<a hidden class=anchor aria-hidden=true href=#reasons-for-slowdown>#</a></h4><ul><li>Time-consuming memory allocation for large values</li><li>Slow memory deallocation when deleting large keys</li></ul><h4 id=detecting-big-keys>Detecting big keys:<a hidden class=anchor aria-hidden=true href=#detecting-big-keys>#</a></h4><pre tabindex=0><code>redis-cli -h 127.0.0.1 -p 6379 --bigkeys -i 0.01
</code></pre><ul><li>Scans entire keyspace, reports largest keys by type</li><li>Shows distribution of key sizes and types</li></ul><h4 id=cautions-when-scanning>Cautions when scanning:<a hidden class=anchor aria-hidden=true href=#cautions-when-scanning>#</a></h4><ul><li>Can cause OPS spikes on production systems</li><li>May block other operations on busy systems</li></ul><h4 id=solutions-1>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-1>#</a></h4><ul><li>Avoid storing big keys in applications</li><li>Use UNLINK instead of DEL for large keys (Redis 4.0+)</li><li>Enable lazy-free mechanism for DEL (Redis 6.0+)</li><li>Set lazyfree-lazy-eviction, lazyfree-lazy-expire, lazyfree-lazy-server-del to yes</li></ul><h4 id=best-practices>Best practices:<a hidden class=anchor aria-hidden=true href=#best-practices>#</a></h4><ul><li>Split large values into smaller chunks</li><li>Use Hash data structures for large objects instead of single String keys</li></ul><p>Redis hashes are better for large objects than single strings because they allow atomic operations on individual fields, partial data retrieval, and more efficient updates, improving performance and scalability.</p><h3 id=c-keys-expiring-at-the-same-time>c) Keys expiring at the same time<a hidden class=anchor aria-hidden=true href=#c-keys-expiring-at-the-same-time>#</a></h3><h4 id=symptoms>Symptoms:<a hidden class=anchor aria-hidden=true href=#symptoms>#</a></h4><ul><li>Latency spikes at regular intervals</li></ul><h4 id=redis-expiration-strategies>Redis expiration strategies:<a hidden class=anchor aria-hidden=true href=#redis-expiration-strategies>#</a></h4><ul><li>Passive: Check expiration on access</li><li>Active: Periodic scan of expired keys</li></ul><h4 id=problems>Problems:<a hidden class=anchor aria-hidden=true href=#problems>#</a></h4><ul><li>Active expiration runs in main thread, blocking other operations</li><li>Many keys expiring simultaneously cause latency spikes</li></ul><h4 id=detection>Detection:<a hidden class=anchor aria-hidden=true href=#detection>#</a></h4><ul><li>Monitor expired_keys metric in INFO stats</li><li>Use Redis 4.0+ MEMORY STATS for more detailed expiration info</li></ul><h4 id=solutions-2>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-2>#</a></h4><ul><li>Add random jitter to expiration times (e.g., expire_at = now + TTL + random(0, 300))</li><li>Enable lazy-free for expired key deletion (Redis 4.0+)</li><li>Adjust active expiry algorithms (hz and active-expire-effort parameters)</li></ul><h4 id=additional-considerations>Additional considerations:<a hidden class=anchor aria-hidden=true href=#additional-considerations>#</a></h4><ul><li>Balance between memory usage and CPU usage when tuning expiration</li><li>Consider using SCAN to manually expire keys in batches for extreme cases</li></ul><h3 id=d-memory-fragmentation>d) Memory fragmentation<a hidden class=anchor aria-hidden=true href=#d-memory-fragmentation>#</a></h3><h4 id=check-fragmentation-ratio>Check fragmentation ratio:<a hidden class=anchor aria-hidden=true href=#check-fragmentation-ratio>#</a></h4><pre tabindex=0><code>INFO memory
</code></pre><p>Look for <code>mem_fragmentation_ratio</code></p><h4 id=causes>Causes:<a hidden class=anchor aria-hidden=true href=#causes>#</a></h4><ul><li>Frequent creation/deletion of keys of varying sizes</li><li>OS memory allocation strategies</li></ul><h4 id=impact-1>Impact:<a hidden class=anchor aria-hidden=true href=#impact-1>#</a></h4><ul><li>High fragmentation ratio (>1.5) indicates inefficient memory use</li><li>Very low ratio (&lt;1) suggests Redis needs more memory</li></ul><h4 id=solutions-3>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-3>#</a></h4><ul><li>Enable activedefrag (Redis 4.0+):<pre tabindex=0><code>CONFIG SET activedefrag yes
</code></pre></li><li>Configure <code>active-defrag-*</code> parameters:<pre tabindex=0><code>CONFIG SET active-defrag-ignore-bytes 100mb
CONFIG SET active-defrag-threshold-lower 10
CONFIG SET active-defrag-threshold-upper 100
CONFIG SET active-defrag-cycle-min 25
CONFIG SET active-defrag-cycle-max 75
</code></pre></li><li>Restart Redis instance to defragment memory (last resort)</li></ul><h4 id=best-practices-1>Best practices:<a hidden class=anchor aria-hidden=true href=#best-practices-1>#</a></h4><ul><li>Use consistent key sizes when possible</li><li>Monitor fragmentation ratio over time</li><li>Consider using jemalloc memory allocator</li></ul><h3 id=e-aof-persistence-impacting-performance>e) AOF persistence impacting performance<a hidden class=anchor aria-hidden=true href=#e-aof-persistence-impacting-performance>#</a></h3><h4 id=problem>Problem:<a hidden class=anchor aria-hidden=true href=#problem>#</a></h4><ul><li>fsync() on every write blocks the main thread</li></ul><h4 id=detection-1>Detection:<a hidden class=anchor aria-hidden=true href=#detection-1>#</a></h4><p>Check <code>INFO persistence</code> for aof_* metrics</p><h4 id=solutions-4>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-4>#</a></h4><ul><li>Consider relaxing durability guarantees</li><li>Use &ldquo;everysec&rdquo; fsync policy as a compromise</li><li>Configure <code>no-appendfsync-on-rewrite</code> for better performance during rewrites</li></ul><h4 id=aof-policies>AOF policies:<a hidden class=anchor aria-hidden=true href=#aof-policies>#</a></h4><ul><li>always: Most durable, worst performance</li><li>everysec: Good durability, acceptable performance</li><li>no: Best performance, risk of data loss</li></ul><h4 id=additional-considerations-1>Additional considerations:<a hidden class=anchor aria-hidden=true href=#additional-considerations-1>#</a></h4><ul><li>Use AOF rewrite to keep AOF file size manageable</li><li>Monitor AOF rewrite progress and impact</li></ul><h3 id=f-replication-issues>f) Replication issues<a hidden class=anchor aria-hidden=true href=#f-replication-issues>#</a></h3><h4 id=problems-1>Problems:<a hidden class=anchor aria-hidden=true href=#problems-1>#</a></h4><ul><li>Large replication buffers on master can cause OOM</li><li>Slow replicas can cause master buffers to grow</li></ul><h4 id=monitoring>Monitoring:<a hidden class=anchor aria-hidden=true href=#monitoring>#</a></h4><ul><li>Check <code>INFO replication</code> for master_repl_offset and slave_repl_offset</li><li>Monitor repl_backlog_size</li></ul><h4 id=solutions-5>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-5>#</a></h4><ul><li>Increase replication backlog size if needed</li><li>Optimize network between master and replicas</li><li>Consider using diskless replication for faster sync</li></ul><h4 id=best-practices-2>Best practices:<a hidden class=anchor aria-hidden=true href=#best-practices-2>#</a></h4><ul><li>Use replication timeout (repl-timeout) to detect stuck replicas</li><li>Configure appropriate client-output-buffer-limit for slave clients</li><li>Use Redis Sentinel or Cluster for automatic failover</li></ul><h3 id=g-cpu-utilization>g) CPU utilization<a hidden class=anchor aria-hidden=true href=#g-cpu-utilization>#</a></h3><h4 id=monitoring-1>Monitoring:<a hidden class=anchor aria-hidden=true href=#monitoring-1>#</a></h4><ul><li>Use <code>INFO CPU</code> to check Redis CPU usage</li><li>Monitor system CPU usage</li></ul><h4 id=solutions-6>Solutions:<a hidden class=anchor aria-hidden=true href=#solutions-6>#</a></h4><ul><li>Distribute load across multiple Redis instances</li><li>Use Redis Cluster for better CPU utilization</li><li>Optimize client-side operations to reduce load on Redis</li></ul><h4 id=additional-tips-1>Additional tips:<a hidden class=anchor aria-hidden=true href=#additional-tips-1>#</a></h4><ul><li>Profile Redis commands using &ndash;latency-debug flag</li><li>Use DEBUG OBJECT to analyze key encoding and other properties</li></ul><h3 id=h-network-issues>h) Network issues<a hidden class=anchor aria-hidden=true href=#h-network-issues>#</a></h3><ul><li>Test latency from Redis server itself to isolate network problems</li><li>Use <code>redis-cli --latency</code> to measure network latency</li><li>Check for network congestion or hardware issues</li></ul><h4 id=considerations>Considerations:<a hidden class=anchor aria-hidden=true href=#considerations>#</a></h4><ul><li>Network interface configuration</li><li>TCP settings (e.g., tcp-backlog)</li><li>Use of proxies or load balancers</li></ul><h3 id=i-transparent-huge-pages-thp>i) Transparent huge pages (THP)<a hidden class=anchor aria-hidden=true href=#i-transparent-huge-pages-thp>#</a></h3><h4 id=check-if-enabled>Check if enabled:<a hidden class=anchor aria-hidden=true href=#check-if-enabled>#</a></h4><pre tabindex=0><code>cat /sys/kernel/mm/transparent_hugepage/enabled
</code></pre><h4 id=solution>Solution:<a hidden class=anchor aria-hidden=true href=#solution>#</a></h4><p>Disable THP for Redis servers:</p><pre tabindex=0><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre><p>Make change permanent in /etc/rc.local or systemd</p><h4 id=additional-system-settings-to-consider>Additional system settings to consider:<a hidden class=anchor aria-hidden=true href=#additional-system-settings-to-consider>#</a></h4><ul><li>vm.overcommit_memory</li><li>vm.swappiness</li><li>Disable NUMA interleaving</li></ul><h2 id=4-additional-considerations>4. Additional Considerations<a hidden class=anchor aria-hidden=true href=#4-additional-considerations>#</a></h2><h3 id=impact-of-data-structure-choice-on-performance>Impact of data structure choice on performance<a hidden class=anchor aria-hidden=true href=#impact-of-data-structure-choice-on-performance>#</a></h3><ul><li>Strings: Fastest, but limited functionality</li><li>Hashes: Efficient for objects, supports partial updates</li><li>Lists: Good for queue-like data structures</li><li>Sets: Efficient for membership checks</li><li>Sorted Sets: Useful for leaderboards and range queries</li></ul><h3 id=proper-configuration-of-maxmemory-and-eviction-policies>Proper configuration of maxmemory and eviction policies<a hidden class=anchor aria-hidden=true href=#proper-configuration-of-maxmemory-and-eviction-policies>#</a></h3><ul><li>noeviction, allkeys-lru, volatile-lru, allkeys-random, volatile-random, volatile-ttl</li></ul><h3 id=importance-of-connection-pooling-in-clients>Importance of connection pooling in clients<a hidden class=anchor aria-hidden=true href=#importance-of-connection-pooling-in-clients>#</a></h3><h3 id=monitoring-and-alerting-for-early-detection-of-issues>Monitoring and alerting for early detection of issues<a hidden class=anchor aria-hidden=true href=#monitoring-and-alerting-for-early-detection-of-issues>#</a></h3><ul><li>Set up monitoring for key metrics (CPU, memory, network, ops/sec)</li><li>Use INFO command regularly to gather stats</li><li>Consider tools like Redis Exporter for Prometheus</li></ul><h3 id=regular-performance-testing-and-capacity-planning>Regular performance testing and capacity planning<a hidden class=anchor aria-hidden=true href=#regular-performance-testing-and-capacity-planning>#</a></h3><h3 id=consideration-of-redis-cluster-for-scaling-and-better-resource-utilization>Consideration of Redis Cluster for scaling and better resource utilization<a hidden class=anchor aria-hidden=true href=#consideration-of-redis-cluster-for-scaling-and-better-resource-utilization>#</a></h3><h3 id=use-of-redis-modules-for-specific-use-cases-eg-redisearch-redistimeseries>Use of Redis modules for specific use cases (e.g., RediSearch, RedisTimeSeries)<a hidden class=anchor aria-hidden=true href=#use-of-redis-modules-for-specific-use-cases-eg-redisearch-redistimeseries>#</a></h3><h2 id=5-debugging-and-profiling-tools>5. Debugging and Profiling Tools<a hidden class=anchor aria-hidden=true href=#5-debugging-and-profiling-tools>#</a></h2><ul><li>redis-cli &ndash;stat: Real-time stats</li><li>redis-cli &ndash;latency: Network latency testing</li><li>redis-cli &ndash;latency-history: Latency over time</li><li>redis-cli &ndash;latency-dist: Latency distribution</li><li>redis-cli &ndash;bigkeys: Find large keys</li><li>redis-cli &ndash;memkeys: Analyze memory usage of keys</li><li>redis-cli &ndash;hotkeys: Identify frequently accessed keys</li><li>MONITOR command: Real-time log of Redis commands (use cautiously in production)</li></ul><h2 id=6-best-practices>6. Best Practices<a hidden class=anchor aria-hidden=true href=#6-best-practices>#</a></h2><ul><li>Regular backups and disaster recovery planning</li><li>Implement proper security measures (password, firewall, SSL/TLS)</li><li>Keep Redis version up-to-date</li><li>Use Redis benchmark tool for performance testing</li><li>Implement proper error handling and retry mechanisms in clients</li><li>Use Redis Pub/Sub with caution, as it can impact performance</li></ul><h2 id=7-conclusion>7. Conclusion<a hidden class=anchor aria-hidden=true href=#7-conclusion>#</a></h2><ul><li>Redis performance issues can have various causes</li><li>Systematic approach to troubleshooting is crucial</li><li>Understanding Redis internals helps in diagnosing and resolving issues</li><li>Regular monitoring and proactive optimization are key to maintaining high performance</li><li>Emphasizes the importance of ongoing learning and staying updated with Redis features</li><li>Encourage reading Redis documentation and following the official blog for updates</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bleedkagax.github.io/tags/redis/>Redis</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://bleedkagax.github.io/>Kaga Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script><script>(function(){var e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(function(e){var t,n=e.parentElement;if(!n)return;t=document.createElement("div"),t.className="mermaid",t.textContent=e.textContent||"",n.replaceWith(t)})})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>