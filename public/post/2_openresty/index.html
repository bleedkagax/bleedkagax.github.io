

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=62354&amp;path=livereload" data-no-instant defer></script>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Openresty - </title>

  <meta name="description" content="Introduction to OpenResty
OpenResty is a dynamic web platform that integrates Nginx with the powerful Lua scripting language. It is designed to build scalable web applications, web services, and dynamic web gateways. By combining the high performance of Nginx with the flexibility of Lua, OpenResty enables developers to handle complex processing at the edge of the network.
What is OpenResty?
OpenResty extends Nginx by bundling it with a set of powerful Lua libraries and modules (known as LuaJIT). This allows embedding Lua scripts directly into the Nginx configuration, offering unparalleled flexibility for customizing request handling, routing, and response generation."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Kaga Blog",
    
    "url": "http:\/\/localhost:62354\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http:\/\/localhost:62354\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http:\/\/localhost:62354\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http:\/\/localhost:62354\/post\/2_openresty\/",
          "name": "Openresty"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Openresty",
  "description" : "Introduction to OpenResty OpenResty is a dynamic web platform that integrates Nginx with the powerful Lua scripting language. It is designed to build scalable web applications, web services, and dynamic web gateways. By combining the high performance of Nginx with the flexibility of Lua, OpenResty enables developers to handle complex processing at the edge of the network.\nWhat is OpenResty? OpenResty extends Nginx by bundling it with a set of powerful Lua libraries and modules (known as LuaJIT). This allows embedding Lua scripts directly into the Nginx configuration, offering unparalleled flexibility for customizing request handling, routing, and response generation.\n",
  "inLanguage" : "en",
  "wordCount":  3248 ,
  "datePublished" : "2024-10-15T00:00:00\u002b00:00",
  "dateModified" : "2024-10-15T00:00:00\u002b00:00",
  "image" : "http:\/\/localhost:62354\/",
  "keywords" : [ "SystemDesign" ],
  "mainEntityOfPage" : "http:\/\/localhost:62354\/post\/2_openresty\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http:\/\/localhost:62354\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http:\/\/localhost:62354\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Openresty" />
<meta property="og:description" content="Introduction to OpenResty
OpenResty is a dynamic web platform that integrates Nginx with the powerful Lua scripting language. It is designed to build scalable web applications, web services, and dynamic web gateways. By combining the high performance of Nginx with the flexibility of Lua, OpenResty enables developers to handle complex processing at the edge of the network.
What is OpenResty?
OpenResty extends Nginx by bundling it with a set of powerful Lua libraries and modules (known as LuaJIT). This allows embedding Lua scripts directly into the Nginx configuration, offering unparalleled flexibility for customizing request handling, routing, and response generation.">
<meta property="og:url" content="http://localhost:62354/post/2_openresty/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Kaga Blog" />

  <meta name="twitter:title" content="Openresty" />
  <meta name="twitter:description" content="Introduction to OpenResty
OpenResty is a dynamic web platform that integrates Nginx with the powerful Lua scripting language. It is designed to build scalable web applications, web services, and â€¦">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="generator" content="Hugo 0.134.0">
  <link rel="alternate" href="http://localhost:62354/index.xml" type="application/rss+xml" title="Kaga Blog"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="http://localhost:62354/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://localhost:62354/css/syntax.css" /><link rel="stylesheet" href="http://localhost:62354/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:62354/">Kaga Blog</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Openresty</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on October 15, 2024
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="introduction-to-openresty">Introduction to OpenResty</h2>
<p>OpenResty is a dynamic web platform that integrates Nginx with the powerful Lua scripting language. It is designed to build scalable web applications, web services, and dynamic web gateways. By combining the high performance of Nginx with the flexibility of Lua, OpenResty enables developers to handle complex processing at the edge of the network.</p>
<h2 id="what-is-openresty">What is OpenResty?</h2>
<p>OpenResty extends Nginx by bundling it with a set of powerful Lua libraries and modules (known as LuaJIT). This allows embedding Lua scripts directly into the Nginx configuration, offering unparalleled flexibility for customizing request handling, routing, and response generation.</p>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>High Performance:</strong> Leverages Nginx&rsquo;s event-driven architecture and LuaJIT&rsquo;s speed for efficient request handling.</li>
<li><strong>Flexibility:</strong> Lua scripting enables dynamic content generation, complex routing, and custom logic.</li>
<li><strong>Extensibility:</strong> Easily integrates with various databases, caching systems, and other backend services.</li>
<li><strong>Modular Architecture:</strong> OpenResty modules simplify common tasks like routing, authentication, and data processing.</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before diving into OpenResty, ensure you have the following:</p>
<ul>
<li><strong>Basic Knowledge of Nginx:</strong> Understanding Nginxâ€™s configuration and request-handling mechanisms.</li>
<li><strong>Familiarity with Lua:</strong> Basic knowledge of Lua programming language.</li>
<li><strong>Development Environment:</strong> Access to a Unix-based system (e.g., Linux or macOS) or Windows with a compatible environment.</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="installing-dependencies">Installing Dependencies</h3>
<p>Depending on your operating system, you may need to install certain dependencies before installing OpenResty.</p>
<h4 id="for-ubuntudebian">For Ubuntu/Debian</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install -y curl gnupg2 ca-certificates lsb-release
</span></span></code></pre></div><h4 id="for-macos">For macOS</h4>
<p>Use <a href="https://brew.sh/">Homebrew</a> to install dependencies.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew update
</span></span><span style="display:flex;"><span>brew install curl
</span></span></code></pre></div><h3 id="installing-openresty">Installing OpenResty</h3>
<h4 id="using-official-packages-recommended">Using Official Packages (Recommended)</h4>
<p><strong>For Ubuntu/Debian:</strong></p>
<ol>
<li>
<p><strong>Add the OpenResty Repository:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get install -y software-properties-common
</span></span><span style="display:flex;"><span>sudo add-apt-repository -y <span style="color:#e6db74">&#34;deb https://openresty.org/package/ubuntu </span><span style="color:#66d9ef">$(</span>lsb_release -sc<span style="color:#66d9ef">)</span><span style="color:#e6db74"> main&#34;</span>
</span></span></code></pre></div></li>
<li>
<p><strong>Add the OpenResty GPG Key:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget -qO - https://openresty.org/package/pubkey.gpg | sudo apt-key add -
</span></span></code></pre></div></li>
<li>
<p><strong>Update the Package List and Install:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt-get update
</span></span><span style="display:flex;"><span>sudo apt-get install -y openresty
</span></span></code></pre></div></li>
</ol>
<p><strong>For macOS:</strong></p>
<p>Use Homebrew to install OpenResty.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install openresty/tap/openresty
</span></span></code></pre></div><h4 id="building-from-source">Building from Source</h4>
<ol>
<li>
<p><strong>Download the Source Code:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget https://openresty.org/download/openresty-VERSION.tar.gz
</span></span><span style="display:flex;"><span>tar zxvf openresty-VERSION.tar.gz
</span></span><span style="display:flex;"><span>cd openresty-VERSION/
</span></span></code></pre></div><p>Replace <code>VERSION</code> with the latest version number.</p>
</li>
<li>
<p><strong>Configure and Compile:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./configure --with-luajit
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>sudo make install
</span></span></code></pre></div></li>
</ol>
<h3 id="verifying-installation">Verifying Installation</h3>
<p>Check the installed OpenResty version.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openresty -v
</span></span></code></pre></div><p>You should see output similar to:</p>
<pre tabindex="0"><code>nginx version: openresty/1.19.3.1
</code></pre><h2 id="basic-configuration">Basic Configuration</h2>
<h3 id="understanding-openrestys-architecture">Understanding OpenRestyâ€™s Architecture</h3>
<p>OpenResty maintains Nginx&rsquo;s event-driven, asynchronous architecture while introducing Lua scripting capabilities. The primary components include:</p>
<ul>
<li><strong>Nginx Core:</strong> Handles HTTP server functionality.</li>
<li><strong>LuaJIT:</strong> A Just-In-Time Compiler for Lua, providing high-speed execution.</li>
<li><strong>ngx_lua Module:</strong> Embeds Lua into Nginxâ€™s request-processing phases.</li>
<li><strong>Additional Modules:</strong> OpenResty bundles various modules for enhanced functionality.</li>
</ul>
<h3 id="configuring-nginx-with-lua">Configuring Nginx with Lua</h3>
<p>The configuration files for OpenResty are similar to standard Nginx configurations but include Lua directives.</p>
<p><strong>Example Configuration (<code>/usr/local/openresty/nginx/conf/nginx.conf</code>):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">worker_processes</span>  <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">worker_connections</span>  <span style="color:#ae81ff">1024</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">include</span>       <span style="color:#e6db74">mime.types</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">default_type</span>  <span style="color:#e6db74">application/octet-stream</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sendfile</span>        <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">keepalive_timeout</span>  <span style="color:#ae81ff">65</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">default_type</span> <span style="color:#e6db74">&#39;text/plain&#39;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">ngx.say(&#39;Hello,</span> <span style="color:#e6db74">OpenResty!&#39;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="starting-openresty">Starting OpenResty</h3>
<p>Use the following command to start the OpenResty server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo openresty -c /usr/local/openresty/nginx/conf/nginx.conf
</span></span></code></pre></div><p>Visit <code>http://localhost:8080/</code> in your browser to see the &ldquo;Hello, OpenResty!&rdquo; message.</p>
<h2 id="hello-world-example">Hello World Example</h2>
<p>Letâ€™s create a simple &ldquo;Hello, World!&rdquo; application using OpenResty.</p>
<h3 id="step-1-create-a-configuration-file">Step 1: Create a Configuration File</h3>
<p>Create a new configuration file or edit the existing one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /usr/local/openresty/nginx/conf/nginx.conf
</span></span></code></pre></div><h3 id="step-2-add-lua-content">Step 2: Add Lua Content</h3>
<p>Insert the following content within the <code>server</code> block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/hello</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default_type</span> <span style="color:#e6db74">&#39;text/plain&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">ngx.say(&#39;Hello,</span> <span style="color:#e6db74">World</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">OpenResty!&#39;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="step-3-restart-openresty">Step 3: Restart OpenResty</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo openresty -s reload -c /usr/local/openresty/nginx/conf/nginx.conf
</span></span></code></pre></div><h3 id="step-4-test-the-endpoint">Step 4: Test the Endpoint</h3>
<p>Navigate to <code>http://localhost:8080/hello</code> to see the message.</p>
<h2 id="handling-web-requests">Handling Web Requests</h2>
<p>OpenResty excels at handling web requests with Lua scripts. Letâ€™s explore routing and processing different HTTP methods.</p>
<h3 id="routing-with-lua">Routing with Lua</h3>
<p>Implement dynamic routing using Lua.</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/api</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">request_path</span> = <span style="color:#e6db74">ngx.var.uri</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">request_path</span> == <span style="color:#e6db74">&#34;/api/users&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;User</span> <span style="color:#e6db74">List&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">request_path</span> == <span style="color:#e6db74">&#34;/api/orders&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Order</span> <span style="color:#e6db74">List&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.status</span> = <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Not</span> <span style="color:#e6db74">Found&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="processing-http-methods">Processing HTTP Methods</h3>
<p>Handle different HTTP methods (GET, POST, PUT, DELETE).</p>
<p><strong>Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/api/resource</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">method</span> = <span style="color:#e6db74">ngx.req.get_method()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">method</span> == <span style="color:#e6db74">&#34;GET&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Handling</span> <span style="color:#e6db74">GET</span> <span style="color:#e6db74">request&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">method</span> == <span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Handling</span> <span style="color:#e6db74">POST</span> <span style="color:#e6db74">request&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">method</span> == <span style="color:#e6db74">&#34;PUT&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Handling</span> <span style="color:#e6db74">PUT</span> <span style="color:#e6db74">request&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">method</span> == <span style="color:#e6db74">&#34;DELETE&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Handling</span> <span style="color:#e6db74">DELETE</span> <span style="color:#e6db74">request&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.status</span> = <span style="color:#ae81ff">405</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Method</span> <span style="color:#e6db74">Not</span> <span style="color:#e6db74">Allowed&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h2 id="working-with-lua-in-openresty">Working with Lua in OpenResty</h2>
<h3 id="lua-modules-and-libraries">Lua Modules and Libraries</h3>
<p>Leverage Lua modules to organize and reuse code.</p>
<p><strong>Example: Creating a Lua Module (<code>/usr/local/openresty/lualib/my_module.lua</code>):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#75715e">-- my_module.lua</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> _M <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_M</span>.<span style="color:#a6e22e">greet</span>(name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello, &#34;</span> <span style="color:#f92672">..</span> name <span style="color:#f92672">..</span> <span style="color:#e6db74">&#34;!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> _M
</span></span></code></pre></div><p><strong>Using the Module in Nginx Configuration:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/greet</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">default_type</span> <span style="color:#e6db74">&#39;text/plain&#39;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">my_module</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;my_module&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">message</span> = <span style="color:#e6db74">my_module.greet(&#34;OpenResty&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(message)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="impact-of-luajit">Impact of LuaJIT</h3>
<p>LuaJIT is a Just-In-Time Compiler for Lua, providing significant performance improvements.</p>
<ul>
<li>
<p><strong>Benefits:</strong></p>
<ul>
<li><strong>Speed:</strong> Lua code runs at speeds comparable to C.</li>
<li><strong>Efficiency:</strong> Enables writing high-performance applications without sacrificing ease of development.</li>
<li><strong>Memory Management:</strong> Efficient memory usage, crucial for high-concurrency environments.</li>
</ul>
</li>
<li>
<p><strong>Considerations:</strong></p>
<ul>
<li><strong>Compatibility:</strong> Ensure LuaJIT is compatible with the Lua code and libraries you intend to use.</li>
<li><strong>Limitations:</strong> Certain Lua features might be less efficient or unsupported; refer to LuaJIT documentation for specifics.</li>
</ul>
</li>
</ul>
<h2 id="interacting-with-databases">Interacting with Databases</h2>
<p>OpenResty seamlessly integrates with databases using Lua libraries.</p>
<h3 id="connecting-to-mysql">Connecting to MySQL</h3>
<p>Use the <code>lua-resty-mysql</code> library to interact with MySQL databases.</p>
<p><strong>Installation:</strong></p>
<p>Ensure you have LuaRocks installed, then install the library.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo luarocks install lua-resty-mysql
</span></span></code></pre></div><p><strong>Configuration Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/users</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">mysql</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;resty.mysql&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">db,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">mysql:new()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">db</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">instantiate</span> <span style="color:#e6db74">mysql:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">db:set_timeout(1000)</span> <span style="color:#e6db74">--</span> <span style="color:#ae81ff">1</span> <span style="color:#e6db74">sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err,</span> <span style="color:#e6db74">errno,</span> <span style="color:#e6db74">sqlstate</span> = <span style="color:#e6db74">db:connect</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">host</span> = <span style="color:#e6db74">&#34;127.0.0.1&#34;,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">port</span> = <span style="color:#ae81ff">3306</span><span style="color:#e6db74">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">database</span> = <span style="color:#e6db74">&#34;test_db&#34;,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">user</span> = <span style="color:#e6db74">&#34;test_user&#34;,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">password</span> = <span style="color:#e6db74">&#34;test_pass&#34;,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">charset</span> = <span style="color:#e6db74">&#34;utf8&#34;,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">max_packet_size</span> = <span style="color:#ae81ff">1048576</span><span style="color:#e6db74">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">connect:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err,</span> <span style="color:#e6db74">&#34;:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">errno,</span> <span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">sqlstate)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">res,</span> <span style="color:#e6db74">err,</span> <span style="color:#e6db74">errno,</span> <span style="color:#e6db74">sqlstate</span> = <span style="color:#e6db74">db:query(&#34;SELECT</span> <span style="color:#e6db74">*</span> <span style="color:#e6db74">FROM</span> <span style="color:#e6db74">users&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">res</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Bad</span> <span style="color:#e6db74">result:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err,</span> <span style="color:#e6db74">&#34;:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">errno,</span> <span style="color:#e6db74">&#34;:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">sqlstate,</span> <span style="color:#e6db74">&#34;.&#34;)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Put</span> <span style="color:#e6db74">it</span> <span style="color:#e6db74">into</span> <span style="color:#e6db74">the</span> <span style="color:#e6db74">connection</span> <span style="color:#e6db74">pool</span> <span style="color:#e6db74">of</span> <span style="color:#e6db74">size</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">with</span> <span style="color:#ae81ff">10</span> <span style="color:#e6db74">seconds</span> <span style="color:#e6db74">max</span> <span style="color:#e6db74">idle</span> <span style="color:#e6db74">time</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">db:set_keepalive(10000,</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">set</span> <span style="color:#e6db74">keepalive:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(vim.inspect(res))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ol>
<li><strong>Instantiate MySQL Object:</strong> Create a new MySQL instance.</li>
<li><strong>Set Timeout:</strong> Define a timeout for the connection.</li>
<li><strong>Connect to Database:</strong> Provide necessary connection parameters.</li>
<li><strong>Execute Query:</strong> Perform SQL queries and handle results.</li>
<li><strong>Connection Pooling:</strong> Use <code>set_keepalive</code> to reuse connections.</li>
</ol>
<h3 id="connecting-to-redis">Connecting to Redis</h3>
<p>Use the <code>lua-resty-redis</code> library to interact with Redis.</p>
<p><strong>Installation:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo luarocks install lua-resty-redis
</span></span></code></pre></div><p><strong>Configuration Example:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/cache</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">redis</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;resty.redis&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">red</span> = <span style="color:#e6db74">redis:new()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">red:set_timeout(1000)</span> <span style="color:#e6db74">--</span> <span style="color:#ae81ff">1</span> <span style="color:#e6db74">sec</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:connect(&#34;127.0.0.1&#34;,</span> <span style="color:#ae81ff">6379</span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">connect:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Optional:</span> <span style="color:#e6db74">authenticate</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">res,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:auth(&#34;your_password&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">res</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">authenticate:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Set</span> <span style="color:#e6db74">a</span> <span style="color:#e6db74">key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:set(&#34;my_key&#34;,</span> <span style="color:#e6db74">&#34;Hello,</span> <span style="color:#e6db74">Redis!&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">set</span> <span style="color:#e6db74">key:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Get</span> <span style="color:#e6db74">the</span> <span style="color:#e6db74">key</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">res,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:get(&#34;my_key&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">res</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">get</span> <span style="color:#e6db74">key:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">res</span> == <span style="color:#e6db74">ngx.null</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Key</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">found.&#34;)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(&#34;Retrieved</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">Redis:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">res)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Put</span> <span style="color:#e6db74">it</span> <span style="color:#e6db74">into</span> <span style="color:#e6db74">the</span> <span style="color:#e6db74">connection</span> <span style="color:#e6db74">pool</span> <span style="color:#e6db74">of</span> <span style="color:#e6db74">size</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">with</span> <span style="color:#ae81ff">10</span> <span style="color:#e6db74">seconds</span> <span style="color:#e6db74">max</span> <span style="color:#e6db74">idle</span> <span style="color:#e6db74">time</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:set_keepalive(10000,</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">set</span> <span style="color:#e6db74">keepalive:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ol>
<li><strong>Instantiate Redis Object:</strong> Create a new Redis instance.</li>
<li><strong>Set Timeout:</strong> Define a timeout for the connection.</li>
<li><strong>Connect to Redis Server:</strong> Provide Redis server address and port.</li>
<li><strong>Authenticate (Optional):</strong> Authenticate if Redis requires a password.</li>
<li><strong>Execute Commands:</strong> Perform Redis commands like <code>SET</code> and <code>GET</code>.</li>
<li><strong>Connection Pooling:</strong> Reuse connections using <code>set_keepalive</code>.</li>
</ol>
<h2 id="caching-strategies">Caching Strategies</h2>
<p>Implementing effective caching strategies can significantly enhance your application&rsquo;s performance.</p>
<h3 id="using-lua-for-caching">Using Lua for Caching</h3>
<p>Store frequently accessed data in memory to reduce database load.</p>
<p><strong>Example: Caching User Data</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/user</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">redis</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;resty.redis&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">cjson</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;cjson&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">red</span> = <span style="color:#e6db74">redis:new()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">red:set_timeout(1000)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Connect</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">Redis</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:connect(&#34;127.0.0.1&#34;,</span> <span style="color:#ae81ff">6379</span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">connect</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">Redis:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.exit(500)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Try</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">get</span> <span style="color:#e6db74">user</span> <span style="color:#e6db74">data</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">Redis</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">user_id</span> = <span style="color:#e6db74">ngx.var.arg_id</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">user_id</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;User</span> <span style="color:#e6db74">ID</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">provided&#34;)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">res,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:get(&#34;user:&#34;</span> <span style="color:#e6db74">..</span> <span style="color:#e6db74">user_id)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">res</span> == <span style="color:#e6db74">ngx.null</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">--</span> <span style="color:#e6db74">Data</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">in</span> <span style="color:#e6db74">cache,</span> <span style="color:#e6db74">fetch</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">database</span> <span style="color:#e6db74">(simulated)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">local</span> <span style="color:#e6db74">user_data</span> = {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">id</span> = <span style="color:#e6db74">user_id,</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">name</span> = <span style="color:#e6db74">&#34;John</span> <span style="color:#e6db74">Doe&#34;,</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">email</span> = <span style="color:#e6db74">&#34;john.doe@example.com&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">--</span> <span style="color:#e6db74">Simulate</span> <span style="color:#e6db74">database</span> <span style="color:#e6db74">delay</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.sleep(0.1)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">--</span> <span style="color:#e6db74">Store</span> <span style="color:#e6db74">in</span> <span style="color:#e6db74">Redis</span> <span style="color:#e6db74">with</span> <span style="color:#e6db74">TTL</span> <span style="color:#e6db74">of</span> <span style="color:#ae81ff">60</span> <span style="color:#e6db74">seconds</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">red:setex(&#34;user:&#34;</span> <span style="color:#e6db74">..</span> <span style="color:#e6db74">user_id,</span> <span style="color:#ae81ff">60</span><span style="color:#e6db74">,</span> <span style="color:#e6db74">cjson.encode(user_data))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(cjson.encode(user_data))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">else</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">--</span> <span style="color:#e6db74">Data</span> <span style="color:#e6db74">found</span> <span style="color:#e6db74">in</span> <span style="color:#e6db74">cache</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(res)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Set</span> <span style="color:#e6db74">keepalive</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">ok,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">red:set_keepalive(10000,</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">ok</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">set</span> <span style="color:#e6db74">keepalive:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ol>
<li><strong>Attempt to Retrieve Data from Redis:</strong> Check if user data is present in the Redis cache.</li>
<li><strong>Fetch from Database if Cache Miss:</strong> If not found, retrieve from the database (simulated here).</li>
<li><strong>Store Fetched Data in Redis:</strong> Cache the retrieved data with an expiration time (<code>TTL</code>).</li>
<li><strong>Respond to Client:</strong> Return the user data, either from cache or database.</li>
</ol>
<h3 id="utilizing-nginx-caching">Utilizing Nginx Caching</h3>
<p>Leverage Nginx&rsquo;s built-in caching mechanisms for static and dynamic content.</p>
<p><strong>Example: Caching Responses with <code>proxy_cache</code></strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_cache_path</span> <span style="color:#e6db74">/var/cache/nginx</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=my_cache:10m</span> <span style="color:#e6db74">max_size=10g</span> <span style="color:#e6db74">inactive=60m</span> <span style="color:#e6db74">use_temp_path=off</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/api</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_cache</span> <span style="color:#e6db74">my_cache</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://backend_server</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Cache based on query parameters
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">proxy_cache_key</span> <span style="color:#e6db74">&#34;</span>$scheme$request_method$host$request_uri&#34;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Cache validity
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">proxy_cache_valid</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">302</span> <span style="color:#ae81ff">10m</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_cache_valid</span> <span style="color:#ae81ff">404</span>      <span style="color:#ae81ff">1m</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ol>
<li><strong>Define Cache Path and Zone:</strong> Configure where and how Nginx stores cached data.</li>
<li><strong>Enable Caching in Location Block:</strong> Apply caching to specific routes or endpoints.</li>
<li><strong>Set Cache Keys:</strong> Define how cache entries are identified.</li>
<li><strong>Specify Cache Validity:</strong> Determine how long different response statuses are cached.</li>
</ol>
<h2 id="security-best-practices">Security Best Practices</h2>
<p>Ensuring the security of your OpenResty applications is paramount. Implement the following best practices to safeguard your applications.</p>
<h3 id="input-validation">Input Validation</h3>
<p>Always validate and sanitize user inputs to prevent injections and other attacks.</p>
<p><strong>Example: Validating Query Parameters</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/search</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">args</span> = <span style="color:#e6db74">ngx.req.get_uri_args()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">query</span> = <span style="color:#e6db74">args.query</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">query</span> <span style="color:#e6db74">or</span> <span style="color:#75715e">#query &lt; 3 then
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#e6db74">ngx.status</span> = <span style="color:#ae81ff">400</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Invalid</span> <span style="color:#e6db74">query</span> <span style="color:#e6db74">parameter&#34;)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">--</span> <span style="color:#e6db74">Proceed</span> <span style="color:#e6db74">with</span> <span style="color:#e6db74">processing</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(&#34;Search</span> <span style="color:#e6db74">results</span> <span style="color:#e6db74">for:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">query)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="securing-lua-scripts">Securing Lua Scripts</h3>
<p>Restrict access to Lua scripts and handle errors gracefully.</p>
<p><strong>Example: Error Handling in Lua</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span>       <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span>  <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">error_page</span> <span style="color:#ae81ff">500</span> <span style="color:#ae81ff">502</span> <span style="color:#ae81ff">503</span> <span style="color:#ae81ff">504</span> <span style="color:#e6db74">/50x.html</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> = <span style="color:#e6db74">/50x.html</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">root</span>   <span style="color:#e6db74">/usr/share/nginx/html</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/data</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">status,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">pcall(function()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">--</span> <span style="color:#e6db74">Your</span> <span style="color:#e6db74">Lua</span> <span style="color:#e6db74">code</span> <span style="color:#e6db74">here</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">error(&#34;Simulated</span> <span style="color:#e6db74">error&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">status</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Lua</span> <span style="color:#e6db74">error:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.status</span> = <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Internal</span> <span style="color:#e6db74">Server</span> <span style="color:#e6db74">Error&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="rate-limiting">Rate Limiting</h3>
<p>Prevent abuse by limiting the number of requests a client can make.</p>
<p><strong>Example: Implementing Rate Limiting with Lua</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lua_shared_dict</span> <span style="color:#e6db74">limits</span> <span style="color:#ae81ff">10m</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/api/</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">access_by_lua_block</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">local</span> <span style="color:#e6db74">limit</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;resty.limit.req&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">local</span> <span style="color:#e6db74">lim,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">limit.new(&#34;limits&#34;,</span> <span style="color:#ae81ff">100</span><span style="color:#e6db74">,</span> <span style="color:#ae81ff">200</span><span style="color:#e6db74">)</span> <span style="color:#e6db74">--</span> <span style="color:#ae81ff">100</span> <span style="color:#e6db74">requests</span> <span style="color:#e6db74">per</span> <span style="color:#e6db74">second</span> <span style="color:#e6db74">with</span> <span style="color:#e6db74">burst</span> <span style="color:#e6db74">of</span> <span style="color:#ae81ff">200</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">lim</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">instantiate</span> <span style="color:#e6db74">a</span> <span style="color:#e6db74">resty.limit.req</span> <span style="color:#e6db74">object:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">return</span> <span style="color:#e6db74">ngx.exit(500)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">local</span> <span style="color:#e6db74">key</span> = <span style="color:#e6db74">ngx.var.binary_remote_addr</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">local</span> <span style="color:#e6db74">delay,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">lim:incoming(key,</span> <span style="color:#e6db74">true)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">delay</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">if</span> <span style="color:#e6db74">err</span> == <span style="color:#e6db74">&#34;rejected&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">return</span> <span style="color:#e6db74">ngx.exit(429)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">limit</span> <span style="color:#e6db74">request:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">return</span> <span style="color:#e6db74">ngx.exit(500)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">if</span> <span style="color:#e6db74">delay</span> <span style="color:#e6db74">&gt;=</span> <span style="color:#ae81ff">0</span><span style="color:#e6db74">.001</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">ngx.sleep(delay)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">proxy_pass</span> <span style="color:#e6db74">http://backend_server</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ol>
<li><strong>Define Shared Dictionary:</strong> Allocate shared memory for storing rate-limiting data.</li>
<li><strong>Instantiate Rate Limiter:</strong> Use <code>resty.limit.req</code> to set request limits.</li>
<li><strong>Identify Clients:</strong> Use clientâ€™s IP address as the identifier.</li>
<li><strong>Enforce Limits:</strong> Allow or reject requests based on defined thresholds.</li>
</ol>
<h2 id="performance-optimization">Performance Optimization</h2>
<p>Optimize your OpenResty applications to handle high traffic efficiently.</p>
<h3 id="efficient-lua-coding">Efficient Lua Coding</h3>
<p>Write optimized Lua code to reduce execution time and memory usage.</p>
<p><strong>Example: Avoiding Unnecessary Table Creations</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#75715e">-- Inefficient</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generate_users</span>(n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> users <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, n <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        users[i] <span style="color:#f92672">=</span> {id <span style="color:#f92672">=</span> i, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#f92672">..</span> i}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> users
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Efficient</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">local</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generate_users</span>(n)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> users <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, n <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        users[i] <span style="color:#f92672">=</span> {id <span style="color:#f92672">=</span> i, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#f92672">..</span> i}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> users
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div><p>(Note: The above example shows a common pattern; optimize further as needed.)</p>
<h3 id="nginx-optimization">Nginx Optimization</h3>
<p>Tweak Nginx settings for better performance.</p>
<p><strong>Example: Increasing Worker Connections</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">worker_processes</span> <span style="color:#e6db74">auto</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">events</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">worker_connections</span> <span style="color:#ae81ff">4096</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">multi_accept</span> <span style="color:#66d9ef">on</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li><strong><code>worker_processes auto</code>:</strong> Automatically sets the number of worker processes based on available CPU cores.</li>
<li><strong><code>worker_connections</code>:</strong> Increases the number of simultaneous connections each worker can handle.</li>
<li><strong><code>multi_accept on</code>:</strong> Workers accept all new connections at once, improving connection handling under heavy load.</li>
</ul>
<h2 id="debugging-and-logging">Debugging and Logging</h2>
<p>Effective debugging and logging are essential for maintaining and troubleshooting applications.</p>
<h3 id="setting-up-logging">Setting Up Logging</h3>
<p>Configure Nginx and Lua to log important events and errors.</p>
<p><strong>Nginx Logging Configuration:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">log_format</span> <span style="color:#e6db74">main</span> <span style="color:#e6db74">&#39;</span>$remote_addr <span style="color:#e6db74">-</span> $remote_user <span style="color:#e6db74">[</span>$time_local] <span style="color:#e6db74">&#34;</span>$request&#34; <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;</span>$status $body_bytes_sent <span style="color:#e6db74">&#34;</span>$http_referer&#34; <span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;&#34;</span>$http_user_agent&#34; <span style="color:#e6db74">&#34;</span>$http_x_forwarded_for&#34;&#39;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">access_log</span> <span style="color:#e6db74">/var/log/nginx/access.log</span> <span style="color:#e6db74">main</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">error_log</span> <span style="color:#e6db74">/var/log/nginx/error.log</span> <span style="color:#e6db74">warn</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">ngx.log(ngx.INFO,</span> <span style="color:#e6db74">&#34;Handling</span> <span style="color:#e6db74">request</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">/&#34;)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.say(&#34;Hello,</span> <span style="color:#e6db74">OpenResty!&#34;)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p><strong>Lua Logging:</strong></p>
<p>Use <code>ngx.log</code> to log messages at various levels (DEBUG, INFO, WARN, ERR, etc.).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>ngx.log(ngx.INFO, <span style="color:#e6db74">&#34;This is an informational message&#34;</span>)
</span></span><span style="display:flex;"><span>ngx.log(ngx.ERR, <span style="color:#e6db74">&#34;This is an error message&#34;</span>)
</span></span></code></pre></div><h3 id="debugging-lua-scripts">Debugging Lua Scripts</h3>
<p>Use LuaJITâ€™s built-in debugging tools and external libraries.</p>
<p><strong>Using <code>debug</code> Library:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>content_by_lua_block {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">faulty_function</span>()
</span></span><span style="display:flex;"><span>        error(<span style="color:#e6db74">&#34;Something went wrong!&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> status, err <span style="color:#f92672">=</span> pcall(faulty_function)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> status <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        ngx.log(ngx.ERR, <span style="color:#e6db74">&#34;Error: &#34;</span>, err)
</span></span><span style="display:flex;"><span>        ngx.status <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>
</span></span><span style="display:flex;"><span>        ngx.say(<span style="color:#e6db74">&#34;Internal Server Error&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>External Libraries:</strong></p>
<ul>
<li><strong>Lua Inspect:</strong> For inspecting variables and data structures.</li>
<li><strong>Mobdebug:</strong> For remote debugging with zero-brain.</li>
</ul>
<p><strong>Example: Remote Debugging with Mobdebug</strong></p>
<ol>
<li>
<p><strong>Install Mobdebug:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>luarocks install mobdebug
</span></span></code></pre></div></li>
<li>
<p><strong>Configure Lua Code:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>content_by_lua_block {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> mobdebug <span style="color:#f92672">=</span> require <span style="color:#e6db74">&#34;mobdebug&#34;</span>
</span></span><span style="display:flex;"><span>    mobdebug.listen() <span style="color:#75715e">-- Wait for debugger to connect</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">-- Your Lua code here</span>
</span></span><span style="display:flex;"><span>    ngx.say(<span style="color:#e6db74">&#34;Debugging OpenResty with Mobdebug&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p><strong>Connect Debugger:</strong></p>
<p>Use an IDE like ZeroBrane Studio to connect to Mobdebug.</p>
</li>
</ol>
<h2 id="deployment">Deployment</h2>
<p>Deploy OpenResty applications efficiently to production environments.</p>
<h3 id="preparing-for-production">Preparing for Production</h3>
<ol>
<li>
<p><strong>Optimize Configuration:</strong></p>
<ul>
<li>Disable unnecessary modules and logging.</li>
<li>Fine-tune worker processes and connections.</li>
</ul>
</li>
<li>
<p><strong>Secure the Server:</strong></p>
<ul>
<li>Use HTTPS with TLS certificates.</li>
<li>Implement firewall rules and security groups.</li>
</ul>
</li>
<li>
<p><strong>Test Thoroughly:</strong></p>
<ul>
<li>Perform load testing and stress testing.</li>
<li>Ensure all functionalities work as expected.</li>
</ul>
</li>
</ol>
<h3 id="managing-configuration">Managing Configuration</h3>
<p>Use environment variables and separate configuration files for different environments.</p>
<p><strong>Example: Using Environment Variables in Lua</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span>content_by_lua_block {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> db_host <span style="color:#f92672">=</span> os.getenv(<span style="color:#e6db74">&#34;DB_HOST&#34;</span>) <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">local</span> db_port <span style="color:#f92672">=</span> tonumber(os.getenv(<span style="color:#e6db74">&#34;DB_PORT&#34;</span>)) <span style="color:#f92672">or</span> <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ngx.say(<span style="color:#e6db74">&#34;Database Host: &#34;</span>, db_host)
</span></span><span style="display:flex;"><span>    ngx.say(<span style="color:#e6db74">&#34;Database Port: &#34;</span>, db_port)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="continuous-integration-and-deployment-cicd">Continuous Integration and Deployment (CI/CD)</h3>
<p>Automate the build, test, and deployment processes using CI/CD tools.</p>
<p><strong>Example: GitLab CI Configuration (<code>.gitlab-ci.yml</code>):</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;Building OpenResty application...&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#75715e"># Add build commands here</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">artifacts</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">build/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">test</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;Running tests...&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#75715e"># Add test commands here</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">script</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">echo &#34;Deploying to production...&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ssh user@server &#34;sudo systemctl restart openresty&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">only</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">master</span>
</span></span></code></pre></div><h2 id="advanced-topics">Advanced Topics</h2>
<h3 id="microservices-with-openresty">Microservices with OpenResty</h3>
<p>Leverage OpenResty for building microservices architectures.</p>
<p><strong>Key Considerations:</strong></p>
<ul>
<li><strong>Service Isolation:</strong> Each microservice should handle a specific functionality.</li>
<li><strong>Inter-Service Communication:</strong> Use HTTP/HTTPS, gRPC, or message queues (e.g., Kafka) for communication between services.</li>
<li><strong>Service Discovery:</strong> Implement service discovery mechanisms to manage dynamic service instances.</li>
<li><strong>Load Balancing:</strong> Utilize Nginx&rsquo;s load balancing features or service meshes like Istio.</li>
</ul>
<p><strong>Example: Building a Simple Microservice</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/service1</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">--</span> <span style="color:#e6db74">Service</span> <span style="color:#ae81ff">1</span> <span style="color:#e6db74">logic</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(&#34;Response</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">Service</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">&#34;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">location</span> <span style="color:#e6db74">/service2</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">--</span> <span style="color:#e6db74">Service</span> <span style="color:#ae81ff">2</span> <span style="color:#e6db74">logic</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">ngx.say(&#34;Response</span> <span style="color:#e6db74">from</span> <span style="color:#e6db74">Service</span> <span style="color:#ae81ff">2</span><span style="color:#e6db74">&#34;)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><h3 id="websockets-integration">WebSockets Integration</h3>
<p>Enable real-time communication using WebSockets.</p>
<p><strong>Example: Handling WebSockets with Lua</strong></p>
<ol>
<li>
<p><strong>Install lua-resty-websocket:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo luarocks install lua-resty-websocket
</span></span></code></pre></div></li>
<li>
<p><strong>Configuration:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">server</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">location</span> <span style="color:#e6db74">/ws</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">content_by_lua_block</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">local</span> <span style="color:#e6db74">websocket</span> = <span style="color:#e6db74">require</span> <span style="color:#e6db74">&#34;resty.websocket.server&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">local</span> <span style="color:#e6db74">wb,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">websocket:new</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">timeout</span> = <span style="color:#ae81ff">5000</span><span style="color:#e6db74">,</span>  <span style="color:#e6db74">--</span> <span style="color:#e6db74">in</span> <span style="color:#e6db74">milliseconds</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">max_payload_len</span> = <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">wb</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">new</span> <span style="color:#e6db74">websocket:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">return</span> <span style="color:#e6db74">ngx.exit(444)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">while</span> <span style="color:#e6db74">true</span> <span style="color:#e6db74">do</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">local</span> <span style="color:#e6db74">data,</span> <span style="color:#e6db74">typ,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">wb:recv_frame()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">data</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">if</span> <span style="color:#e6db74">err</span> ~<span style="color:#e6db74">=</span> <span style="color:#e6db74">&#34;timeout&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">receive</span> <span style="color:#e6db74">frame:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">wb:send_close(1002,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">receive</span> <span style="color:#e6db74">frame&#34;)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">if</span> <span style="color:#e6db74">typ</span> == <span style="color:#e6db74">&#34;close&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">local</span> <span style="color:#e6db74">bytes,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">wb:send_close(1000)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">bytes</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">send</span> <span style="color:#e6db74">close:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">typ</span> == <span style="color:#e6db74">&#34;ping&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">local</span> <span style="color:#e6db74">bytes,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">wb:send_pong()</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">bytes</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">send</span> <span style="color:#e6db74">pong:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">typ</span> == <span style="color:#e6db74">&#34;pong&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">--</span> <span style="color:#e6db74">handle</span> <span style="color:#e6db74">pong</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">typ</span> == <span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">--</span> <span style="color:#e6db74">Echo</span> <span style="color:#e6db74">the</span> <span style="color:#e6db74">received</span> <span style="color:#e6db74">message</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">local</span> <span style="color:#e6db74">bytes,</span> <span style="color:#e6db74">err</span> = <span style="color:#e6db74">wb:send_text(data)</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">if</span> <span style="color:#e6db74">not</span> <span style="color:#e6db74">bytes</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">ngx.log(ngx.ERR,</span> <span style="color:#e6db74">&#34;Failed</span> <span style="color:#e6db74">to</span> <span style="color:#e6db74">send</span> <span style="color:#e6db74">text:</span> <span style="color:#e6db74">&#34;,</span> <span style="color:#e6db74">err)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">return</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">elseif</span> <span style="color:#e6db74">typ</span> == <span style="color:#e6db74">&#34;binary&#34;</span> <span style="color:#e6db74">then</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">--</span> <span style="color:#e6db74">Handle</span> <span style="color:#e6db74">binary</span> <span style="color:#e6db74">data</span> <span style="color:#e6db74">if</span> <span style="color:#e6db74">needed</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">end</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div></li>
</ol>
<p><strong>Explanation:</strong></p>
<ol>
<li><strong>Establish WebSocket Connection:</strong> Upgrade the HTTP request to a WebSocket connection.</li>
<li><strong>Handle Frames:</strong> Receive and respond to different frame types (<code>text</code>, <code>binary</code>, <code>ping</code>, <code>pong</code>, <code>close</code>).</li>
<li><strong>Echo Messages:</strong> Echo back received text messages for demonstration.</li>
</ol>
<h3 id="api-gateway-with-openresty">API Gateway with OpenResty</h3>
<p>Use OpenResty as an API Gateway to manage, route, and secure API traffic.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Routing and Load Balancing:</strong> Direct requests to appropriate backend services.</li>
<li><strong>Authentication and Authorization:</strong> Implement security measures to protect APIs.</li>
<li><strong>Rate Limiting:</strong> Control the rate of incoming requests.</li>
<li><strong>Caching and Compression:</strong> Optimize performance by caching responses and compressing data.</li>
</ul>
<p><strong>Example: Simple API Gateway Configuration</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nginx" data-lang="nginx"><span style="display:flex;"><span><span style="color:#66d9ef">http</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lua_shared_dict</span> <span style="color:#e6db74">limits</span> <span style="color:#ae81ff">10m</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">proxy_cache_path</span> <span style="color:#e6db74">/var/cache/nginx</span> <span style="color:#e6db74">levels=1:2</span> <span style="color:#e6db74">keys_zone=my_cache:10m</span> <span style="color:#e6db74">max_size=1g</span> <span style="color:#e6db74">inactive=60m</span> <span style="color:#e6db74">use_temp_path=off</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server_name</span> <span style="color:#e6db74">localhost</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/api/service1</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://service1_backend</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Caching
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">proxy_cache</span> <span style="color:#e6db74">my_cache</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_cache_valid</span> <span style="color:#ae81ff">200</span> <span style="color:#ae81ff">302</span> <span style="color:#ae81ff">10m</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_cache_valid</span> <span style="color:#ae81ff">404</span>      <span style="color:#ae81ff">1m</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">location</span> <span style="color:#e6db74">/api/service2</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_pass</span> <span style="color:#e6db74">http://service2_backend</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">Host</span> $host;
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">proxy_set_header</span> <span style="color:#e6db74">X-Real-IP</span> $remote_addr;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Rate Limiting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">access_by_lua_block</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">--</span> <span style="color:#e6db74">Implement</span> <span style="color:#e6db74">rate</span> <span style="color:#e6db74">limiting</span> <span style="color:#e6db74">logic</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">location</span> <span style="color:#e6db74">/auth</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">access_by_lua_block</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">--</span> <span style="color:#e6db74">Implement</span> <span style="color:#e6db74">authentication</span> <span style="color:#e6db74">logic</span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">proxy_pass</span> <span style="color:#e6db74">http://auth_backend</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li><strong>Routing:</strong> Direct API requests to respective backend services.</li>
<li><strong>Caching:</strong> Cache responses from <code>service1_backend</code> to improve performance.</li>
<li><strong>Rate Limiting:</strong> Apply rate limiting on <code>service2_backend</code>.</li>
<li><strong>Authentication:</strong> Add authentication checks for sensitive endpoints.</li>
</ul>
<h2 id="resources-and-further-reading">Resources and Further Reading</h2>
<h3 id="official-documentation">Official Documentation</h3>
<ul>
<li><strong>OpenResty Official Site:</strong> <a href="https://openresty.org/">https://openresty.org/</a></li>
<li><strong>OpenResty GitHub Repository:</strong> <a href="https://github.com/openresty/openresty">https://github.com/openresty/openresty</a></li>
<li><strong>LuaJIT Documentation:</strong> <a href="https://luajit.org/">https://luajit.org/</a></li>
<li><strong>lua-resty Libraries:</strong> <a href="https://github.com/openresty/lua-resty-*">https://github.com/openresty/lua-resty-*</a></li>
</ul>
<h3 id="books-and-articles">Books and Articles</h3>
<ul>
<li><strong>&ldquo;OpenResty: High Performance Web Platform Using Lua&rdquo;</strong> by Jay Huang</li>
<li><strong>&ldquo;Programming OpenResty&rdquo;</strong> by Noel Rappin</li>
<li><strong>&ldquo;Mastering OpenResty&rdquo;</strong> by Dr. Mai Phan and Jay Huang</li>
</ul>
<h3 id="online-tutorials-and-courses">Online Tutorials and Courses</h3>
<ul>
<li><strong>OpenResty Tutorial by OpenResty.org:</strong> <a href="https://openresty.org/en/">https://openresty.org/en/</a></li>
<li><strong>OpenResty Introduction on DigitalOcean:</strong> <a href="https://www.digitalocean.com/community/tutorials/how-to-install-openresty-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-install-openresty-on-ubuntu-18-04</a></li>
<li><strong>YouTube Video Tutorials:</strong>
<ul>
<li><a href="https://www.youtube.com/watch?v=example">OpenResty Course - Understanding the Basics</a></li>
<li><a href="https://www.youtube.com/watch?v=example">Advanced OpenResty Configurations</a></li>
</ul>
</li>
</ul>
<h3 id="community-and-support">Community and Support</h3>
<ul>
<li><strong>OpenResty Mailing List:</strong> Subscribe to stay updated with the latest news and updates.</li>
<li><strong>OpenResty Forums:</strong> Participate in discussions and seek help from the community.</li>
<li><strong>Stack Overflow:</strong> Tag questions with <code>openresty</code> or <code>lua</code> to get assistance.</li>
<li><strong>Gophers Slack:</strong> Join the <a href="https://gophers.slack.com/">Gophers Slack Workspace</a> for real-time discussions and support.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>OpenResty is a powerful platform that combines the robust capabilities of Nginx with the flexibility of Lua scripting. This comprehensive tutorial has walked you through the essentials of setting up, configuring, and optimizing OpenResty for various web applications. By mastering OpenResty, you can build high-performance, scalable, and secure web services tailored to your specific needs.</p>
<p>Remember, the key to proficiency is consistent practice and active participation in the community. Leverage the resources provided, experiment with different configurations, and contribute to open-source projects to deepen your understanding and expertise in OpenResty.</p>
<hr>
<p><em>Happy Coding!</em></p>


        
          <div class="blog-tags">
            
              
              <a href="http://localhost:62354/tags/systemdesign/">SystemDesign</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://localhost:62354/post/1_go_data_structure/" data-toggle="tooltip" data-placement="top" title="Go&#39;s Common Data Structures">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="http://localhost:62354/post/0_nginx/" data-toggle="tooltip" data-placement="top" title="Nginx">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://localhost:62354/">Kaga Blog</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.134.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="http://localhost:62354/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="http://localhost:62354/js/load-photoswipe.js"></script>










    
  </body>
</html>

