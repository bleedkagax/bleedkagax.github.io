<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=en-us dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Docker - Kaga Blog</title>
<meta name=theme-color><meta name=description content="Docker Guidelines
Dockerfile Best Practices
Use Official Base Images

Why: Official images are maintained and frequently updated, ensuring reliability and security.
How:
FROM node:14-alpine


Minimize Image Size


Why: Smaller images lead to faster deployments and reduced storage costs.


How:

Use minimal base images (e.g., Alpine Linux).
Remove unnecessary packages and files.
Combine commands to reduce layers.

RUN apt-get update && \
    apt-get install -y package1 package2 && \
    rm -rf /var/lib/apt/lists/*
"><meta name=author content="Kaga Blog"><link rel="preload stylesheet" as=style href=https://bleedkagax.github.io/main.min.css><link rel=preload as=image href=https://bleedkagax.github.io/theme.png><script defer src=https://bleedkagax.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://bleedkagax.github.io/favicon.ico><link rel=apple-touch-icon href=https://bleedkagax.github.io/apple-touch-icon.png><meta name=generator content="Hugo 0.134.0"><meta itemprop=name content="Docker"><meta itemprop=description content="Docker Guidelines Dockerfile Best Practices Use Official Base Images Why: Official images are maintained and frequently updated, ensuring reliability and security. How: FROM node:14-alpine Minimize Image Size Why: Smaller images lead to faster deployments and reduced storage costs.
How:
Use minimal base images (e.g., Alpine Linux). Remove unnecessary packages and files. Combine commands to reduce layers. RUN apt-get update && \ apt-get install -y package1 package2 && \ rm -rf /var/lib/apt/lists/* "><meta itemprop=datePublished content="2024-10-15T00:00:00+00:00"><meta itemprop=dateModified content="2024-10-15T00:00:00+00:00"><meta itemprop=wordCount content="837"><meta itemprop=keywords content="SystemDesign"><meta property="og:url" content="https://bleedkagax.github.io/post/4_docker/"><meta property="og:site_name" content="Kaga Blog"><meta property="og:title" content="Docker"><meta property="og:description" content="Docker Guidelines Dockerfile Best Practices Use Official Base Images Why: Official images are maintained and frequently updated, ensuring reliability and security. How: FROM node:14-alpine Minimize Image Size Why: Smaller images lead to faster deployments and reduced storage costs.
How:
Use minimal base images (e.g., Alpine Linux). Remove unnecessary packages and files. Combine commands to reduce layers. RUN apt-get update && \ apt-get install -y package1 package2 && \ rm -rf /var/lib/apt/lists/* "><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-15T00:00:00+00:00"><meta property="article:tag" content="SystemDesign"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker"><meta name=twitter:description content="Docker Guidelines Dockerfile Best Practices Use Official Base Images Why: Official images are maintained and frequently updated, ensuring reliability and security. How: FROM node:14-alpine Minimize Image Size Why: Smaller images lead to faster deployments and reduced storage costs.
How:
Use minimal base images (e.g., Alpine Linux). Remove unnecessary packages and files. Combine commands to reduce layers. RUN apt-get update && \ apt-get install -y package1 package2 && \ rm -rf /var/lib/apt/lists/* "><link rel=canonical href=https://bleedkagax.github.io/post/4_docker/></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-[--w] px-8 lg:justify-center"><div class="relative z-50 ltr:mr-auto rtl:ml-auto flex items-center"><a class="-translate-y-[1px] text-2xl font-medium" href=https://bleedkagax.github.io/>Kaga Blog</a><div class="btn-dark text-[0] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 ltr:-mr-8 rtl:-ml-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-[--w] px-8 pb-16 pt-14 dark:prose-invert"><article><header class=mb-14><h1 class="!my-0 pb-2.5">Docker</h1><div class="text-xs antialiased opacity-60"><time>Oct 15, 2024</time></div></header><section><h1 id=docker-guidelines>Docker Guidelines</h1><h2 id=dockerfile-best-practices>Dockerfile Best Practices</h2><h3 id=use-official-base-images>Use Official Base Images</h3><ul><li><strong>Why</strong>: Official images are maintained and frequently updated, ensuring reliability and security.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:14-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h3 id=minimize-image-size>Minimize Image Size</h3><ul><li><p><strong>Why</strong>: Smaller images lead to faster deployments and reduced storage costs.</p></li><li><p><strong>How</strong>:</p><ul><li>Use minimal base images (e.g., Alpine Linux).</li><li>Remove unnecessary packages and files.</li><li>Combine commands to reduce layers.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    apt-get install -y package1 package2 <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    rm -rf /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h3 id=leverage-caching>Leverage Caching</h3><ul><li><p><strong>Why</strong>: Utilizing Docker‚Äôs layer caching speeds up builds.</p></li><li><p><strong>How</strong>:</p><ul><li>Order commands from least to most frequently changing.</li><li>Place frequently changing commands towards the bottom.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>COPY</span> package.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h3 id=use-multi-stage-builds>Use Multi-Stage Builds</h3><ul><li><strong>Why</strong>: Reduce final image size by excluding build dependencies.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> golang:1.16 AS builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> go build -o myapp<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> alpine:latest</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /root/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /app/myapp .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;./myapp&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h3 id=optimize-layer-usage>Optimize Layer Usage</h3><ul><li><strong>Why</strong>: Fewer layers can lead to more efficient images.</li><li><strong>How</strong>:<ul><li>Combine related commands using <code>&&</code>.</li><li>Clean up temporary files within the same <code>RUN</code> statement.</li></ul></li></ul><h3 id=dockerignore-file>.dockerignore File</h3><ul><li><strong>Why</strong>: Excludes unnecessary files from the build context, speeding up builds and reducing image size.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>node_modules
</span></span><span style=display:flex><span>*.log
</span></span><span style=display:flex><span>.git
</span></span></code></pre></div></li></ul><h3 id=specify-exact-versions>Specify Exact Versions</h3><ul><li><strong>Why</strong>: Ensures consistent builds by avoiding unexpected updates.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.8.10-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h3 id=run-as-non-root-user>Run as Non-Root User</h3><ul><li><strong>Why</strong>: Enhances security by minimizing the potential impact of container compromises.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> useradd -m appuser<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> appuser</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div></li></ul><h2 id=image-versioning-and-tagging>Image Versioning and Tagging</h2><ul><li><p><strong>Consistency</strong>: Always tag images with specific versions rather than <code>latest</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker build -t myapp:1.0.0 .
</span></span></code></pre></div></li><li><p><strong>Semantic Versioning</strong>: Use semantic versioning (MAJOR.MINOR.PATCH) to indicate changes.</p></li><li><p><strong>Automated Tags</strong>: Integrate with CI/CD to automate version tagging based on commits or releases.</p></li></ul><h2 id=security-best-practices>Security Best Practices</h2><h3 id=regularly-update-images>Regularly Update Images</h3><ul><li><strong>Action</strong>: Rebuild images with the latest base images and dependencies to include security patches.</li></ul><h3 id=scan-images-for-vulnerabilities>Scan Images for Vulnerabilities</h3><ul><li><strong>Tools</strong>: Use scanners like <strong>Clair</strong>, <strong>Trivy</strong>, or <strong>Docker Security Scanning</strong>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>trivy image myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=limit-container-privileges>Limit Container Privileges</h3><ul><li><p><strong>Action</strong>:</p><ul><li>Avoid running containers as root.</li><li>Use Docker‚Äôs <code>--cap-drop</code> and <code>--cap-add</code> to fine-tune capabilities.</li><li>Enable read-only file systems when possible.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --cap-drop<span style=color:#f92672>=</span>ALL --read-only myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=use-secrets-management>Use Secrets Management</h3><ul><li><p><strong>Action</strong>: Store sensitive data outside images using Docker Secrets or environment variables managed securely.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker secret create db_password ./db_password.txt
</span></span></code></pre></div></li></ul><h2 id=resource-management>Resource Management</h2><h3 id=set-resource-limits>Set Resource Limits</h3><ul><li><strong>Why</strong>: Prevent containers from consuming excessive resources, ensuring system stability.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -m 512m --cpus<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.0&#34;</span> myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=monitor-resource-usage>Monitor Resource Usage</h3><ul><li><strong>Tools</strong>: Utilize monitoring solutions like <strong>Prometheus</strong>, <strong>Grafana</strong>, or <strong>Docker Stats</strong>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker stats
</span></span></code></pre></div></li></ul><h2 id=networking>Networking</h2><h3 id=use-user-defined-networks>Use User-Defined Networks</h3><ul><li><strong>Why</strong>: Provides better isolation and DNS-based service discovery.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker network create mynetwork
</span></span><span style=display:flex><span>docker run --network<span style=color:#f92672>=</span>mynetwork myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=manage-port-exposure>Manage Port Exposure</h3><ul><li><p><strong>Action</strong>:</p><ul><li>Only expose necessary ports.</li><li>Use Docker‚Äôs port mapping to manage accessibility.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -p 8080:80 myapp:1.0.0
</span></span></code></pre></div></li></ul><h2 id=data-management>Data Management</h2><h3 id=use-volumes-for-persistent-data>Use Volumes for Persistent Data</h3><ul><li><strong>Why</strong>: Ensures data persists beyond the container lifecycle.</li><li><strong>How</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker volume create mydata
</span></span><span style=display:flex><span>docker run -v mydata:/var/lib/data myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=avoid-storing-data-in-images>Avoid Storing Data in Images</h3><ul><li><strong>Action</strong>: Do not embed dynamic or persistent data within Docker images. Use volumes or external storage solutions instead.</li></ul><h2 id=naming-conventions>Naming Conventions</h2><h3 id=containers>Containers</h3><ul><li><strong>Format</strong>: <code>&lt;project>_&lt;service>_&lt;instance></code></li><li><strong>Example</strong>: <code>webapp_api_1</code></li></ul><h3 id=images>Images</h3><ul><li><strong>Format</strong>: <code>&lt;repository>/&lt;image>:&lt;tag></code></li><li><strong>Example</strong>: <code>mycompany/webapp:1.0.0</code></li></ul><h3 id=networks-and-volumes>Networks and Volumes</h3><ul><li><strong>Format</strong>: <code>&lt;project>_&lt;resource></code></li><li><strong>Example</strong>: <code>webapp_network</code>, <code>webapp_data</code></li></ul><h2 id=logging-and-monitoring>Logging and Monitoring</h2><h3 id=centralize-logs>Centralize Logs</h3><ul><li><strong>Why</strong>: Simplifies log management and analysis.</li><li><strong>How</strong>: Use logging drivers or external systems like <strong>ELK Stack</strong> or <strong>Graylog</strong>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --log-driver<span style=color:#f92672>=</span>json-file myapp:1.0.0
</span></span></code></pre></div></li></ul><h3 id=implement-monitoring-solutions>Implement Monitoring Solutions</h3><ul><li><strong>Tools</strong>: <strong>Prometheus</strong>, <strong>Grafana</strong>, <strong>Datadog</strong>, <strong>New Relic</strong>.</li><li><strong>Action</strong>: Monitor container metrics, application performance, and system health.</li></ul><h2 id=deployment-guidelines>Deployment Guidelines</h2><h3 id=use-orchestration-tools>Use Orchestration Tools</h3><ul><li><strong>Tools</strong>: <strong>Kubernetes</strong>, <strong>Docker Swarm</strong>, <strong>Apache Mesos</strong></li><li><strong>Why</strong>: Facilitates scalable, reliable deployments with features like load balancing, service discovery, and automated rollouts.</li></ul><h3 id=automate-deployments>Automate Deployments</h3><ul><li><strong>Action</strong>: Integrate Docker with CI/CD pipelines using tools like <strong>Jenkins</strong>, <strong>GitLab CI/CD</strong>, or <strong>GitHub Actions</strong>.</li><li><strong>Benefit</strong>: Ensures consistent and repeatable deployments.</li></ul><h2 id=cicd-integration>CI/CD Integration</h2><h3 id=automate-image-builds>Automate Image Builds</h3><ul><li><strong>Action</strong>: Trigger Docker builds automatically on code commits or merges.</li><li><strong>Example (GitHub Actions)</strong>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>CI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build Docker Image</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>docker build -t myapp:${{ github.sha }} .</span>
</span></span></code></pre></div></li></ul><h3 id=implement-automated-testing>Implement Automated Testing</h3><ul><li><strong>Action</strong>: Run tests within Docker containers to ensure consistency.</li><li><strong>Benefit</strong>: Detect issues early in the development pipeline.</li></ul><h2 id=maintenance-and-cleanup>Maintenance and Cleanup</h2><h3 id=regularly-prune-unused-resources>Regularly Prune Unused Resources</h3><ul><li><strong>Action</strong>: Remove dangling images, stopped containers, unused volumes, and networks.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker system prune -a
</span></span></code></pre></div></li></ul><h3 id=rotate-and-backup-data>Rotate and Backup Data</h3><ul><li><strong>Action</strong>: Implement data backup strategies for persistent volumes.</li><li><strong>Tools</strong>: <strong>rsync</strong>, <strong>Volume Backup Plugins</strong>, cloud storage solutions.</li></ul><h2 id=troubleshooting-tips>Troubleshooting Tips</h2><ul><li><p><strong>Inspect Containers</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker inspect &lt;container_id&gt;
</span></span></code></pre></div></li><li><p><strong>View Logs</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker logs &lt;container_id&gt;
</span></span></code></pre></div></li><li><p><strong>Access Container Shell</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker exec -it &lt;container_id&gt; /bin/sh
</span></span></code></pre></div></li><li><p><strong>Check Network Connectivity</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker network inspect &lt;network_name&gt;
</span></span></code></pre></div></li><li><p><strong>Diagnose with Docker Events</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker events
</span></span></code></pre></div></li></ul><h2 id=examples>Examples</h2><h3 id=sample-dockerfile>Sample Dockerfile</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># Use official Node.js LTS version</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:14-alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set working directory</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy package.json and install dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> package.json package-lock.json ./<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm install --production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy application code</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Expose the application port</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 3000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Define the entry point</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;node&#34;</span>, <span style=color:#e6db74>&#34;server.js&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=docker-compose-example>Docker Compose Example</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>.:/app</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>web_data:/var/lib/web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>NODE_ENV</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>webnet</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:13</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>user</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>password</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db_data:/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>webnet</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>web_data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>db_data</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>webnet</span>:
</span></span></code></pre></div><p><strong>Happy Dockering!</strong> üöÄ</p></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 ltr:mr-1.5 rtl:ml-1.5 rounded-lg bg-black/[3%] px-5 py-1 no-underline hover:bg-black/[6%] dark:bg-white/[8%] dark:hover:bg-white/[12%]" href=https://bleedkagax.github.io/tags/systemdesign>SystemDesign</a></footer><nav class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg !leading-[1.2] *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"><a class="ltr:ml-auto rtl:mr-auto justify-end pl-3" href=https://bleedkagax.github.io/post/5_k8s/><span>Kubernetes</span><span class="ltr:ml-1.5 rtl:mr-1.5">‚Üí</span></a></nav><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script><script>Array.from(document.getElementsByClassName("language-mermaid")).forEach(e=>{e.parentElement.outerHTML=`<div class="mermaid [&_svg]:block [&_svg]:m-auto">${e.innerHTML}</div>`})</script></article></main><footer class="mx-auto flex h-[4.5rem] max-w-[--w] items-center px-8 text-xs uppercase tracking-wider opacity-60"><div class=mr-auto>&copy; 2025
<a class=link href=https://bleedkagax.github.io/>Kaga Blog</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>powered by hugoÔ∏èÔ∏è</a>Ô∏è
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>hugo-paper</a></footer></body></html>