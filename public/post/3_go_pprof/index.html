<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go Pprof | Kaga Blog</title>
<meta name=keywords content="Golang"><meta name=description content="Overview of Pprof
pprof is a tool that comes with Go&rsquo;s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:

CPU Profile: Measures where the program spends most of its time.
Memory Profile: Measures the amount of memory allocated and retained.
Block Profile: Measures where the program spends time waiting for synchronization primitives.
Mutex Profile: Measures contention on mutexes.

Setting Up pprof
To use pprof, you need to import the net/http/pprof package and set up HTTP server to serve the profiling data."><meta name=author content><link rel=canonical href=https://bleedkagax.github.io/post/3_go_pprof/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://bleedkagax.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bleedkagax.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bleedkagax.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bleedkagax.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bleedkagax.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bleedkagax.github.io/post/3_go_pprof/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Go Pprof"><meta property="og:description" content="Overview of Pprof
pprof is a tool that comes with Go&rsquo;s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:

CPU Profile: Measures where the program spends most of its time.
Memory Profile: Measures the amount of memory allocated and retained.
Block Profile: Measures where the program spends time waiting for synchronization primitives.
Mutex Profile: Measures contention on mutexes.

Setting Up pprof
To use pprof, you need to import the net/http/pprof package and set up HTTP server to serve the profiling data."><meta property="og:type" content="article"><meta property="og:url" content="https://bleedkagax.github.io/post/3_go_pprof/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-09-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-12T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Pprof"><meta name=twitter:description content="Overview of Pprof
pprof is a tool that comes with Go&rsquo;s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:

CPU Profile: Measures where the program spends most of its time.
Memory Profile: Measures the amount of memory allocated and retained.
Block Profile: Measures where the program spends time waiting for synchronization primitives.
Mutex Profile: Measures contention on mutexes.

Setting Up pprof
To use pprof, you need to import the net/http/pprof package and set up HTTP server to serve the profiling data."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bleedkagax.github.io/post/"},{"@type":"ListItem","position":2,"name":"Go Pprof","item":"https://bleedkagax.github.io/post/3_go_pprof/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go Pprof","name":"Go Pprof","description":"Overview of Pprof pprof is a tool that comes with Go\u0026rsquo;s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:\nCPU Profile: Measures where the program spends most of its time. Memory Profile: Measures the amount of memory allocated and retained. Block Profile: Measures where the program spends time waiting for synchronization primitives. Mutex Profile: Measures contention on mutexes. Setting Up pprof To use pprof, you need to import the net/http/pprof package and set up HTTP server to serve the profiling data.\n","keywords":["Golang"],"articleBody":"Overview of Pprof pprof is a tool that comes with Go’s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:\nCPU Profile: Measures where the program spends most of its time. Memory Profile: Measures the amount of memory allocated and retained. Block Profile: Measures where the program spends time waiting for synchronization primitives. Mutex Profile: Measures contention on mutexes. Setting Up pprof To use pprof, you need to import the net/http/pprof package and set up HTTP server to serve the profiling data.\nStep 1: Import the pprof Package import ( \"net/http\" _ \"net/http/pprof\" // This blank import enables the HTTP endpoints for `pprof` ) Step 2: Start the HTTP Server func main() { go func() { // The ListenAndServe function starts the HTTP server. It never returns. // We use `log.Fatal` here to ensure that the program will exit if the server fails to start. log.Fatal(http.ListenAndServe(\"localhost:6060\", nil)) }() // Your application logic here... } Writing Code to Profile For demonstration, we’ll use a CPU-intensive function.\nfunc expensiveFunction() { for i := 0; i \u003c 1000000; i++ { // Simulating some CPU intensive computation } } func main() { go func() { log.Fatal(http.ListenAndServe(\"localhost:6060\", nil)) }() // Call the function multiple times to simulate CPU usage for i := 0; i \u003c 10; i++ { expensiveFunction() } } Profiling the Application After running your program, you can access the pprof HTTP endpoints at http://localhost:6060/debug/pprof/.\nProfiling CPU Usage Generate a CPU profile by visiting http://localhost:6060/debug/pprof/profile in your browser. Capture the profile by setting the duration for which you want to collect the profile. For example, you can set it to 30 seconds. Profiling Memory Usage Generate a memory profile by visiting http://localhost:6060/debug/pprof/heap in your browser. Capture the profile and download the snapshot. Analyzing the Profile Use the go tool pprof command to analyze the profile.\nAnalyzing CPU Profile go tool pprof http://localhost:6060/debug/pprof/profile Use various commands to explore the data:\ntop: Lists the top functions by self or total CPU time. list : Shows the source code of a specific function. web: Opens an interactive web visualization of the call graph. Analyzing Memory Profile go tool pprof http://localhost:6060/debug/pprof/heap Analyzing concurrency performance Step 1: Enable pprof HTTP Endpoints import ( \"net/http\" _ \"net/http/pprof\" // This blank import enables the HTTP endpoints for `pprof` \"log\" \"time\" ) func startProfiler() { // Start the HTTP server on a different goroutine go func() { log.Println(http.ListenAndServe(\"localhost:6060\", nil)) }() } Step 2: Write Concurrent Code Create a Go program that uses concurrency features like goroutines and channels.\nfunc worker(id int, done chan bool) { for { // Simulating work by sleeping for a bit. time.Sleep(time.Millisecond * 10) // Log the work being processed. log.Printf(\"Worker %d is processing\\n\", id) // Signal that the work is done. done \u003c- true } } func main() { startProfiler() numWorkers := 10000 done := make(chan bool, numWorkers) for i := 0; i \u003c numWorkers; i++ { go worker(i, done) } for i := 0; i \u003c numWorkers; i++ { \u003c-done } } Step 3: Collect Concurrency Profiles Mutex Profile Run the Mutex Profiler: Access http://localhost:6060/debug/pprof/mutex to view the mutex profile, which shows contention points for mutexes.\ngo tool pprof http://localhost:6060/debug/pprof/mutex Analyze Contention: Look for high contention values, which indicate that goroutines are frequently blocked waiting for a mutex.\nGoroutine Profile Run the Goroutine Profiler: Access http://localhost:6060/debug/pprof/goroutine to get a report of all current goroutines.\ngo tool pprof http://localhost:6060/debug/pprof/goroutine Analyze Goroutine Counts: Check for an unusually high number of goroutines, which might indicate a leak.\nStep 4: Use pprof to Analyze Data Use the top list web command\n(pprof) top Showing nodes accounting for 77021, 96.14% of 80112 total top - 15:25:56 up 1:15, 0 users, load average: 2.18, 2.84, 2.41 Tasks: 17 total, 1 running, 15 sleeping, 0 stopped, 1 zombie %Cpu(s): 50.1 us, 11.5 sy, 0.0 ni, 37.4 id, 0.0 wa, 0.0 hi, 1.0 si, 0.0 st MiB Mem : 7950.9 total, 4956.1 free, 2293.5 used, 701.4 buff/cache MiB Swap: 0.0 total, 0.0 free, 0.0 used. 5196.8 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND 135 user 20 0 1717788 847608 10480 S 4.3 10.4 2:34.51 node 6 user 20 0 954168 88244 9608 S 3.0 1.1 1:21.68 node 295 user 20 0 899088 16332 1264 S 0.0 0.2 0:00.99 nodemon 324 user 20 0 503980 12852 0 S 0.0 0.2 0:00.49 nixd 439 user 20 0 684016 73544 0 S 0.0 0.9 0:00.87 nixd-attrset-ev 3949 user 20 0 223960 2840 1952 S 0.0 0.0 0:00.06 bash 7542 user 20 0 1524220 75852 0 S 0.0 0.9 0:10.57 gopls 9074 user 20 0 223960 2560 1668 S 0.0 0.0 0:00.09 bash Step 5: Optimize Concurrency Reduce Lock Contention: Redesign your code to reduce the need for locking or use finer-grained locks. Optimize Channel Usage: Ensure that channel operations are efficient and that goroutines are not blocked waiting for channel operations unnecessarily. Limit Goroutine Creation: Use a pool of worker goroutines or limit the creation of new goroutines. Avoid Blocking Operations: Ensure that blocking operations are handled correctly and do not unnecessarily block other goroutines. Conclusion pprof is a powerful tool for understanding and optimizing the performance of your Go applications.\nAdditional Resources Go pprof documentation Go pprof GitHub repository ","wordCount":"881","inLanguage":"en","datePublished":"2024-09-12T00:00:00Z","dateModified":"2024-09-12T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://bleedkagax.github.io/post/3_go_pprof/"},"publisher":{"@type":"Organization","name":"Kaga Blog","logo":{"@type":"ImageObject","url":"https://bleedkagax.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bleedkagax.github.io/ accesskey=h title="Kaga Blog (Alt + H)">Kaga Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bleedkagax.github.io/post/ title=Posts><span>Posts</span></a></li><li><a href=https://bleedkagax.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://bleedkagax.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://bleedkagax.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Go Pprof</h1><div class=post-meta><span title='2024-09-12 00:00:00 +0000 UTC'>September 12, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#overview-of-pprof aria-label="Overview of Pprof">Overview of Pprof</a></li><li><a href=#setting-up-pprof aria-label="Setting Up pprof">Setting Up pprof</a><ul><li><a href=#step-1-import-the-pprof-package aria-label="Step 1: Import the pprof Package">Step 1: Import the pprof Package</a></li><li><a href=#step-2-start-the-http-server aria-label="Step 2: Start the HTTP Server">Step 2: Start the HTTP Server</a></li></ul></li><li><a href=#writing-code-to-profile aria-label="Writing Code to Profile">Writing Code to Profile</a></li><li><a href=#profiling-the-application aria-label="Profiling the Application">Profiling the Application</a><ul><li><a href=#profiling-cpu-usage aria-label="Profiling CPU Usage">Profiling CPU Usage</a></li><li><a href=#profiling-memory-usage aria-label="Profiling Memory Usage">Profiling Memory Usage</a></li></ul></li><li><a href=#analyzing-the-profile aria-label="Analyzing the Profile">Analyzing the Profile</a><ul><li><a href=#analyzing-cpu-profile aria-label="Analyzing CPU Profile">Analyzing CPU Profile</a></li><li><a href=#analyzing-memory-profile aria-label="Analyzing Memory Profile">Analyzing Memory Profile</a></li><li><a href=#analyzing-concurrency-performance aria-label="Analyzing concurrency performance">Analyzing concurrency performance</a><ul><li><a href=#step-1-enablepprofhttp-endpoints aria-label="Step 1: Enable pprof HTTP Endpoints">Step 1: Enable pprof HTTP Endpoints</a></li><li><a href=#step-2-write-concurrent-code aria-label="Step 2: Write Concurrent Code">Step 2: Write Concurrent Code</a></li><li><a href=#step-3-collect-concurrency-profiles aria-label="Step 3: Collect Concurrency Profiles">Step 3: Collect Concurrency Profiles</a><ul><li><a href=#mutex-profile aria-label="Mutex Profile">Mutex Profile</a></li><li><a href=#goroutine-profile aria-label="Goroutine Profile">Goroutine Profile</a></li></ul></li><li><a href=#step-4-usepprofto-analyze-data aria-label="Step 4: Use pprof to Analyze Data">Step 4: Use pprof to Analyze Data</a></li><li><a href=#step-5-optimize-concurrency aria-label="Step 5: Optimize Concurrency">Step 5: Optimize Concurrency</a></li></ul></li></ul></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#additional-resources aria-label="Additional Resources">Additional Resources</a></li></ul></div></details></div><div class=post-content><h1 id=overview-of-pprof>Overview of Pprof<a hidden class=anchor aria-hidden=true href=#overview-of-pprof>#</a></h1><p><code>pprof</code> is a tool that comes with Go&rsquo;s standard library and is used for collecting and viewing profiling data. It can collect different types of profiles including:</p><ul><li><strong>CPU Profile</strong>: Measures where the program spends most of its time.</li><li><strong>Memory Profile</strong>: Measures the amount of memory allocated and retained.</li><li><strong>Block Profile</strong>: Measures where the program spends time waiting for synchronization primitives.</li><li><strong>Mutex Profile</strong>: Measures contention on mutexes.</li></ul><h1 id=setting-up-pprof>Setting Up pprof<a hidden class=anchor aria-hidden=true href=#setting-up-pprof>#</a></h1><p>To use <code>pprof</code>, you need to import the <code>net/http/pprof</code> package and set up HTTP server to serve the profiling data.</p><h2 id=step-1-import-the-pprof-package>Step 1: Import the pprof Package<a hidden class=anchor aria-hidden=true href=#step-1-import-the-pprof-package>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;net/http/pprof&#34;</span> <span style=color:#75715e>// This blank import enables the HTTP endpoints for `pprof`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span></code></pre></div><h2 id=step-2-start-the-http-server>Step 2: Start the HTTP Server<a hidden class=anchor aria-hidden=true href=#step-2-start-the-http-server>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// The ListenAndServe function starts the HTTP server. It never returns.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// We use `log.Fatal` here to ensure that the program will exit if the server fails to start.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;localhost:6060&#34;</span>, <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Your application logic here...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><h1 id=writing-code-to-profile>Writing Code to Profile<a hidden class=anchor aria-hidden=true href=#writing-code-to-profile>#</a></h1><p>For demonstration, we&rsquo;ll use a CPU-intensive function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>expensiveFunction</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>1000000</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Simulating some CPU intensive computation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;localhost:6060&#34;</span>, <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Call the function multiple times to simulate CPU usage
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>10</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>expensiveFunction</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=profiling-the-application>Profiling the Application<a hidden class=anchor aria-hidden=true href=#profiling-the-application>#</a></h1><p>After running your program, you can access the <code>pprof</code> HTTP endpoints at <code>http://localhost:6060/debug/pprof/</code>.</p><h2 id=profiling-cpu-usage>Profiling CPU Usage<a hidden class=anchor aria-hidden=true href=#profiling-cpu-usage>#</a></h2><ol><li><strong>Generate a CPU profile</strong> by visiting <code>http://localhost:6060/debug/pprof/profile</code> in your browser.</li><li><strong>Capture the profile</strong> by setting the duration for which you want to collect the profile. For example, you can set it to 30 seconds.</li></ol><h2 id=profiling-memory-usage>Profiling Memory Usage<a hidden class=anchor aria-hidden=true href=#profiling-memory-usage>#</a></h2><ol><li><strong>Generate a memory profile</strong> by visiting <code>http://localhost:6060/debug/pprof/heap</code> in your browser.</li><li><strong>Capture the profile</strong> and download the snapshot.</li></ol><h1 id=analyzing-the-profile>Analyzing the Profile<a hidden class=anchor aria-hidden=true href=#analyzing-the-profile>#</a></h1><p>Use the <code>go tool pprof</code> command to analyze the profile.</p><h2 id=analyzing-cpu-profile>Analyzing CPU Profile<a hidden class=anchor aria-hidden=true href=#analyzing-cpu-profile>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool pprof http://localhost:6060/debug/pprof/profile
</span></span></code></pre></div><p>Use various commands to explore the data:</p><ul><li><code>top</code>: Lists the top functions by self or total CPU time.</li><li><code>list &lt;function_name></code>: Shows the source code of a specific function.</li><li><code>web</code>: Opens an interactive web visualization of the call graph.</li></ul><h2 id=analyzing-memory-profile>Analyzing Memory Profile<a hidden class=anchor aria-hidden=true href=#analyzing-memory-profile>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool pprof http://localhost:6060/debug/pprof/heap
</span></span></code></pre></div><h2 id=analyzing-concurrency-performance>Analyzing concurrency performance<a hidden class=anchor aria-hidden=true href=#analyzing-concurrency-performance>#</a></h2><h3 id=step-1-enablepprofhttp-endpoints>Step 1: Enable pprof HTTP Endpoints<a hidden class=anchor aria-hidden=true href=#step-1-enablepprofhttp-endpoints>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;net/http/pprof&#34;</span> <span style=color:#75715e>// This blank import enables the HTTP endpoints for `pprof`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>startProfiler</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Start the HTTP server on a different goroutine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;localhost:6060&#34;</span>, <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=step-2-write-concurrent-code>Step 2: Write Concurrent Code<a hidden class=anchor aria-hidden=true href=#step-2-write-concurrent-code>#</a></h3><p>Create a Go program that uses concurrency features like goroutines and channels.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>id</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>done</span> <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Simulating work by sleeping for a bit.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Log the work being processed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Worker %d is processing\n&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Signal that the work is done.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startProfiler</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>numWorkers</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>bool</span>, <span style=color:#a6e22e>numWorkers</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>numWorkers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>worker</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>done</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>numWorkers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>done</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=step-3-collect-concurrency-profiles>Step 3: Collect Concurrency Profiles<a hidden class=anchor aria-hidden=true href=#step-3-collect-concurrency-profiles>#</a></h3><h4 id=mutex-profile>Mutex Profile<a hidden class=anchor aria-hidden=true href=#mutex-profile>#</a></h4><ol><li><p><strong>Run the Mutex Profiler</strong>: Access <code>http://localhost:6060/debug/pprof/mutex</code> to view the mutex profile, which shows contention points for mutexes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool pprof http://localhost:6060/debug/pprof/mutex
</span></span></code></pre></div></li><li><p><strong>Analyze Contention</strong>: Look for high <code>contention</code> values, which indicate that goroutines are frequently blocked waiting for a mutex.</p></li></ol><h4 id=goroutine-profile>Goroutine Profile<a hidden class=anchor aria-hidden=true href=#goroutine-profile>#</a></h4><ol><li><p><strong>Run the Goroutine Profiler</strong>: Access <code>http://localhost:6060/debug/pprof/goroutine</code> to get a report of all current goroutines.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go tool pprof http://localhost:6060/debug/pprof/goroutine
</span></span></code></pre></div></li><li><p><strong>Analyze Goroutine Counts</strong>: Check for an unusually high number of goroutines, which might indicate a leak.</p></li></ol><h3 id=step-4-usepprofto-analyze-data>Step 4: Use pprof to Analyze Data<a hidden class=anchor aria-hidden=true href=#step-4-usepprofto-analyze-data>#</a></h3><p>Use the <code>top</code> <code>list</code> <code>web</code> command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>(</span>pprof<span style=color:#f92672>)</span> top
</span></span><span style=display:flex><span>Showing nodes accounting <span style=color:#66d9ef>for</span> 77021, 96.14% of <span style=color:#ae81ff>80112</span> total
</span></span><span style=display:flex><span>top - 15:25:56 up  1:15,  <span style=color:#ae81ff>0</span> users,  load average: 2.18, 2.84, 2.41
</span></span><span style=display:flex><span>Tasks:  <span style=color:#ae81ff>17</span> total,   <span style=color:#ae81ff>1</span> running,  <span style=color:#ae81ff>15</span> sleeping,   <span style=color:#ae81ff>0</span> stopped,   <span style=color:#ae81ff>1</span> zombie
</span></span><span style=display:flex><span>%Cpu<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>: 50.1 us, 11.5 sy,  0.0 ni, 37.4 id,  0.0 wa,  0.0 hi,  1.0 si,  0.0 st
</span></span><span style=display:flex><span>MiB Mem :   7950.9 total,   4956.1 free,   2293.5 used,    701.4 buff/cache
</span></span><span style=display:flex><span>MiB Swap:      0.0 total,      0.0 free,      0.0 used.   5196.8 avail Mem 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                                                              
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>135</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1717788</span> <span style=color:#ae81ff>847608</span>  <span style=color:#ae81ff>10480</span> S   4.3  10.4   2:34.51 node                                                                                 
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>6</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>954168</span>  <span style=color:#ae81ff>88244</span>   <span style=color:#ae81ff>9608</span> S   3.0   1.1   1:21.68 node                                                                                                             
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>295</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>899088</span>  <span style=color:#ae81ff>16332</span>   <span style=color:#ae81ff>1264</span> S   0.0   0.2   0:00.99 nodemon                                                                              
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>324</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>503980</span>  <span style=color:#ae81ff>12852</span>      <span style=color:#ae81ff>0</span> S   0.0   0.2   0:00.49 nixd                                                                                 
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>439</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>684016</span>  <span style=color:#ae81ff>73544</span>      <span style=color:#ae81ff>0</span> S   0.0   0.9   0:00.87 nixd-attrset-ev        
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>3949</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>223960</span>   <span style=color:#ae81ff>2840</span>   <span style=color:#ae81ff>1952</span> S   0.0   0.0   0:00.06 bash                                                                                 
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>7542</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1524220</span>  <span style=color:#ae81ff>75852</span>      <span style=color:#ae81ff>0</span> S   0.0   0.9   0:10.57 gopls                                                                                
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>9074</span> user      <span style=color:#ae81ff>20</span>   <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>223960</span>   <span style=color:#ae81ff>2560</span>   <span style=color:#ae81ff>1668</span> S   0.0   0.0   0:00.09 bash     
</span></span></code></pre></div><h3 id=step-5-optimize-concurrency>Step 5: Optimize Concurrency<a hidden class=anchor aria-hidden=true href=#step-5-optimize-concurrency>#</a></h3><ol><li><strong>Reduce Lock Contention</strong>: Redesign your code to reduce the need for locking or use finer-grained locks.</li><li><strong>Optimize Channel Usage</strong>: Ensure that channel operations are efficient and that goroutines are not blocked waiting for channel operations unnecessarily.</li><li><strong>Limit Goroutine Creation</strong>: Use a pool of worker goroutines or limit the creation of new goroutines.</li><li><strong>Avoid Blocking Operations</strong>: Ensure that blocking operations are handled correctly and do not unnecessarily block other goroutines.</li></ol><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p><code>pprof</code> is a powerful tool for understanding and optimizing the performance of your Go applications.</p><h1 id=additional-resources>Additional Resources<a hidden class=anchor aria-hidden=true href=#additional-resources>#</a></h1><ul><li><a href=https://pkg.go.dev/net/http/pprof>Go <code>pprof</code> documentation</a></li><li><a href=https://github.com/golang/go/tree/master/src/net/http/pprof>Go <code>pprof</code> GitHub repository</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bleedkagax.github.io/tags/golang/>Golang</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://bleedkagax.github.io/>Kaga Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script><script>(function(){var e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(function(e){var t,n=e.parentElement;if(!n)return;t=document.createElement("div"),t.className="mermaid",t.textContent=e.textContent||"",n.replaceWith(t)})})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>