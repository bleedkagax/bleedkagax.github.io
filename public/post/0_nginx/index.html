<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nginx | Kaga Blog</title>
<meta name=keywords content="SystemDesign"><meta name=description content="Introduction to Nginx
Nginx (pronounced as &ldquo;Engine-X&rdquo;) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.
What is Nginx?
Key Features

High Performance: Ability to handle thousands of concurrent connections with minimal memory footprint.
Reverse Proxying: Acts as an intermediary for requests from clients seeking resources from servers.
Load Balancing: Distributes incoming traffic across multiple servers to ensure reliability and uptime.
SSL/TLS Support: Provides secure connections using SSL/TLS protocols.
Caching: Reduces server load and improves response times by caching responses from backend servers.
Modular Architecture: Supports dynamic modules to extend its functionality.
Static and Dynamic Content Serving: Efficiently serves static files and dynamically generated content.

Use Cases

Web Servers: Serving websites and web applications.
Reverse Proxy: Forwarding requests to application servers like Node.js, Python, Ruby, etc.
Load Balancer: Distributing traffic across multiple backend servers.
API Gateway: Managing and routing API requests.
Content Caching: Storing frequently accessed content to enhance performance.

Prerequisites
Before diving into Nginx, ensure you have the following:"><meta name=author content><link rel=canonical href=https://bleedkagax.github.io/post/0_nginx/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://bleedkagax.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bleedkagax.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bleedkagax.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bleedkagax.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bleedkagax.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bleedkagax.github.io/post/0_nginx/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Nginx"><meta property="og:description" content="Introduction to Nginx
Nginx (pronounced as &ldquo;Engine-X&rdquo;) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.
What is Nginx?
Key Features

High Performance: Ability to handle thousands of concurrent connections with minimal memory footprint.
Reverse Proxying: Acts as an intermediary for requests from clients seeking resources from servers.
Load Balancing: Distributes incoming traffic across multiple servers to ensure reliability and uptime.
SSL/TLS Support: Provides secure connections using SSL/TLS protocols.
Caching: Reduces server load and improves response times by caching responses from backend servers.
Modular Architecture: Supports dynamic modules to extend its functionality.
Static and Dynamic Content Serving: Efficiently serves static files and dynamically generated content.

Use Cases

Web Servers: Serving websites and web applications.
Reverse Proxy: Forwarding requests to application servers like Node.js, Python, Ruby, etc.
Load Balancer: Distributing traffic across multiple backend servers.
API Gateway: Managing and routing API requests.
Content Caching: Storing frequently accessed content to enhance performance.

Prerequisites
Before diving into Nginx, ensure you have the following:"><meta property="og:type" content="article"><meta property="og:url" content="https://bleedkagax.github.io/post/0_nginx/"><meta property="article:section" content="post"><meta property="article:published_time" content="2024-10-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nginx"><meta name=twitter:description content="Introduction to Nginx
Nginx (pronounced as &ldquo;Engine-X&rdquo;) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.
What is Nginx?
Key Features

High Performance: Ability to handle thousands of concurrent connections with minimal memory footprint.
Reverse Proxying: Acts as an intermediary for requests from clients seeking resources from servers.
Load Balancing: Distributes incoming traffic across multiple servers to ensure reliability and uptime.
SSL/TLS Support: Provides secure connections using SSL/TLS protocols.
Caching: Reduces server load and improves response times by caching responses from backend servers.
Modular Architecture: Supports dynamic modules to extend its functionality.
Static and Dynamic Content Serving: Efficiently serves static files and dynamically generated content.

Use Cases

Web Servers: Serving websites and web applications.
Reverse Proxy: Forwarding requests to application servers like Node.js, Python, Ruby, etc.
Load Balancer: Distributing traffic across multiple backend servers.
API Gateway: Managing and routing API requests.
Content Caching: Storing frequently accessed content to enhance performance.

Prerequisites
Before diving into Nginx, ensure you have the following:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bleedkagax.github.io/post/"},{"@type":"ListItem","position":2,"name":"Nginx","item":"https://bleedkagax.github.io/post/0_nginx/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nginx","name":"Nginx","description":"Introduction to Nginx Nginx (pronounced as \u0026ldquo;Engine-X\u0026rdquo;) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.\nWhat is Nginx? Key Features High Performance: Ability to handle thousands of concurrent connections with minimal memory footprint. Reverse Proxying: Acts as an intermediary for requests from clients seeking resources from servers. Load Balancing: Distributes incoming traffic across multiple servers to ensure reliability and uptime. SSL/TLS Support: Provides secure connections using SSL/TLS protocols. Caching: Reduces server load and improves response times by caching responses from backend servers. Modular Architecture: Supports dynamic modules to extend its functionality. Static and Dynamic Content Serving: Efficiently serves static files and dynamically generated content. Use Cases Web Servers: Serving websites and web applications. Reverse Proxy: Forwarding requests to application servers like Node.js, Python, Ruby, etc. Load Balancer: Distributing traffic across multiple backend servers. API Gateway: Managing and routing API requests. Content Caching: Storing frequently accessed content to enhance performance. Prerequisites Before diving into Nginx, ensure you have the following:\n","keywords":["SystemDesign"],"articleBody":"Introduction to Nginx Nginx (pronounced as “Engine-X”) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.\nWhat is Nginx? Key Features High Performance: Ability to handle thousands of concurrent connections with minimal memory footprint. Reverse Proxying: Acts as an intermediary for requests from clients seeking resources from servers. Load Balancing: Distributes incoming traffic across multiple servers to ensure reliability and uptime. SSL/TLS Support: Provides secure connections using SSL/TLS protocols. Caching: Reduces server load and improves response times by caching responses from backend servers. Modular Architecture: Supports dynamic modules to extend its functionality. Static and Dynamic Content Serving: Efficiently serves static files and dynamically generated content. Use Cases Web Servers: Serving websites and web applications. Reverse Proxy: Forwarding requests to application servers like Node.js, Python, Ruby, etc. Load Balancer: Distributing traffic across multiple backend servers. API Gateway: Managing and routing API requests. Content Caching: Storing frequently accessed content to enhance performance. Prerequisites Before diving into Nginx, ensure you have the following:\nBasic Understanding of Web Servers: Familiarity with how web servers work. Command-Line Proficiency: Comfortable using the terminal/command prompt. Basic Networking Knowledge: Understanding of concepts like IP addresses, DNS, HTTP/HTTPS. Root/Sudo Access: Required for installing and configuring Nginx on servers. Installation Installing on Ubuntu/Debian Update Package List\nsudo apt update Install Nginx\nsudo apt install nginx Start and Enable Nginx\nsudo systemctl start nginx sudo systemctl enable nginx Verify Installation\nOpen your web browser and navigate to http://your_server_ip/. You should see the Nginx default welcome page.\nInstalling on CentOS/RHEL Install EPEL Repository\nsudo yum install epel-release -y Install Nginx\nsudo yum install nginx -y Start and Enable Nginx\nsudo systemctl start nginx sudo systemctl enable nginx Adjust Firewall\nAllow HTTP and HTTPS traffic.\nsudo firewall-cmd --permanent --add-service=http sudo firewall-cmd --permanent --add-service=https sudo firewall-cmd --reload Verify Installation\nNavigate to http://your_server_ip/ in your browser to see the Nginx default page.\nInstalling on macOS You can install Nginx on macOS using Homebrew.\nInstall Homebrew (if not already installed)\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\" Install Nginx\nbrew install nginx Start Nginx\nbrew services start nginx Verify Installation\nOpen http://localhost:8080/ in your web browser to see the Nginx welcome page.\nBuilding from Source Building Nginx from source allows customization by enabling specific modules.\nInstall Dependencies\nsudo apt update sudo apt install -y build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev Download Nginx Source Code\nwget http://nginx.org/download/nginx-1.21.6.tar.gz tar -zxvf nginx-1.21.6.tar.gz cd nginx-1.21.6/ Configure Nginx\n./configure --prefix=/usr/local/nginx --with-http_ssl_module --prefix: Installation directory. --with-http_ssl_module: Enables SSL support. Compile and Install\nmake sudo make install Start Nginx\nsudo /usr/local/nginx/sbin/nginx Verify Installation\nVisit http://your_server_ip/ to see the Nginx welcome page.\nBasic Configuration Nginx Configuration File Structure Nginx configuration files are typically located at /etc/nginx/nginx.conf on Unix-based systems. The primary configuration is divided into several blocks:\nMain Context: Global settings. Events Block: Handles connection-related settings. HTTP Block: Configures web server settings, including server blocks. Server Blocks: Define virtual hosts/sites. Location Blocks: Specify how to handle different request URIs. Understanding the nginx.conf File Here is a breakdown of a typical nginx.conf file:\nuser www-data; worker_processes auto; pid /run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # Logging access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; # Gzip Compression gzip on; gzip_types text/plain application/xml text/css application/javascript; # Server Block server { listen 80; server_name example.com www.example.com; root /var/www/html; index index.html index.htm index.nginx-debian.html; location / { try_files $uri $uri/ =404; } # Additional configurations... } # Additional server blocks... } Main Context: Sets user permissions, worker processes, and PID file location. Events Block: Configures connection-related settings like worker_connections. HTTP Block: Contains settings related to handling HTTP requests, including MIME types, logging, compression, and server blocks. Server Block: Defines settings for a virtual host, including ports, server names, root directory, index files, and location handling. Serving Static Content One of the fundamental uses of Nginx is to serve static files efficiently.\nBasic Server Block Here’s a simple server block configured to serve static content:\nserver { listen 80; server_name your_domain.com; root /var/www/your_domain; index index.html index.htm; location / { try_files $uri $uri/ =404; } } Setting Up Root and Index Files root: Specifies the root directory where your website files are located. index: Defines the default file to serve when a directory is requested. Example:\nserver { listen 80; server_name example.com; root /usr/share/nginx/html; index index.html index.htm; location / { try_files $uri $uri/ =404; } } Handling Dynamic Content Nginx can also handle dynamic content by forwarding requests to application servers.\nProxying Requests to Application Servers Use the proxy_pass directive to forward requests to backend servers like Node.js, Python, Ruby, etc.\nExample: Proxying to a Node.js Server\nserver { listen 80; server_name your_domain.com; location / { proxy_pass http://localhost:3000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection 'upgrade'; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; } } Explanation:\nproxy_pass: Forwards all requests to the specified backend server. proxy_set_header: Sets custom headers to maintain the original client details and support WebSockets. proxy_cache_bypass: Ensures that cached content is bypassed when necessary. FastCGI and PHP Integration Nginx can serve PHP applications using FastCGI processors like PHP-FPM.\nExample: Configuring Nginx to Serve PHP with PHP-FPM\nInstall PHP and PHP-FPM\nsudo apt install php-fpm Configure Nginx Server Block\nserver { listen 80; server_name your_domain.com; root /var/www/your_domain; index index.php index.html index.htm; location / { try_files $uri $uri/ =404; } # Pass PHP scripts to FastCGI server location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php7.4-fpm.sock; } # Deny access to .htaccess files location ~ /\\.ht { deny all; } } Explanation:\nlocation ~ .php$: Matches PHP files. include snippets/fastcgi-php.conf: Includes default FastCGI parameters. fastcgi_pass: Specifies the FastCGI server address and socket. deny all: Denies access to hidden files like .htaccess. Load Balancing Nginx can distribute incoming traffic across multiple backend servers to ensure reliability and improve performance.\nBasic Load Balancing Methods Round Robin (Default Method)\nDistributes requests sequentially across the backend servers.\nhttp { upstream backend { server backend1.example.com; server backend2.example.com; server backend3.example.com; } server { listen 80; server_name your_domain.com; location / { proxy_pass http://backend; } } } Least Connections\nSends requests to the server with the fewest active connections.\nhttp { upstream backend { least_conn; server backend1.example.com; server backend2.example.com; server backend3.example.com; } server { listen 80; server_name your_domain.com; location / { proxy_pass http://backend; } } } Explanation:\nleast_conn: Nginx directive to enable least connections load balancing. IP Hash\nEnsures that requests from the same client IP are always directed to the same backend server.\nhttp { upstream backend { ip_hash; server backend1.example.com; server backend2.example.com; server backend3.example.com; } server { listen 80; server_name your_domain.com; location / { proxy_pass http://backend; } } } Explanation:\nip_hash: Nginx directive to enable IP hash load balancing. Advanced Load Balancing Techniques Session Persistence\nEnsures that a user’s session is consistently routed to the same backend server.\nhttp { upstream backend { server backend1.example.com; server backend2.example.com; server backend3.example.com; } server { listen 80; server_name your_domain.com; location / { proxy_pass http://backend; proxy_set_header Cookie $http_cookie; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } } Explanation:\nproxy_set_header Cookie $http_cookie: Passes cookies to maintain session persistence. Health Checks\nAutomatically detects and removes unhealthy backend servers from the rotation.\nhttp { upstream backend { server backend1.example.com; server backend2.example.com; server backend3.example.com; # Health check parameters keepalive 32; } server { listen 80; server_name your_domain.com; location / { proxy_pass http://backend; proxy_http_version 1.1; proxy_set_header Connection \"\"; } } } Note: Nginx core does not support active health checks. For active health checks, consider using the Nginx Plus version or integrating with external tools like Consul.\nDynamic Load Balancing with Variables\nUse variables to dynamically select backend servers based on request attributes.\nhttp { upstream backend { server backend1.example.com; server backend2.example.com; } server { listen 80; server_name your_domain.com; location / { set $backend \"\"; if ($arg_site = \"site1\") { set $backend \"backend1.example.com\"; } if ($arg_site = \"site2\") { set $backend \"backend2.example.com\"; } proxy_pass http://$backend; } } } Security Best Practices Securing your Nginx server is crucial to protect your web applications and data.\nSSL/TLS Configuration Implement SSL/TLS to encrypt data between clients and your server.\nObtain SSL Certificates\nUsing Let’s Encrypt: Free SSL certificates via Certbot.\nsudo apt install certbot python3-certbot-nginx sudo certbot --nginx -d your_domain.com -d www.your_domain.com Configure SSL in Nginx\nserver { listen 443 ssl; server_name your_domain.com www.your_domain.com; ssl_certificate /etc/letsencrypt/live/your_domain.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/your_domain.com/privkey.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; location / { proxy_pass http://backend; # Additional proxy settings... } } server { listen 80; server_name your_domain.com www.your_domain.com; return 301 https://$host$request_uri; } Explanation:\nlisten 443 ssl;: Listens for HTTPS connections. ssl_certificate: Path to the SSL certificate. ssl_certificate_key: Path to the SSL certificate key. ssl_protocols: Specifies allowed TLS protocols. ssl_ciphers: Defines strong ciphers. Enable HTTP/2\nserver { listen 443 ssl http2; server_name your_domain.com www.your_domain.com; ssl_certificate /etc/letsencrypt/live/your_domain.com/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/your_domain.com/privkey.pem; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; location / { proxy_pass http://backend; # Additional proxy settings... } } Explanation:\nhttp2: Enables HTTP/2 protocol for improved performance. Restricting Access Control access to sensitive resources and restrict unwanted traffic.\nRestrict Access by IP Address\nserver { listen 80; server_name your_domain.com; location /admin { allow 192.168.1.0/24; deny all; proxy_pass http://admin_backend; } location / { proxy_pass http://backend; } } Explanation:\nallow 192.168.1.0/24;: Allows access from the specified IP range. deny all;: Denies access to all other IPs. Password Protection with HTTP Basic Auth\nsudo apt install apache2-utils sudo htpasswd -c /etc/nginx/.htpasswd user1 Explanation:\napache2-utils: Provides htpasswd utility to create password files. htpasswd -c /etc/nginx/.htpasswd user1: Creates a new password file and adds user1. Nginx Configuration:\nserver { listen 80; server_name your_domain.com; location /secure { auth_basic \"Restricted Area\"; auth_basic_user_file /etc/nginx/.htpasswd; proxy_pass http://secure_backend; } location / { proxy_pass http://backend; } } Explanation:\nauth_basic: Enables basic authentication with a realm name. auth_basic_user_file: Specifies the path to the password file. Preventing Common Attacks DDoS Protection\nImplement rate limiting to mitigate DDoS attacks.\nhttp { limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; server { listen 80; server_name your_domain.com; location / { limit_req zone=one burst=5 nodelay; proxy_pass http://backend; } } } Explanation:\nlimit_req_zone: Defines a shared memory zone named one with a rate of 1 request per second. limit_req: Applies the rate limit to requests in the specified location. Preventing Clickjacking\nAdd X-Frame-Options header to prevent the website from being framed.\nserver { listen 80; server_name your_domain.com; add_header X-Frame-Options \"SAMEORIGIN\" always; location / { proxy_pass http://backend; } } Explanation:\nadd_header X-Frame-Options “SAMEORIGIN” always;: Prevents the site from being embedded in iframes from different origins. Content Security Policy (CSP)\nDefine a CSP to prevent cross-site scripting (XSS) and other code injection attacks.\nserver { listen 80; server_name your_domain.com; add_header Content-Security-Policy \"default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com;\" always; location / { proxy_pass http://backend; } } Explanation:\nadd_header Content-Security-Policy: Sets the CSP header to restrict sources of content. Performance Optimization Enhance Nginx’s performance to handle high traffic efficiently.\nCaching Implement caching strategies to reduce server load and improve response times.\nProxy Caching\nCache responses from backend servers.\nConfiguration:\nhttp { proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off; server { listen 80; server_name your_domain.com; location /api/ { proxy_cache my_cache; proxy_pass http://backend; proxy_cache_valid 200 302 10m; proxy_cache_valid 404 1m; proxy_cache_use_stale error timeout updating; add_header X-Proxy-Cache $upstream_cache_status; } } } Explanation:\nproxy_cache_path: Defines cache storage path and parameters. proxy_cache: Enables caching for the specified location. proxy_cache_valid: Sets cache duration based on response statuses. proxy_cache_use_stale: Serves stale content under specific conditions. add_header X-Proxy-Cache: Adds a header indicating cache status. FastCGI Caching\nCache responses from FastCGI servers like PHP-FPM.\nConfiguration:\nhttp { fastcgi_cache_path /var/cache/nginx levels=1:2 keys_zone=fastcgi_cache:10m inactive=60m use_temp_path=off; server { listen 80; server_name your_domain.com; location ~ \\.php$ { fastcgi_pass unix:/var/run/php/php7.4-fpm.sock; include fastcgi_params; fastcgi_cache fastcgi_cache; fastcgi_cache_valid 200 302 10m; fastcgi_cache_valid 404 1m; fastcgi_cache_use_stale error timeout updating; add_header X-FastCGI-Cache $upstream_cache_status; } } } Explanation:\nfastcgi_cache_path: Defines FastCGI cache storage path and parameters. fastcgi_cache: Enables FastCGI caching for the specified location. Gzip Compression Enable gzip compression to reduce the size of responses and improve load times.\nConfiguration:\nhttp { gzip on; gzip_disable \"msie6\"; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_buffers 16 8k; gzip_http_version 1.1; gzip_types text/plain application/xml text/css application/javascript image/svg+xml; } Explanation:\ngzip on;: Enables gzip compression. gzip_disable “msie6”;: Disables gzip for old browsers. gzip_vary on;: Adds Vary: Accept-Encoding header. gzip_comp_level: Sets compression level (1-9). gzip_buffers: Defines buffer size for compression. gzip_http_version: Minimum HTTP version for gzip. gzip_types: Specifies MIME types to compress. Buffer Adjustments Adjust buffer sizes to optimize request and response handling.\nExample:\nhttp { client_max_body_size 50M; client_body_buffer_size 128k; large_client_header_buffers 4 16k; client_body_timeout 12; client_header_timeout 12; send_timeout 10; } Explanation:\nclient_max_body_size: Limits the maximum allowed size of the client request body. client_body_buffer_size: Sets the buffer size for reading client request body. large_client_header_buffers: Defines buffers for large client headers. client_body_timeout, client_header_timeout, send_timeout: Sets timeouts for reading client requests and sending responses. Rate Limiting Control the rate of incoming requests to prevent abuse and ensure quality of service.\nExample: Rate Limiting Using Shared Memory Zones\nhttp { limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s; server { listen 80; server_name your_domain.com; location /api/ { limit_req zone=one burst=5 nodelay; proxy_pass http://backend; } } } Explanation:\nlimit_req_zone: Defines a shared memory zone for rate limiting based on the client IP. limit_req: Applies rate limiting to the specified location. Monitoring and Logging Effective monitoring and logging are essential for maintaining and troubleshooting your Nginx server.\nAccess Logs Access logs record all incoming requests, providing valuable insights into traffic patterns and user behavior.\nConfiguration:\nhttp { log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' '$status $body_bytes_sent \"$http_referer\" ' '\"$http_user_agent\" \"$http_x_forwarded_for\"'; access_log /var/log/nginx/access.log main; } Explanation:\nlog_format: Defines the format of the log entries. access_log: Specifies the location and format of the access log. Error Logs Error logs capture server-side errors and issues, aiding in diagnosis and troubleshooting.\nConfiguration:\nhttp { error_log /var/log/nginx/error.log warn; } Explanation:\nerror_log: Specifies the location and log level (debug, info, notice, warn, error, crit, alert, emerg). Real-time Monitoring with ngx_http_stub_status_module The ngx_http_stub_status_module provides a simple status page displaying basic server metrics.\nConfiguration:\nEnable the Status Module\nEnsure the module is included during Nginx compilation. Most pre-built Nginx packages include this module by default.\nConfigure the Status Page\nserver { listen 8080; server_name localhost; location /nginx_status { stub_status; allow 127.0.0.1; # Allow only local access deny all; } } Access the Status Page\nNavigate to http://localhost:8080/nginx_status to view real-time metrics:\nActive connections: 291 server accepts handled requests 1526989 1526989 2983949 Reading: 12 Writing: 34 Waiting: 245 Explanation:\nActive connections: Current active connections. accepts/handled/requests: Total accepted, handled, and processed requests. Reading/Writing/Waiting: State of connections. Advanced Features Explore advanced functionalities of Nginx to streamline and enhance your web server capabilities.\nReverse Proxy Implementing Nginx as a reverse proxy allows it to handle all client requests and distribute them to appropriate backend servers.\nExample: Reverse Proxy Setup\nserver { listen 80; server_name your_domain.com; location / { proxy_pass http://backend_server; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } Explanation:\nproxy_pass: Forwards requests to the specified backend server. proxy_set_header: Sets headers to preserve client information. Using Nginx as a Mail Proxy Nginx can function as a mail proxy for IMAP, POP3, and SMTP protocols.\nConfiguration Example for IMAP Proxy\nmail { server { listen 143; protocol imap; proxy_pass_error_message on; auth_http localhost:8080/auth; } } Explanation:\nmail: Defines mail-related configurations. server: Configures the mail server. listen: Specifies the port and protocol. proxy_pass_error_message: Enables forwarding of error messages from the backend. auth_http: Defines the authentication server. WebSockets Support Enable real-time, bidirectional communication using WebSockets.\nConfiguration Example: WebSockets with Nginx\nserver { listen 80; server_name your_domain.com; location /ws { proxy_pass http://backend_server; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"Upgrade\"; proxy_set_header Host $host; } } Explanation:\nproxy_http_version 1.1: Sets HTTP version to 1.1 to support WebSockets. proxy_set_header Upgrade $http_upgrade;: Passes the Upgrade header. proxy_set_header Connection “Upgrade”;: Maintains the connection upgrade. HTTP/2 Support Implement HTTP/2 for improved performance with features like multiplexing, header compression, and server push.\nConfiguration Example: Enabling HTTP/2\nserver { listen 443 ssl http2; server_name your_domain.com; ssl_certificate /etc/ssl/certs/your_domain.com.crt; ssl_certificate_key /etc/ssl/private/your_domain.com.key; location / { proxy_pass http://backend; } } Explanation:\nhttp2: Enables HTTP/2 protocol on the listen directive. ssl_certificate \u0026 ssl_certificate_key: Required for HTTPS and HTTP/2. Automation with Nginx Automate configuration management and deployments to streamline operations.\nAutomated Configuration Reloads Automatically reload Nginx configurations without downtime.\nUsing nginx -t and nginx -s reload\nsudo nginx -t \u0026\u0026 sudo nginx -s reload Explanation:\nnginx -t: Tests the configuration for syntax errors. nginx -s reload: Reloads Nginx without stopping the service. Integration with CI/CD Pipelines Integrate Nginx configuration deployments into CI/CD workflows for seamless updates.\nExample: GitLab CI/CD Configuration (.gitlab-ci.yml)\nstages: - test - deploy test_config: stage: test script: - sudo nginx -t only: - master deploy_production: stage: deploy script: - sudo nginx -s reload only: - master - tags Explanation:\ntest_config: Tests Nginx configuration on commit to master. deploy_production: Reloads Nginx after successful tests. Troubleshooting Identify and resolve common Nginx issues to maintain a healthy web server.\nCommon Issues and Solutions Nginx Not Starting\nCheck Configuration Syntax:\nsudo nginx -t Inspect Error Logs:\nsudo tail -f /var/log/nginx/error.log Solution: Fix any syntax errors or conflicts in the configuration file.\n403 Forbidden Error\nCause: Incorrect file permissions or missing index file.\nSolution: Ensure Nginx has read permissions to the root directory and that an index file exists.\nsudo chown -R www-data:www-data /var/www/your_domain sudo chmod -R 755 /var/www/your_domain 502 Bad Gateway\nCause: Backend server is down or misconfigured. Solution: Verify the backend server is running and accessible. Check Nginx proxy settings. 504 Gateway Timeout\nCause: Backend server is taking too long to respond.\nSolution: Increase timeout settings in Nginx and ensure backend server performance.\nlocation / { proxy_pass http://backend; proxy_read_timeout 300; proxy_connect_timeout 300; proxy_send_timeout 300; } Debugging Techniques Enable Debug Logging\nModify the error_log directive to include debug information.\nerror_log /var/log/nginx/error.log debug; Note: Debug logging can generate large amounts of log data, so it should be used with caution to avoid enabling it in production environments.\nUse curl for Testing\nTest server responses and behavior using curl.\ncurl -I http://your_domain.com/ curl -v http://your_domain.com/api Analyze Access Logs\nReview access logs to understand traffic patterns and identify anomalies.\nsudo tail -f /var/log/nginx/access.log Check System Resources\nEnsure the server has sufficient resources (CPU, memory, disk I/O).\ntop df -h Extending Nginx with Modules Enhance Nginx’s capabilities by integrating additional modules.\nThird-Party Modules ngx_brotli\nAdds Brotli compression to Nginx.\nInstallation:\nClone the module repository.\ngit clone https://github.com/google/ngx_brotli.git cd ngx_brotli git submodule update --init Recompile Nginx with the module.\n./configure --add-module=/path/to/ngx_brotli make sudo make install ngx_pagespeed\nOptimizes web pages by automatically applying best practices.\nInstallation:\nDownload Pagespeed module.\nwget https://dl.google.com/dl/page-speed/psol/1.13.35.2-x64.tar.gz tar -xzvf 1.13.35.2-x64.tar.gz Recompile Nginx with Pagespeed.\n./configure --add-module=/path/to/ngx_pagespeed-1.13.35.2-beta make sudo make install Note: Third-party modules require recompiling Nginx from source. Consider using dynamic modules if supported.\nCustom Module Development Develop custom modules to extend Nginx functionality specific to your needs.\nUnderstand Nginx Module Architecture\nHandler Directives: Define how requests are processed. Configuration Directives: Customize module behavior. Context Types: Specify where directives can appear (http, server, location). Set Up Development Environment\nInstall development dependencies. Familiarize yourself with Nginx internals. Create a Basic Module\nExample: Hello World Module\n#include #include #include static char *ngx_http_hello_world(ngx_conf_t *cf, ngx_command_t *cmd, void *conf); static ngx_int_t ngx_http_handler(ngx_http_request_t *r); static ngx_command_t ngx_http_hello_world_commands[] = { { ngx_string(\"hello_world\"), NGX_HTTP_MAIN_CONF | NGX_CONF_NOARGS, ngx_http_hello_world, 0, 0, NULL }, ngx_null_command }; static ngx_http_module_t ngx_http_hello_world_module_ctx = { NULL, // preconfiguration NULL, // postconfiguration NULL, // create main configuration NULL, // init main configuration NULL, // create server configuration NULL, // merge server configuration NULL, // create location configuration NULL // merge location configuration }; ngx_module_t ngx_http_hello_world_module = { NGX_MODULE_V1, \u0026ngx_http_hello_world_module_ctx, ngx_http_hello_world_commands, NGX_HTTP_MODULE, NULL, // init master NULL, // init module NULL, // init process NULL, // init thread NULL, // exit thread NULL, // exit process NULL, // exit master NGX_MODULE_V1_PADDING }; static char *ngx_http_hello_world(ngx_conf_t *cf, ngx_command_t *cmd, void *conf) { ngx_http_core_loc_conf_t *clcf; // Get the core location config clcf = ngx_http_conf_get_module_loc_conf(cf, ngx_http_core_module); // Set the handler clcf-\u003ehandler = ngx_http_handler; return NGX_CONF_OK; } static ngx_int_t ngx_http_handler(ngx_http_request_t *r) { if (!(r-\u003emethod \u0026 NGX_HTTP_GET)) { return NGX_HTTP_NOT_ALLOWED; } ngx_str_t response = ngx_string(\"Hello, Nginx Module!\"); // Set response headers ngx_table_elt_t *h; h = ngx_list_push(\u0026r-\u003eheaders_out.headers); if (h == NULL) { return NGX_HTTP_INTERNAL_SERVER_ERROR; } h-\u003ekey.len = sizeof(\"Content-Type\") - 1; h-\u003ekey.data = (u_char *) \"Content-Type\"; h-\u003evalue.len = sizeof(\"text/plain\") - 1; h-\u003evalue.data = (u_char *) \"text/plain\"; r-\u003eheaders_out.status = NGX_HTTP_OK; r-\u003eheaders_out.content_length_n = response.len; r-\u003eheaders_out.content_type = h-\u003evalue; // Send headers ngx_int_t rc = ngx_http_send_header(r); if (rc == NGX_ERROR || rc \u003e NGX_OK || r-\u003eheader_only) { return rc; } // Create buffer ngx_buf_t *b = ngx_pcalloc(r-\u003epool, sizeof(ngx_buf_t)); if (b == NULL) { return NGX_HTTP_INTERNAL_SERVER_ERROR; } b-\u003epos = response.data; b-\u003elast = response.data + response.len; b-\u003ememory = 1; // content is in memory b-\u003elast_buf = 1; // this is the last buffer in the response // Create chain link ngx_chain_t out; out.buf = b; out.next = NULL; return ngx_http_output_filter(r, \u0026out); } Compile Nginx with the Custom Module\nDownload Nginx Source\nwget http://nginx.org/download/nginx-1.21.6.tar.gz tar -zxvf nginx-1.21.6.tar.gz cd nginx-1.21.6/ Copy Custom Module\nSave the custom module as ngx_http_hello_world_module.c in the Nginx source directory.\nConfigure Nginx with the Custom Module\n./configure --add-module=./ngx_http_hello_world_module make sudo make install Update Nginx Configuration to Use the Module\nserver { listen 80; server_name your_domain.com; location /hello { hello_world; } } Restart Nginx\nsudo nginx -s reload Test the Module\nNavigate to http://your_domain.com/hello and you should see “Hello, Nginx Module!” displayed.\nBenefits of Extending Nginx with Modules Customized Functionality: Tailor Nginx to meet specific application requirements. Enhanced Performance: Optimize request handling and processing. Improved Security: Implement custom security measures and protocols. Scalability: Introduce features that facilitate the scaling of web services. Resources and Further Reading Official Documentation Nginx Official Site: https://nginx.org/ Nginx Documentation: https://nginx.org/en/docs/ Nginx Wiki: https://www.nginx.com/resources/wiki/ Nginx Blog: https://www.nginx.com/blog/ Books and Articles “Nginx: A Practical Guide to High Performance” by Stephen Corona “Mastering Nginx” by Dimitri Aivaliotis “Nginx Cookbook” by Derek DeJonghe “Nginx Essentials” by Arun Kumar Maheshwari Official Nginx Blog Articles: Regularly updated with best practices and case studies. Online Tutorials and Courses DigitalOcean Nginx Tutorials: https://www.digitalocean.com/community/tags/nginx TutorialsPoint Nginx Tutorial: https://www.tutorialspoint.com/nginx/index.htm Udemy Nginx Courses: https://www.udemy.com/topic/nginx/ Coursera Web Server Management Courses: Search for Nginx-related courses. Community and Support Nginx Forums: https://forum.nginx.org/ Stack Overflow: Tag questions with nginx to get help from the community. Reddit r/nginx: https://www.reddit.com/r/nginx/ Nginx Slack: Join the official Nginx Slack workspace for real-time discussions (requires invitation). GitHub Issues: Report bugs or request features in the Nginx GitHub repository. Happy Nginx-ing!\n","wordCount":"3678","inLanguage":"en","datePublished":"2024-10-15T00:00:00Z","dateModified":"2024-10-15T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://bleedkagax.github.io/post/0_nginx/"},"publisher":{"@type":"Organization","name":"Kaga Blog","logo":{"@type":"ImageObject","url":"https://bleedkagax.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bleedkagax.github.io/ accesskey=h title="Kaga Blog (Alt + H)">Kaga Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bleedkagax.github.io/post/ title=Posts><span>Posts</span></a></li><li><a href=https://bleedkagax.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://bleedkagax.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://bleedkagax.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://bleedkagax.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Nginx</h1><div class=post-meta><span title='2024-10-15 00:00:00 +0000 UTC'>October 15, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction-to-nginx aria-label="Introduction to Nginx">Introduction to Nginx</a></li><li><a href=#what-is-nginx aria-label="What is Nginx?">What is Nginx?</a><ul><li><a href=#key-features aria-label="Key Features">Key Features</a></li><li><a href=#use-cases aria-label="Use Cases">Use Cases</a></li></ul></li><li><a href=#prerequisites aria-label=Prerequisites>Prerequisites</a></li><li><a href=#installation aria-label=Installation>Installation</a><ul><li><a href=#installing-on-ubuntudebian aria-label="Installing on Ubuntu/Debian">Installing on Ubuntu/Debian</a></li><li><a href=#installing-on-centosrhel aria-label="Installing on CentOS/RHEL">Installing on CentOS/RHEL</a></li><li><a href=#installing-on-macos aria-label="Installing on macOS">Installing on macOS</a></li><li><a href=#building-from-source aria-label="Building from Source">Building from Source</a></li></ul></li><li><a href=#basic-configuration aria-label="Basic Configuration">Basic Configuration</a><ul><li><a href=#nginx-configuration-file-structure aria-label="Nginx Configuration File Structure">Nginx Configuration File Structure</a></li><li><a href=#understanding-the-nginxconf-file aria-label="Understanding the nginx.conf File">Understanding the nginx.conf File</a></li></ul></li><li><a href=#serving-static-content aria-label="Serving Static Content">Serving Static Content</a><ul><li><a href=#basic-server-block aria-label="Basic Server Block">Basic Server Block</a></li><li><a href=#setting-up-root-and-index-files aria-label="Setting Up Root and Index Files">Setting Up Root and Index Files</a></li></ul></li><li><a href=#handling-dynamic-content aria-label="Handling Dynamic Content">Handling Dynamic Content</a><ul><li><a href=#proxying-requests-to-application-servers aria-label="Proxying Requests to Application Servers">Proxying Requests to Application Servers</a></li><li><a href=#fastcgi-and-php-integration aria-label="FastCGI and PHP Integration">FastCGI and PHP Integration</a></li></ul></li><li><a href=#load-balancing aria-label="Load Balancing">Load Balancing</a><ul><li><a href=#basic-load-balancing-methods aria-label="Basic Load Balancing Methods">Basic Load Balancing Methods</a></li><li><a href=#advanced-load-balancing-techniques aria-label="Advanced Load Balancing Techniques">Advanced Load Balancing Techniques</a></li></ul></li><li><a href=#security-best-practices aria-label="Security Best Practices">Security Best Practices</a><ul><li><a href=#ssltls-configuration aria-label="SSL/TLS Configuration">SSL/TLS Configuration</a></li><li><a href=#restricting-access aria-label="Restricting Access">Restricting Access</a></li><li><a href=#preventing-common-attacks aria-label="Preventing Common Attacks">Preventing Common Attacks</a></li></ul></li><li><a href=#performance-optimization aria-label="Performance Optimization">Performance Optimization</a><ul><li><a href=#caching aria-label=Caching>Caching</a></li><li><a href=#gzip-compression aria-label="Gzip Compression">Gzip Compression</a></li><li><a href=#buffer-adjustments aria-label="Buffer Adjustments">Buffer Adjustments</a></li><li><a href=#rate-limiting aria-label="Rate Limiting">Rate Limiting</a></li></ul></li><li><a href=#monitoring-and-logging aria-label="Monitoring and Logging">Monitoring and Logging</a><ul><li><a href=#access-logs aria-label="Access Logs">Access Logs</a></li><li><a href=#error-logs aria-label="Error Logs">Error Logs</a></li><li><a href=#real-time-monitoring-with-ngx_http_stub_status_module aria-label="Real-time Monitoring with ngx_http_stub_status_module">Real-time Monitoring with ngx_http_stub_status_module</a></li></ul></li><li><a href=#advanced-features aria-label="Advanced Features">Advanced Features</a><ul><li><a href=#reverse-proxy aria-label="Reverse Proxy">Reverse Proxy</a></li><li><a href=#using-nginx-as-a-mail-proxy aria-label="Using Nginx as a Mail Proxy">Using Nginx as a Mail Proxy</a></li><li><a href=#websockets-support aria-label="WebSockets Support">WebSockets Support</a></li><li><a href=#http2-support aria-label="HTTP/2 Support">HTTP/2 Support</a></li></ul></li><li><a href=#automation-with-nginx aria-label="Automation with Nginx">Automation with Nginx</a><ul><li><a href=#automated-configuration-reloads aria-label="Automated Configuration Reloads">Automated Configuration Reloads</a></li><li><a href=#integration-with-cicd-pipelines aria-label="Integration with CI/CD Pipelines">Integration with CI/CD Pipelines</a></li></ul></li><li><a href=#troubleshooting aria-label=Troubleshooting>Troubleshooting</a><ul><li><a href=#common-issues-and-solutions aria-label="Common Issues and Solutions">Common Issues and Solutions</a></li><li><a href=#debugging-techniques aria-label="Debugging Techniques">Debugging Techniques</a></li></ul></li><li><a href=#extending-nginx-with-modules aria-label="Extending Nginx with Modules">Extending Nginx with Modules</a><ul><li><a href=#third-party-modules aria-label="Third-Party Modules">Third-Party Modules</a></li><li><a href=#custom-module-development aria-label="Custom Module Development">Custom Module Development</a></li><li><a href=#benefits-of-extending-nginx-with-modules aria-label="Benefits of Extending Nginx with Modules">Benefits of Extending Nginx with Modules</a></li></ul></li><li><a href=#resources-and-further-reading aria-label="Resources and Further Reading">Resources and Further Reading</a><ul><li><a href=#official-documentation aria-label="Official Documentation">Official Documentation</a></li><li><a href=#books-and-articles aria-label="Books and Articles">Books and Articles</a></li><li><a href=#online-tutorials-and-courses aria-label="Online Tutorials and Courses">Online Tutorials and Courses</a></li><li><a href=#community-and-support aria-label="Community and Support">Community and Support</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=introduction-to-nginx>Introduction to Nginx<a hidden class=anchor aria-hidden=true href=#introduction-to-nginx>#</a></h2><p>Nginx (pronounced as &ldquo;Engine-X&rdquo;) is a high-performance, open-source web server, reverse proxy server, and email (IMAP/POP3) proxy server.</p><h2 id=what-is-nginx>What is Nginx?<a hidden class=anchor aria-hidden=true href=#what-is-nginx>#</a></h2><h3 id=key-features>Key Features<a hidden class=anchor aria-hidden=true href=#key-features>#</a></h3><ul><li><strong>High Performance:</strong> Ability to handle thousands of concurrent connections with minimal memory footprint.</li><li><strong>Reverse Proxying:</strong> Acts as an intermediary for requests from clients seeking resources from servers.</li><li><strong>Load Balancing:</strong> Distributes incoming traffic across multiple servers to ensure reliability and uptime.</li><li><strong>SSL/TLS Support:</strong> Provides secure connections using SSL/TLS protocols.</li><li><strong>Caching:</strong> Reduces server load and improves response times by caching responses from backend servers.</li><li><strong>Modular Architecture:</strong> Supports dynamic modules to extend its functionality.</li><li><strong>Static and Dynamic Content Serving:</strong> Efficiently serves static files and dynamically generated content.</li></ul><h3 id=use-cases>Use Cases<a hidden class=anchor aria-hidden=true href=#use-cases>#</a></h3><ul><li><strong>Web Servers:</strong> Serving websites and web applications.</li><li><strong>Reverse Proxy:</strong> Forwarding requests to application servers like Node.js, Python, Ruby, etc.</li><li><strong>Load Balancer:</strong> Distributing traffic across multiple backend servers.</li><li><strong>API Gateway:</strong> Managing and routing API requests.</li><li><strong>Content Caching:</strong> Storing frequently accessed content to enhance performance.</li></ul><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>Before diving into Nginx, ensure you have the following:</p><ul><li><strong>Basic Understanding of Web Servers:</strong> Familiarity with how web servers work.</li><li><strong>Command-Line Proficiency:</strong> Comfortable using the terminal/command prompt.</li><li><strong>Basic Networking Knowledge:</strong> Understanding of concepts like IP addresses, DNS, HTTP/HTTPS.</li><li><strong>Root/Sudo Access:</strong> Required for installing and configuring Nginx on servers.</li></ul><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><h3 id=installing-on-ubuntudebian>Installing on Ubuntu/Debian<a hidden class=anchor aria-hidden=true href=#installing-on-ubuntudebian>#</a></h3><ol><li><p><strong>Update Package List</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span></code></pre></div></li><li><p><strong>Install Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install nginx
</span></span></code></pre></div></li><li><p><strong>Start and Enable Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start nginx
</span></span><span style=display:flex><span>sudo systemctl enable nginx
</span></span></code></pre></div></li><li><p><strong>Verify Installation</strong></p><p>Open your web browser and navigate to <code>http://your_server_ip/</code>. You should see the Nginx default welcome page.</p></li></ol><h3 id=installing-on-centosrhel>Installing on CentOS/RHEL<a hidden class=anchor aria-hidden=true href=#installing-on-centosrhel>#</a></h3><ol><li><p><strong>Install EPEL Repository</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum install epel-release -y
</span></span></code></pre></div></li><li><p><strong>Install Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yum install nginx -y
</span></span></code></pre></div></li><li><p><strong>Start and Enable Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start nginx
</span></span><span style=display:flex><span>sudo systemctl enable nginx
</span></span></code></pre></div></li><li><p><strong>Adjust Firewall</strong></p><p>Allow HTTP and HTTPS traffic.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo firewall-cmd --permanent --add-service<span style=color:#f92672>=</span>http
</span></span><span style=display:flex><span>sudo firewall-cmd --permanent --add-service<span style=color:#f92672>=</span>https
</span></span><span style=display:flex><span>sudo firewall-cmd --reload
</span></span></code></pre></div></li><li><p><strong>Verify Installation</strong></p><p>Navigate to <code>http://your_server_ip/</code> in your browser to see the Nginx default page.</p></li></ol><h3 id=installing-on-macos>Installing on macOS<a hidden class=anchor aria-hidden=true href=#installing-on-macos>#</a></h3><p>You can install Nginx on macOS using Homebrew.</p><ol><li><p><strong>Install Homebrew</strong> (if not already installed)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/bin/bash -c <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div></li><li><p><strong>Install Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install nginx
</span></span></code></pre></div></li><li><p><strong>Start Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew services start nginx
</span></span></code></pre></div></li><li><p><strong>Verify Installation</strong></p><p>Open <code>http://localhost:8080/</code> in your web browser to see the Nginx welcome page.</p></li></ol><h3 id=building-from-source>Building from Source<a hidden class=anchor aria-hidden=true href=#building-from-source>#</a></h3><p>Building Nginx from source allows customization by enabling specific modules.</p><ol><li><p><strong>Install Dependencies</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install -y build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev
</span></span></code></pre></div></li><li><p><strong>Download Nginx Source Code</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget http://nginx.org/download/nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>tar -zxvf nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>cd nginx-1.21.6/
</span></span></code></pre></div></li><li><p><strong>Configure Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure --prefix<span style=color:#f92672>=</span>/usr/local/nginx --with-http_ssl_module
</span></span></code></pre></div><ul><li><code>--prefix</code>: Installation directory.</li><li><code>--with-http_ssl_module</code>: Enables SSL support.</li></ul></li><li><p><strong>Compile and Install</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div></li><li><p><strong>Start Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /usr/local/nginx/sbin/nginx
</span></span></code></pre></div></li><li><p><strong>Verify Installation</strong></p><p>Visit <code>http://your_server_ip/</code> to see the Nginx welcome page.</p></li></ol><h2 id=basic-configuration>Basic Configuration<a hidden class=anchor aria-hidden=true href=#basic-configuration>#</a></h2><h3 id=nginx-configuration-file-structure>Nginx Configuration File Structure<a hidden class=anchor aria-hidden=true href=#nginx-configuration-file-structure>#</a></h3><p>Nginx configuration files are typically located at <code>/etc/nginx/nginx.conf</code> on Unix-based systems. The primary configuration is divided into several blocks:</p><ul><li><strong>Main Context:</strong> Global settings.</li><li><strong>Events Block:</strong> Handles connection-related settings.</li><li><strong>HTTP Block:</strong> Configures web server settings, including server blocks.</li><li><strong>Server Blocks:</strong> Define virtual hosts/sites.</li><li><strong>Location Blocks:</strong> Specify how to handle different request URIs.</li></ul><h3 id=understanding-the-nginxconf-file>Understanding the <code>nginx.conf</code> File<a hidden class=anchor aria-hidden=true href=#understanding-the-nginxconf-file>#</a></h3><p>Here is a breakdown of a typical <code>nginx.conf</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span> <span style=color:#e6db74>www-data</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span> <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>pid</span> <span style=color:#e6db74>/run/nginx.pid</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker_connections</span> <span style=color:#ae81ff>1024</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span> <span style=color:#e6db74>/etc/nginx/mime.types</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>default_type</span> <span style=color:#e6db74>application/octet-stream</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sendfile</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>keepalive_timeout</span> <span style=color:#ae81ff>65</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Logging
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Gzip Compression
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>gzip</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>application/xml</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/javascript</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Server Block
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>example.com</span> <span style=color:#e6db74>www.example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span> <span style=color:#e6db74>index.nginx-debian.html</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Additional configurations...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Additional server blocks...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><ul><li><strong>Main Context:</strong> Sets user permissions, worker processes, and PID file location.</li><li><strong>Events Block:</strong> Configures connection-related settings like <code>worker_connections</code>.</li><li><strong>HTTP Block:</strong> Contains settings related to handling HTTP requests, including MIME types, logging, compression, and server blocks.</li><li><strong>Server Block:</strong> Defines settings for a virtual host, including ports, server names, root directory, index files, and location handling.</li></ul><h2 id=serving-static-content>Serving Static Content<a hidden class=anchor aria-hidden=true href=#serving-static-content>#</a></h2><p>One of the fundamental uses of Nginx is to serve static files efficiently.</p><h3 id=basic-server-block>Basic Server Block<a hidden class=anchor aria-hidden=true href=#basic-server-block>#</a></h3><p>Here&rsquo;s a simple server block configured to serve static content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/your_domain</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=setting-up-root-and-index-files>Setting Up Root and Index Files<a hidden class=anchor aria-hidden=true href=#setting-up-root-and-index-files>#</a></h3><ul><li><strong>root:</strong> Specifies the root directory where your website files are located.</li><li><strong>index:</strong> Defines the default file to serve when a directory is requested.</li></ul><p><strong>Example:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/usr/share/nginx/html</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=handling-dynamic-content>Handling Dynamic Content<a hidden class=anchor aria-hidden=true href=#handling-dynamic-content>#</a></h2><p>Nginx can also handle dynamic content by forwarding requests to application servers.</p><h3 id=proxying-requests-to-application-servers>Proxying Requests to Application Servers<a hidden class=anchor aria-hidden=true href=#proxying-requests-to-application-servers>#</a></h3><p>Use the <code>proxy_pass</code> directive to forward requests to backend servers like Node.js, Python, Ruby, etc.</p><p><strong>Example: Proxying to a Node.js Server</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://localhost:3000</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#39;upgrade&#39;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_cache_bypass</span> $http_upgrade;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>proxy_pass:</strong> Forwards all requests to the specified backend server.</li><li><strong>proxy_set_header:</strong> Sets custom headers to maintain the original client details and support WebSockets.</li><li><strong>proxy_cache_bypass:</strong> Ensures that cached content is bypassed when necessary.</li></ul><h3 id=fastcgi-and-php-integration>FastCGI and PHP Integration<a hidden class=anchor aria-hidden=true href=#fastcgi-and-php-integration>#</a></h3><p>Nginx can serve PHP applications using FastCGI processors like PHP-FPM.</p><p><strong>Example: Configuring Nginx to Serve PHP with PHP-FPM</strong></p><ol><li><p><strong>Install PHP and PHP-FPM</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install php-fpm
</span></span></code></pre></div></li><li><p><strong>Configure Nginx Server Block</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/your_domain</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.php</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Pass PHP scripts to FastCGI server
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>\.php$</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>include</span> <span style=color:#e6db74>snippets/fastcgi-php.conf</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>fastcgi_pass</span> <span style=color:#e6db74>unix:/var/run/php/php7.4-fpm.sock</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Deny access to .htaccess files
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>/\.ht</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>deny</span> <span style=color:#e6db74>all</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><p><strong>Explanation:</strong></p><ul><li><strong>location ~ .php$:</strong> Matches PHP files.</li><li><strong>include snippets/fastcgi-php.conf:</strong> Includes default FastCGI parameters.</li><li><strong>fastcgi_pass:</strong> Specifies the FastCGI server address and socket.</li><li><strong>deny all:</strong> Denies access to hidden files like <code>.htaccess</code>.</li></ul><h2 id=load-balancing>Load Balancing<a hidden class=anchor aria-hidden=true href=#load-balancing>#</a></h2><p>Nginx can distribute incoming traffic across multiple backend servers to ensure reliability and improve performance.</p><h3 id=basic-load-balancing-methods>Basic Load Balancing Methods<a hidden class=anchor aria-hidden=true href=#basic-load-balancing-methods>#</a></h3><ol><li><p><strong>Round Robin (Default Method)</strong></p><p>Distributes requests sequentially across the backend servers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend3.example.com</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><strong>Least Connections</strong></p><p>Sends requests to the server with the fewest active connections.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>least_conn</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend3.example.com</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>least_conn:</strong> Nginx directive to enable least connections load balancing.</li></ul></li><li><p><strong>IP Hash</strong></p><p>Ensures that requests from the same client IP are always directed to the same backend server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>ip_hash</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend3.example.com</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>ip_hash:</strong> Nginx directive to enable IP hash load balancing.</li></ul></li></ol><h3 id=advanced-load-balancing-techniques>Advanced Load Balancing Techniques<a hidden class=anchor aria-hidden=true href=#advanced-load-balancing-techniques>#</a></h3><ol><li><p><strong>Session Persistence</strong></p><p>Ensures that a user&rsquo;s session is consistently routed to the same backend server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend3.example.com</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Cookie</span> $http_cookie;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>proxy_set_header Cookie $http_cookie:</strong> Passes cookies to maintain session persistence.</li></ul></li><li><p><strong>Health Checks</strong></p><p>Automatically detects and removes unhealthy backend servers from the rotation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend3.example.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Health check parameters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>keepalive</span> <span style=color:#ae81ff>32</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Note:</strong> Nginx core does not support active health checks. For active health checks, consider using the <strong>Nginx Plus</strong> version or integrating with external tools like <strong>Consul</strong>.</p></li><li><p><strong>Dynamic Load Balancing with Variables</strong></p><p>Use variables to dynamically select backend servers based on request attributes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend1.example.com</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span> <span style=color:#e6db74>backend2.example.com</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>set</span> $backend <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>if</span> <span style=color:#e6db74>(</span>$arg_site = <span style=color:#e6db74>&#34;site1&#34;)</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>set</span> $backend <span style=color:#e6db74>&#34;backend1.example.com&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#f92672>if</span> <span style=color:#e6db74>(</span>$arg_site = <span style=color:#e6db74>&#34;site2&#34;)</span> {
</span></span><span style=display:flex><span>                <span style=color:#f92672>set</span> $backend <span style=color:#e6db74>&#34;backend2.example.com&#34;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://</span>$backend;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><h2 id=security-best-practices>Security Best Practices<a hidden class=anchor aria-hidden=true href=#security-best-practices>#</a></h2><p>Securing your Nginx server is crucial to protect your web applications and data.</p><h3 id=ssltls-configuration>SSL/TLS Configuration<a hidden class=anchor aria-hidden=true href=#ssltls-configuration>#</a></h3><p>Implement SSL/TLS to encrypt data between clients and your server.</p><ol><li><p><strong>Obtain SSL Certificates</strong></p><ul><li><p><strong>Using Let&rsquo;s Encrypt:</strong> Free SSL certificates via Certbot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install certbot python3-certbot-nginx
</span></span><span style=display:flex><span>sudo certbot --nginx -d your_domain.com -d www.your_domain.com
</span></span></code></pre></div></li></ul></li><li><p><strong>Configure SSL in Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span> <span style=color:#e6db74>www.your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/letsencrypt/live/your_domain.com/fullchain.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/letsencrypt/live/your_domain.com/privkey.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># Additional proxy settings...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span> <span style=color:#e6db74>www.your_domain.com</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>listen 443 ssl;</strong>: Listens for HTTPS connections.</li><li><strong>ssl_certificate:</strong> Path to the SSL certificate.</li><li><strong>ssl_certificate_key:</strong> Path to the SSL certificate key.</li><li><strong>ssl_protocols:</strong> Specifies allowed TLS protocols.</li><li><strong>ssl_ciphers:</strong> Defines strong ciphers.</li></ul></li><li><p><strong>Enable HTTP/2</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span> <span style=color:#e6db74>www.your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/letsencrypt/live/your_domain.com/fullchain.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/letsencrypt/live/your_domain.com/privkey.pem</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># Additional proxy settings...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>http2:</strong> Enables HTTP/2 protocol for improved performance.</li></ul></li></ol><h3 id=restricting-access>Restricting Access<a hidden class=anchor aria-hidden=true href=#restricting-access>#</a></h3><p>Control access to sensitive resources and restrict unwanted traffic.</p><ol><li><p><strong>Restrict Access by IP Address</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/admin</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>allow</span> <span style=color:#ae81ff>192</span><span style=color:#e6db74>.168.1.0/24</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>deny</span> <span style=color:#e6db74>all</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://admin_backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>allow 192.168.1.0/24;</strong>: Allows access from the specified IP range.</li><li><strong>deny all;</strong>: Denies access to all other IPs.</li></ul></li><li><p><strong>Password Protection with HTTP Basic Auth</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install apache2-utils
</span></span><span style=display:flex><span>sudo htpasswd -c /etc/nginx/.htpasswd user1
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>apache2-utils:</strong> Provides <code>htpasswd</code> utility to create password files.</li><li><strong>htpasswd -c /etc/nginx/.htpasswd user1:</strong> Creates a new password file and adds <code>user1</code>.</li></ul><p><strong>Nginx Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/secure</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_basic</span> <span style=color:#e6db74>&#34;Restricted</span> <span style=color:#e6db74>Area&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_basic_user_file</span> <span style=color:#e6db74>/etc/nginx/.htpasswd</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://secure_backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>auth_basic:</strong> Enables basic authentication with a realm name.</li><li><strong>auth_basic_user_file:</strong> Specifies the path to the password file.</li></ul></li></ol><h3 id=preventing-common-attacks>Preventing Common Attacks<a hidden class=anchor aria-hidden=true href=#preventing-common-attacks>#</a></h3><ol><li><p><strong>DDoS Protection</strong></p><p>Implement rate limiting to mitigate DDoS attacks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>limit_req_zone</span> $binary_remote_addr <span style=color:#e6db74>zone=one:10m</span> <span style=color:#e6db74>rate=1r/s</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>limit_req</span> <span style=color:#e6db74>zone=one</span> <span style=color:#e6db74>burst=5</span> <span style=color:#e6db74>nodelay</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>limit_req_zone:</strong> Defines a shared memory zone named <code>one</code> with a rate of 1 request per second.</li><li><strong>limit_req:</strong> Applies the rate limit to requests in the specified location.</li></ul></li><li><p><strong>Preventing Clickjacking</strong></p><p>Add <code>X-Frame-Options</code> header to prevent the website from being framed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Frame-Options</span> <span style=color:#e6db74>&#34;SAMEORIGIN&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>add_header X-Frame-Options &ldquo;SAMEORIGIN&rdquo; always;</strong>: Prevents the site from being embedded in iframes from different origins.</li></ul></li><li><p><strong>Content Security Policy (CSP)</strong></p><p>Define a CSP to prevent cross-site scripting (XSS) and other code injection attacks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Content-Security-Policy</span> <span style=color:#e6db74>&#34;default-src</span> <span style=color:#e6db74>&#39;self&#39;</span>; <span style=color:#f92672>script-src</span> <span style=color:#e6db74>&#39;self&#39;</span> <span style=color:#e6db74>https://cdnjs.cloudflare.com</span>;<span style=color:#f92672>&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>add_header Content-Security-Policy:</strong> Sets the CSP header to restrict sources of content.</li></ul></li></ol><h2 id=performance-optimization>Performance Optimization<a hidden class=anchor aria-hidden=true href=#performance-optimization>#</a></h2><p>Enhance Nginx&rsquo;s performance to handle high traffic efficiently.</p><h3 id=caching>Caching<a hidden class=anchor aria-hidden=true href=#caching>#</a></h3><p>Implement caching strategies to reduce server load and improve response times.</p><ol><li><p><strong>Proxy Caching</strong></p><p>Cache responses from backend servers.</p><p><strong>Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_cache_path</span> <span style=color:#e6db74>/var/cache/nginx</span> <span style=color:#e6db74>levels=1:2</span> <span style=color:#e6db74>keys_zone=my_cache:10m</span> <span style=color:#e6db74>max_size=10g</span> <span style=color:#e6db74>inactive=60m</span> <span style=color:#e6db74>use_temp_path=off</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_cache</span> <span style=color:#e6db74>my_cache</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_cache_valid</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>302</span> <span style=color:#ae81ff>10m</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_cache_valid</span> <span style=color:#ae81ff>404</span>      <span style=color:#ae81ff>1m</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_cache_use_stale</span> <span style=color:#e6db74>error</span> <span style=color:#e6db74>timeout</span> <span style=color:#e6db74>updating</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Proxy-Cache</span> $upstream_cache_status;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>proxy_cache_path:</strong> Defines cache storage path and parameters.</li><li><strong>proxy_cache:</strong> Enables caching for the specified location.</li><li><strong>proxy_cache_valid:</strong> Sets cache duration based on response statuses.</li><li><strong>proxy_cache_use_stale:</strong> Serves stale content under specific conditions.</li><li><strong>add_header X-Proxy-Cache:</strong> Adds a header indicating cache status.</li></ul></li><li><p><strong>FastCGI Caching</strong></p><p>Cache responses from FastCGI servers like PHP-FPM.</p><p><strong>Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>fastcgi_cache_path</span> <span style=color:#e6db74>/var/cache/nginx</span> <span style=color:#e6db74>levels=1:2</span> <span style=color:#e6db74>keys_zone=fastcgi_cache:10m</span> <span style=color:#e6db74>inactive=60m</span> <span style=color:#e6db74>use_temp_path=off</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> ~ <span style=color:#e6db74>\.php$</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>fastcgi_pass</span> <span style=color:#e6db74>unix:/var/run/php/php7.4-fpm.sock</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>include</span> <span style=color:#e6db74>fastcgi_params</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>fastcgi_cache</span> <span style=color:#e6db74>fastcgi_cache</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>fastcgi_cache_valid</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>302</span> <span style=color:#ae81ff>10m</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>fastcgi_cache_valid</span> <span style=color:#ae81ff>404</span>      <span style=color:#ae81ff>1m</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>fastcgi_cache_use_stale</span> <span style=color:#e6db74>error</span> <span style=color:#e6db74>timeout</span> <span style=color:#e6db74>updating</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-FastCGI-Cache</span> $upstream_cache_status;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>fastcgi_cache_path:</strong> Defines FastCGI cache storage path and parameters.</li><li><strong>fastcgi_cache:</strong> Enables FastCGI caching for the specified location.</li></ul></li></ol><h3 id=gzip-compression>Gzip Compression<a hidden class=anchor aria-hidden=true href=#gzip-compression>#</a></h3><p>Enable gzip compression to reduce the size of responses and improve load times.</p><p><strong>Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_disable</span> <span style=color:#e6db74>&#34;msie6&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_vary</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_proxied</span> <span style=color:#e6db74>any</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_comp_level</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_buffers</span> <span style=color:#ae81ff>16</span> <span style=color:#ae81ff>8k</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>application/xml</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>image/svg+xml</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>gzip on;</strong>: Enables gzip compression.</li><li><strong>gzip_disable &ldquo;msie6&rdquo;;</strong>: Disables gzip for old browsers.</li><li><strong>gzip_vary on;</strong>: Adds <code>Vary: Accept-Encoding</code> header.</li><li><strong>gzip_comp_level:</strong> Sets compression level (1-9).</li><li><strong>gzip_buffers:</strong> Defines buffer size for compression.</li><li><strong>gzip_http_version:</strong> Minimum HTTP version for gzip.</li><li><strong>gzip_types:</strong> Specifies MIME types to compress.</li></ul><h3 id=buffer-adjustments>Buffer Adjustments<a hidden class=anchor aria-hidden=true href=#buffer-adjustments>#</a></h3><p>Adjust buffer sizes to optimize request and response handling.</p><p><strong>Example:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>client_max_body_size</span> <span style=color:#e6db74>50M</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>client_body_buffer_size</span> <span style=color:#ae81ff>128k</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>large_client_header_buffers</span> <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>16k</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>client_body_timeout</span> <span style=color:#ae81ff>12</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>client_header_timeout</span> <span style=color:#ae81ff>12</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>send_timeout</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>client_max_body_size:</strong> Limits the maximum allowed size of the client request body.</li><li><strong>client_body_buffer_size:</strong> Sets the buffer size for reading client request body.</li><li><strong>large_client_header_buffers:</strong> Defines buffers for large client headers.</li><li><strong>client_body_timeout, client_header_timeout, send_timeout:</strong> Sets timeouts for reading client requests and sending responses.</li></ul><h3 id=rate-limiting>Rate Limiting<a hidden class=anchor aria-hidden=true href=#rate-limiting>#</a></h3><p>Control the rate of incoming requests to prevent abuse and ensure quality of service.</p><p><strong>Example: Rate Limiting Using Shared Memory Zones</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>limit_req_zone</span> $binary_remote_addr <span style=color:#e6db74>zone=one:10m</span> <span style=color:#e6db74>rate=1r/s</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>            <span style=color:#f92672>limit_req</span> <span style=color:#e6db74>zone=one</span> <span style=color:#e6db74>burst=5</span> <span style=color:#e6db74>nodelay</span>;
</span></span><span style=display:flex><span>            <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>limit_req_zone:</strong> Defines a shared memory zone for rate limiting based on the client IP.</li><li><strong>limit_req:</strong> Applies rate limiting to the specified location.</li></ul><h2 id=monitoring-and-logging>Monitoring and Logging<a hidden class=anchor aria-hidden=true href=#monitoring-and-logging>#</a></h2><p>Effective monitoring and logging are essential for maintaining and troubleshooting your Nginx server.</p><h3 id=access-logs>Access Logs<a hidden class=anchor aria-hidden=true href=#access-logs>#</a></h3><p>Access logs record all incoming requests, providing valuable insights into traffic patterns and user behavior.</p><p><strong>Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>log_format</span> <span style=color:#e6db74>main</span> <span style=color:#e6db74>&#39;</span>$remote_addr <span style=color:#e6db74>-</span> $remote_user <span style=color:#e6db74>[</span>$time_local] <span style=color:#e6db74>&#34;</span>$request&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;</span>$status $body_bytes_sent <span style=color:#e6db74>&#34;</span>$http_referer&#34; <span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#39;&#34;</span>$http_user_agent&#34; <span style=color:#e6db74>&#34;</span>$http_x_forwarded_for&#34;&#39;;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/access.log</span> <span style=color:#e6db74>main</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>log_format:</strong> Defines the format of the log entries.</li><li><strong>access_log:</strong> Specifies the location and format of the access log.</li></ul><h3 id=error-logs>Error Logs<a hidden class=anchor aria-hidden=true href=#error-logs>#</a></h3><p>Error logs capture server-side errors and issues, aiding in diagnosis and troubleshooting.</p><p><strong>Configuration:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span> <span style=color:#e6db74>warn</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>error_log:</strong> Specifies the location and log level (<code>debug</code>, <code>info</code>, <code>notice</code>, <code>warn</code>, <code>error</code>, <code>crit</code>, <code>alert</code>, <code>emerg</code>).</li></ul><h3 id=real-time-monitoring-with-ngx_http_stub_status_module>Real-time Monitoring with ngx_http_stub_status_module<a hidden class=anchor aria-hidden=true href=#real-time-monitoring-with-ngx_http_stub_status_module>#</a></h3><p>The <code>ngx_http_stub_status_module</code> provides a simple status page displaying basic server metrics.</p><p><strong>Configuration:</strong></p><ol><li><p><strong>Enable the Status Module</strong></p><p>Ensure the module is included during Nginx compilation. Most pre-built Nginx packages include this module by default.</p></li><li><p><strong>Configure the Status Page</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>8080</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>localhost</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/nginx_status</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>stub_status</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>allow</span> <span style=color:#ae81ff>127</span><span style=color:#e6db74>.0.0.1</span>; <span style=color:#75715e># Allow only local access
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>deny</span> <span style=color:#e6db74>all</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><strong>Access the Status Page</strong></p><p>Navigate to <code>http://localhost:8080/nginx_status</code> to view real-time metrics:</p><pre tabindex=0><code>Active connections: 291 
server accepts handled requests
 1526989 1526989 2983949 
Reading: 12 Writing: 34 Waiting: 245 
</code></pre><p><strong>Explanation:</strong></p><ul><li><strong>Active connections:</strong> Current active connections.</li><li><strong>accepts/handled/requests:</strong> Total accepted, handled, and processed requests.</li><li><strong>Reading/Writing/Waiting:</strong> State of connections.</li></ul></li></ol><h2 id=advanced-features>Advanced Features<a hidden class=anchor aria-hidden=true href=#advanced-features>#</a></h2><p>Explore advanced functionalities of Nginx to streamline and enhance your web server capabilities.</p><h3 id=reverse-proxy>Reverse Proxy<a hidden class=anchor aria-hidden=true href=#reverse-proxy>#</a></h3><p>Implementing Nginx as a reverse proxy allows it to handle all client requests and distribute them to appropriate backend servers.</p><p><strong>Example: Reverse Proxy Setup</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>proxy_pass:</strong> Forwards requests to the specified backend server.</li><li><strong>proxy_set_header:</strong> Sets headers to preserve client information.</li></ul><h3 id=using-nginx-as-a-mail-proxy>Using Nginx as a Mail Proxy<a hidden class=anchor aria-hidden=true href=#using-nginx-as-a-mail-proxy>#</a></h3><p>Nginx can function as a mail proxy for IMAP, POP3, and SMTP protocols.</p><p><strong>Configuration Example for IMAP Proxy</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>mail</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>listen</span>     <span style=color:#ae81ff>143</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>protocol</span>   <span style=color:#e6db74>imap</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass_error_message</span> <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth_http</span>  localhost:<span style=color:#ae81ff>8080</span><span style=color:#e6db74>/auth</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>mail:</strong> Defines mail-related configurations.</li><li><strong>server:</strong> Configures the mail server.</li><li><strong>listen:</strong> Specifies the port and protocol.</li><li><strong>proxy_pass_error_message:</strong> Enables forwarding of error messages from the backend.</li><li><strong>auth_http:</strong> Defines the authentication server.</li></ul><h3 id=websockets-support>WebSockets Support<a hidden class=anchor aria-hidden=true href=#websockets-support>#</a></h3><p>Enable real-time, bidirectional communication using WebSockets.</p><p><strong>Configuration Example: WebSockets with Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/ws</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend_server</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;Upgrade&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>proxy_http_version 1.1:</strong> Sets HTTP version to 1.1 to support WebSockets.</li><li><strong>proxy_set_header Upgrade $http_upgrade;</strong>: Passes the Upgrade header.</li><li><strong>proxy_set_header Connection &ldquo;Upgrade&rdquo;;</strong>: Maintains the connection upgrade.</li></ul><h3 id=http2-support>HTTP/2 Support<a hidden class=anchor aria-hidden=true href=#http2-support>#</a></h3><p>Implement HTTP/2 for improved performance with features like multiplexing, header compression, and server push.</p><p><strong>Configuration Example: Enabling HTTP/2</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/ssl/certs/your_domain.com.crt</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/ssl/private/your_domain.com.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>http2:</strong> Enables HTTP/2 protocol on the listen directive.</li><li><strong>ssl_certificate & ssl_certificate_key:</strong> Required for HTTPS and HTTP/2.</li></ul><h2 id=automation-with-nginx>Automation with Nginx<a hidden class=anchor aria-hidden=true href=#automation-with-nginx>#</a></h2><p>Automate configuration management and deployments to streamline operations.</p><h3 id=automated-configuration-reloads>Automated Configuration Reloads<a hidden class=anchor aria-hidden=true href=#automated-configuration-reloads>#</a></h3><p>Automatically reload Nginx configurations without downtime.</p><p><strong>Using <code>nginx -t</code> and <code>nginx -s reload</code></strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t <span style=color:#f92672>&amp;&amp;</span> sudo nginx -s reload
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>nginx -t:</strong> Tests the configuration for syntax errors.</li><li><strong>nginx -s reload:</strong> Reloads Nginx without stopping the service.</li></ul><h3 id=integration-with-cicd-pipelines>Integration with CI/CD Pipelines<a hidden class=anchor aria-hidden=true href=#integration-with-cicd-pipelines>#</a></h3><p>Integrate Nginx configuration deployments into CI/CD workflows for seamless updates.</p><p><strong>Example: GitLab CI/CD Configuration (<code>.gitlab-ci.yml</code>)</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>stages</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>test_config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>test</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>sudo nginx -t</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>only</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>master</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>deploy_production</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>script</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>sudo nginx -s reload</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>only</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>master</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>tags</span>
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ul><li><strong>test_config:</strong> Tests Nginx configuration on commit to master.</li><li><strong>deploy_production:</strong> Reloads Nginx after successful tests.</li></ul><h2 id=troubleshooting>Troubleshooting<a hidden class=anchor aria-hidden=true href=#troubleshooting>#</a></h2><p>Identify and resolve common Nginx issues to maintain a healthy web server.</p><h3 id=common-issues-and-solutions>Common Issues and Solutions<a hidden class=anchor aria-hidden=true href=#common-issues-and-solutions>#</a></h3><ol><li><p><strong>Nginx Not Starting</strong></p><ul><li><p><strong>Check Configuration Syntax:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div></li><li><p><strong>Inspect Error Logs:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tail -f /var/log/nginx/error.log
</span></span></code></pre></div></li><li><p><strong>Solution:</strong> Fix any syntax errors or conflicts in the configuration file.</p></li></ul></li><li><p><strong>403 Forbidden Error</strong></p><ul><li><p><strong>Cause:</strong> Incorrect file permissions or missing <code>index</code> file.</p></li><li><p><strong>Solution:</strong> Ensure Nginx has read permissions to the root directory and that an <code>index</code> file exists.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chown -R www-data:www-data /var/www/your_domain
</span></span><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>755</span> /var/www/your_domain
</span></span></code></pre></div></li></ul></li><li><p><strong>502 Bad Gateway</strong></p><ul><li><strong>Cause:</strong> Backend server is down or misconfigured.</li><li><strong>Solution:</strong> Verify the backend server is running and accessible. Check Nginx proxy settings.</li></ul></li><li><p><strong>504 Gateway Timeout</strong></p><ul><li><p><strong>Cause:</strong> Backend server is taking too long to respond.</p></li><li><p><strong>Solution:</strong> Increase timeout settings in Nginx and ensure backend server performance.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://backend</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_read_timeout</span> <span style=color:#ae81ff>300</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_connect_timeout</span> <span style=color:#ae81ff>300</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>proxy_send_timeout</span> <span style=color:#ae81ff>300</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul></li></ol><h3 id=debugging-techniques>Debugging Techniques<a hidden class=anchor aria-hidden=true href=#debugging-techniques>#</a></h3><ol><li><p><strong>Enable Debug Logging</strong></p><p>Modify the <code>error_log</code> directive to include debug information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>error_log</span> <span style=color:#e6db74>/var/log/nginx/error.log</span> <span style=color:#e6db74>debug</span>;
</span></span></code></pre></div><p><strong>Note:</strong> Debug logging can generate large amounts of log data, so it should be used with caution to avoid enabling it in production environments.</p></li><li><p><strong>Use <code>curl</code> for Testing</strong></p><p>Test server responses and behavior using <code>curl</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -I http://your_domain.com/
</span></span><span style=display:flex><span>curl -v http://your_domain.com/api
</span></span></code></pre></div></li><li><p><strong>Analyze Access Logs</strong></p><p>Review access logs to understand traffic patterns and identify anomalies.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tail -f /var/log/nginx/access.log
</span></span></code></pre></div></li><li><p><strong>Check System Resources</strong></p><p>Ensure the server has sufficient resources (CPU, memory, disk I/O).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>top
</span></span><span style=display:flex><span>df -h
</span></span></code></pre></div></li></ol><h2 id=extending-nginx-with-modules>Extending Nginx with Modules<a hidden class=anchor aria-hidden=true href=#extending-nginx-with-modules>#</a></h2><p>Enhance Nginx’s capabilities by integrating additional modules.</p><h3 id=third-party-modules>Third-Party Modules<a hidden class=anchor aria-hidden=true href=#third-party-modules>#</a></h3><ol><li><p><strong>ngx_brotli</strong></p><p>Adds Brotli compression to Nginx.</p><p><strong>Installation:</strong></p><ul><li><p>Clone the module repository.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/google/ngx_brotli.git
</span></span><span style=display:flex><span>cd ngx_brotli
</span></span><span style=display:flex><span>git submodule update --init
</span></span></code></pre></div></li><li><p>Recompile Nginx with the module.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure --add-module<span style=color:#f92672>=</span>/path/to/ngx_brotli
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div></li></ul></li><li><p><strong>ngx_pagespeed</strong></p><p>Optimizes web pages by automatically applying best practices.</p><p><strong>Installation:</strong></p><ul><li><p>Download Pagespeed module.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://dl.google.com/dl/page-speed/psol/1.13.35.2-x64.tar.gz
</span></span><span style=display:flex><span>tar -xzvf 1.13.35.2-x64.tar.gz
</span></span></code></pre></div></li><li><p>Recompile Nginx with Pagespeed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure --add-module<span style=color:#f92672>=</span>/path/to/ngx_pagespeed-1.13.35.2-beta
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div></li></ul></li></ol><p><strong>Note:</strong> Third-party modules require recompiling Nginx from source. Consider using dynamic modules if supported.</p><h3 id=custom-module-development>Custom Module Development<a hidden class=anchor aria-hidden=true href=#custom-module-development>#</a></h3><p>Develop custom modules to extend Nginx functionality specific to your needs.</p><ol><li><p><strong>Understand Nginx Module Architecture</strong></p><ul><li><strong>Handler Directives:</strong> Define how requests are processed.</li><li><strong>Configuration Directives:</strong> Customize module behavior.</li><li><strong>Context Types:</strong> Specify where directives can appear (<code>http</code>, <code>server</code>, <code>location</code>).</li></ul></li><li><p><strong>Set Up Development Environment</strong></p><ul><li>Install development dependencies.</li><li>Familiarize yourself with Nginx internals.</li></ul></li><li><p><strong>Create a Basic Module</strong></p><p><strong>Example: Hello World Module</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ngx_config.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ngx_core.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;ngx_http.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ngx_http_hello_world</span>(<span style=color:#66d9ef>ngx_conf_t</span> <span style=color:#f92672>*</span>cf, <span style=color:#66d9ef>ngx_command_t</span> <span style=color:#f92672>*</span>cmd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>conf);
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>ngx_int_t</span> <span style=color:#a6e22e>ngx_http_handler</span>(<span style=color:#66d9ef>ngx_http_request_t</span> <span style=color:#f92672>*</span>r);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>ngx_command_t</span> ngx_http_hello_world_commands[] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ngx_string</span>(<span style=color:#e6db74>&#34;hello_world&#34;</span>),
</span></span><span style=display:flex><span>        NGX_HTTP_MAIN_CONF <span style=color:#f92672>|</span> NGX_CONF_NOARGS,
</span></span><span style=display:flex><span>        ngx_http_hello_world,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        NULL
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    ngx_null_command
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>ngx_http_module_t</span> ngx_http_hello_world_module_ctx <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    NULL, <span style=color:#75715e>// preconfiguration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// postconfiguration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    NULL, <span style=color:#75715e>// create main configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// init main configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    NULL, <span style=color:#75715e>// create server configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// merge server configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    NULL, <span style=color:#75715e>// create location configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL  <span style=color:#75715e>// merge location configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ngx_module_t</span> ngx_http_hello_world_module <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    NGX_MODULE_V1,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&amp;</span>ngx_http_hello_world_module_ctx,
</span></span><span style=display:flex><span>    ngx_http_hello_world_commands,
</span></span><span style=display:flex><span>    NGX_HTTP_MODULE,
</span></span><span style=display:flex><span>    NULL, <span style=color:#75715e>// init master
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// init module
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// init process
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// init thread
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// exit thread
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// exit process
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NULL, <span style=color:#75715e>// exit master
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    NGX_MODULE_V1_PADDING
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ngx_http_hello_world</span>(<span style=color:#66d9ef>ngx_conf_t</span> <span style=color:#f92672>*</span>cf, <span style=color:#66d9ef>ngx_command_t</span> <span style=color:#f92672>*</span>cmd, <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>conf) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ngx_http_core_loc_conf_t</span> <span style=color:#f92672>*</span>clcf;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Get the core location config
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    clcf <span style=color:#f92672>=</span> <span style=color:#a6e22e>ngx_http_conf_get_module_loc_conf</span>(cf, ngx_http_core_module);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Set the handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    clcf<span style=color:#f92672>-&gt;</span>handler <span style=color:#f92672>=</span> ngx_http_handler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> NGX_CONF_OK;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>ngx_int_t</span> <span style=color:#a6e22e>ngx_http_handler</span>(<span style=color:#66d9ef>ngx_http_request_t</span> <span style=color:#f92672>*</span>r) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>(r<span style=color:#f92672>-&gt;</span>method <span style=color:#f92672>&amp;</span> NGX_HTTP_GET)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> NGX_HTTP_NOT_ALLOWED;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ngx_str_t</span> response <span style=color:#f92672>=</span> <span style=color:#a6e22e>ngx_string</span>(<span style=color:#e6db74>&#34;Hello, Nginx Module!&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Set response headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>ngx_table_elt_t</span> <span style=color:#f92672>*</span>h;
</span></span><span style=display:flex><span>    h <span style=color:#f92672>=</span> <span style=color:#a6e22e>ngx_list_push</span>(<span style=color:#f92672>&amp;</span>r<span style=color:#f92672>-&gt;</span>headers_out.headers);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (h <span style=color:#f92672>==</span> NULL) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> NGX_HTTP_INTERNAL_SERVER_ERROR;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    h<span style=color:#f92672>-&gt;</span>key.len <span style=color:#f92672>=</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    h<span style=color:#f92672>-&gt;</span>key.data <span style=color:#f92672>=</span> (u_char <span style=color:#f92672>*</span>) <span style=color:#e6db74>&#34;Content-Type&#34;</span>;
</span></span><span style=display:flex><span>    h<span style=color:#f92672>-&gt;</span>value.len <span style=color:#f92672>=</span> <span style=color:#66d9ef>sizeof</span>(<span style=color:#e6db74>&#34;text/plain&#34;</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    h<span style=color:#f92672>-&gt;</span>value.data <span style=color:#f92672>=</span> (u_char <span style=color:#f92672>*</span>) <span style=color:#e6db74>&#34;text/plain&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r<span style=color:#f92672>-&gt;</span>headers_out.status <span style=color:#f92672>=</span> NGX_HTTP_OK;
</span></span><span style=display:flex><span>    r<span style=color:#f92672>-&gt;</span>headers_out.content_length_n <span style=color:#f92672>=</span> response.len;
</span></span><span style=display:flex><span>    r<span style=color:#f92672>-&gt;</span>headers_out.content_type <span style=color:#f92672>=</span> h<span style=color:#f92672>-&gt;</span>value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Send headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>ngx_int_t</span> rc <span style=color:#f92672>=</span> <span style=color:#a6e22e>ngx_http_send_header</span>(r);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (rc <span style=color:#f92672>==</span> NGX_ERROR <span style=color:#f92672>||</span> rc <span style=color:#f92672>&gt;</span> NGX_OK <span style=color:#f92672>||</span> r<span style=color:#f92672>-&gt;</span>header_only) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> rc;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>ngx_buf_t</span> <span style=color:#f92672>*</span>b <span style=color:#f92672>=</span> <span style=color:#a6e22e>ngx_pcalloc</span>(r<span style=color:#f92672>-&gt;</span>pool, <span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>ngx_buf_t</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (b <span style=color:#f92672>==</span> NULL) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> NGX_HTTP_INTERNAL_SERVER_ERROR;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    b<span style=color:#f92672>-&gt;</span>pos <span style=color:#f92672>=</span> response.data;
</span></span><span style=display:flex><span>    b<span style=color:#f92672>-&gt;</span>last <span style=color:#f92672>=</span> response.data <span style=color:#f92672>+</span> response.len;
</span></span><span style=display:flex><span>    b<span style=color:#f92672>-&gt;</span>memory <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// content is in memory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    b<span style=color:#f92672>-&gt;</span>last_buf <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// this is the last buffer in the response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create chain link
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>ngx_chain_t</span> out;
</span></span><span style=display:flex><span>    out.buf <span style=color:#f92672>=</span> b;
</span></span><span style=display:flex><span>    out.next <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ngx_http_output_filter</span>(r, <span style=color:#f92672>&amp;</span>out);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><strong>Compile Nginx with the Custom Module</strong></p><ul><li><p><strong>Download Nginx Source</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget http://nginx.org/download/nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>tar -zxvf nginx-1.21.6.tar.gz
</span></span><span style=display:flex><span>cd nginx-1.21.6/
</span></span></code></pre></div></li><li><p><strong>Copy Custom Module</strong></p><p>Save the custom module as <code>ngx_http_hello_world_module.c</code> in the Nginx source directory.</p></li><li><p><strong>Configure Nginx with the Custom Module</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./configure --add-module<span style=color:#f92672>=</span>./ngx_http_hello_world_module
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>sudo make install
</span></span></code></pre></div></li><li><p><strong>Update Nginx Configuration to Use the Module</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>your_domain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/hello</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>hello_world</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p><strong>Restart Nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -s reload
</span></span></code></pre></div></li><li><p><strong>Test the Module</strong></p><p>Navigate to <code>http://your_domain.com/hello</code> and you should see &ldquo;Hello, Nginx Module!&rdquo; displayed.</p></li></ul></li></ol><h3 id=benefits-of-extending-nginx-with-modules>Benefits of Extending Nginx with Modules<a hidden class=anchor aria-hidden=true href=#benefits-of-extending-nginx-with-modules>#</a></h3><ul><li><strong>Customized Functionality:</strong> Tailor Nginx to meet specific application requirements.</li><li><strong>Enhanced Performance:</strong> Optimize request handling and processing.</li><li><strong>Improved Security:</strong> Implement custom security measures and protocols.</li><li><strong>Scalability:</strong> Introduce features that facilitate the scaling of web services.</li></ul><h2 id=resources-and-further-reading>Resources and Further Reading<a hidden class=anchor aria-hidden=true href=#resources-and-further-reading>#</a></h2><h3 id=official-documentation>Official Documentation<a hidden class=anchor aria-hidden=true href=#official-documentation>#</a></h3><ul><li><strong>Nginx Official Site:</strong> <a href=https://nginx.org/>https://nginx.org/</a></li><li><strong>Nginx Documentation:</strong> <a href=https://nginx.org/en/docs/>https://nginx.org/en/docs/</a></li><li><strong>Nginx Wiki:</strong> <a href=https://www.nginx.com/resources/wiki/>https://www.nginx.com/resources/wiki/</a></li><li><strong>Nginx Blog:</strong> <a href=https://www.nginx.com/blog/>https://www.nginx.com/blog/</a></li></ul><h3 id=books-and-articles>Books and Articles<a hidden class=anchor aria-hidden=true href=#books-and-articles>#</a></h3><ul><li><strong>&ldquo;Nginx: A Practical Guide to High Performance&rdquo;</strong> by Stephen Corona</li><li><strong>&ldquo;Mastering Nginx&rdquo;</strong> by Dimitri Aivaliotis</li><li><strong>&ldquo;Nginx Cookbook&rdquo;</strong> by Derek DeJonghe</li><li><strong>&ldquo;Nginx Essentials&rdquo;</strong> by Arun Kumar Maheshwari</li><li><strong>Official Nginx Blog Articles:</strong> Regularly updated with best practices and case studies.</li></ul><h3 id=online-tutorials-and-courses>Online Tutorials and Courses<a hidden class=anchor aria-hidden=true href=#online-tutorials-and-courses>#</a></h3><ul><li><strong>DigitalOcean Nginx Tutorials:</strong> <a href=https://www.digitalocean.com/community/tags/nginx>https://www.digitalocean.com/community/tags/nginx</a></li><li><strong>TutorialsPoint Nginx Tutorial:</strong> <a href=https://www.tutorialspoint.com/nginx/index.htm>https://www.tutorialspoint.com/nginx/index.htm</a></li><li><strong>Udemy Nginx Courses:</strong> <a href=https://www.udemy.com/topic/nginx/>https://www.udemy.com/topic/nginx/</a></li><li><strong>Coursera Web Server Management Courses:</strong> Search for Nginx-related courses.</li></ul><h3 id=community-and-support>Community and Support<a hidden class=anchor aria-hidden=true href=#community-and-support>#</a></h3><ul><li><strong>Nginx Forums:</strong> <a href=https://forum.nginx.org/>https://forum.nginx.org/</a></li><li><strong>Stack Overflow:</strong> Tag questions with <code>nginx</code> to get help from the community.</li><li><strong>Reddit r/nginx:</strong> <a href=https://www.reddit.com/r/nginx/>https://www.reddit.com/r/nginx/</a></li><li><strong>Nginx Slack:</strong> Join the <a href=https://nginx.slack.com/>official Nginx Slack workspace</a> for real-time discussions (requires invitation).</li><li><strong>GitHub Issues:</strong> Report bugs or request features in the <a href=https://github.com/nginx/nginx/issues>Nginx GitHub repository</a>.</li></ul><p><em>Happy Nginx-ing!</em></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bleedkagax.github.io/tags/systemdesign/>SystemDesign</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://bleedkagax.github.io/>Kaga Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script type=module>
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script><script>(function(){var e=document.querySelectorAll("pre > code.language-mermaid");e.forEach(function(e){var t,n=e.parentElement;if(!n)return;t=document.createElement("div"),t.className="mermaid",t.textContent=e.textContent||"",n.replaceWith(t)})})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>